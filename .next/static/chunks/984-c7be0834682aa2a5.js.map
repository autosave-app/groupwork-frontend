{"version":3,"file":"static/chunks/984-c7be0834682aa2a5.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;AACA,IAAME,gBAAgB,GAAG,SAAnBA,gBAAmB,OAAqD;EAAA,IAAlDC,cAAkD,QAAlDA,cAAkD;EAAA,IAAlCC,iBAAkC,QAAlCA,iBAAkC;EAAA,IAAZC,KAAY;;EAC5E,IAAMC,MAAM,GAAGH,cAAc,KAAK,MAAlC;EACA,IAAMI,cAAc,GAAGD,MAAM,GAAG,GAAH,GAAS,IAAtC;EACA,IAAME,OAAO,GAAG,CAAC,oDAAMJ,iBAAN,CAAD,GAA4BA,iBAA5B,GAAgDG,cAAhE;EACA,IAAME,SAAS,GAAGH,MAAM,GAAG,IAAH,GAAU,KAAlC;EACA,oBACE,uDAAC,2DAAD;IACE,QAAQ,EAAC,UADX;IAEE,OAAO,EAAC,MAFV;IAGE,aAAa,EAAC,QAHhB;IAIE,cAAc,EAAC,QAJjB;IAKE,UAAU,EAAC,QALb;IAME,UAAU,iBAAUG,SAAV,eAAwBA,SAAxB,eAAsCA,SAAtC,eAAoDD,OAApD,MANZ;IAOE,KAAK,EAAC,MAPR;IAQE,MAAM,EAAC,MART;IASE,MAAM,EAAE;EATV,GAUMH,KAVN,EADF;AAcD,CAnBD;;AA2BAH,gBAAgB,CAACQ,YAAjB,GAAgC;EAC9BP,cAAc,EAAE;AADc,CAAhC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,yDAAeD,gBAAf;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3CA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;AACA,IAAMuB,QAAQ,GAAGR,wEAAM,CAACJ,iFAAD,CAAT;EAAA;EAAA;AAAA,0IAAd;AAaA;;AACA,IAAMa,UAAU,GAAGT,wEAAM,CAACI,+DAAD,CAAT;EAAA;EAAA;AAAA,mGAKDC,+DALC,CAAhB;AAQA,IAAMK,QAAQ,GAAGb,2DAAc,CAAC;EAC9Bc,kBAAkB,EAAE;IAClBC,EAAE,iCADgB;IAElBC,cAAc;MAAA;MAAA;IAAA;EAFI;AADU,CAAD,CAA/B;AAOA;AACA;AACA;AACA;AACA;;IACMC;;;;;;;;;;;;;;;;0WA8CI;MAAEC,SAAS,EAAE,KAAb;MAAoBC,KAAK,EAAE,EAA3B;MAA+BC,SAAS,EAAE;IAA1C;;iXAYO,YAAM;MACnB,MAAKC,QAAL,CAAc;QAAEH,SAAS,EAAE,IAAb;QAAmBC,KAAK,EAAE,kDAAI,MAAK5B,KAAL,CAAW+B,MAAf,EAAuB,MAAK/B,KAAL,CAAWgC,KAAlC;MAA1B,CAAd;IACD;;kXAEe,UAAAC,SAAS,EAAI;MAC3B,kBAAsD,MAAKjC,KAA3D;MAAA,IAAQkC,oBAAR,eAAQA,oBAAR;MAAA,IAA8BC,IAA9B,eAA8BA,IAA9B;MAAA,IAAoCJ,MAApC,eAAoCA,MAApC;MAAA,IAA4CC,KAA5C,eAA4CA,KAA5C;;MACA,IAAI,CAACC,SAAD,IAAcC,oBAAlB,EAAwC;QACtC,IAAME,OAAO,GAAG,kDAAIL,MAAJ,EAAYC,KAAZ,MAAuB,MAAKK,KAAL,CAAWT,KAAlD;;QACA,IAAIQ,OAAO,IAAI,CAACE,OAAO,CAACH,IAAI,CAACI,aAAL,CAAmBjB,QAAQ,CAACC,kBAA5B,CAAD,CAAvB,EAA0E;UACxE;QACD;MACF;;MAED,MAAKO,QAAL,CAAc;QAAEH,SAAS,EAAE;MAAb,CAAd;;MAEA,IAAI,MAAK3B,KAAL,CAAWwC,aAAf,EAA8B;QAC5B,MAAKxC,KAAL,CAAWwC,aAAX;MACD;IACF;;6WAEU,UAAAZ,KAAK,EAAI;MAClB,MAAKE,QAAL,CAAc;QAAEF,KAAK,EAALA;MAAF,CAAd;IACD;;;;;;;WAhCD,4BAAmBa,QAAnB,EAA6B;MAC3B,IAAIA,QAAQ,CAACd,SAAT,KAAuB,KAAK3B,KAAL,CAAW2B,SAAtC,EAAiD;QAC/C,IAAI,KAAK3B,KAAL,CAAW2B,SAAf,EAA0B;UACxB,KAAKG,QAAL,CAAc;YAAEH,SAAS,EAAE,IAAb;YAAmBC,KAAK,EAAE,kDAAI,KAAK5B,KAAL,CAAW+B,MAAf,EAAuB,KAAK/B,KAAL,CAAWgC,KAAlC;UAA1B,CAAd;QACD,CAFD,MAEO;UACL,KAAKF,QAAL,CAAc;YAAEH,SAAS,EAAE;UAAb,CAAd;QACD;MACF;IACF;;;WA0BD,uBAAcK,KAAd,EAAqBU,OAArB,EAA8BC,KAA9B,EAAqCC,WAArC,EAAkDC,QAAlD,EAA4D;MAC1D,IAAIA,QAAJ,EAAc;QACZ,OAAOA,QAAQ,CAAC;UACdF,KAAK,EAALA,KADc;UAEdhB,SAAS,EAAE,KAFG;UAGdmB,YAAY,EAAE,KAAKA,YAHL;UAIdN,aAAa,EAAE,KAAKA,aAJN;UAKdO,QAAQ,EAAE,KAAKC;QALD,CAAD,CAAf;MAOD,CARD,MAQO,IAAI,CAACL,KAAL,EAAY;QACjB,OAAOD,OAAO,IAAIE,WAAX,gBACL,wDAAC,+DAAD;UAAc,UAAU,EAAC,OAAzB;UAAiC,OAAO,EAAE,KAAKE,YAA/C;UAA6D,yCAAgCd,KAAhC,CAA7D;UAAA,UACGY;QADH,EADK,GAIH,IAJJ;MAKD,CANM,MAMA;QACL,oBAAO;UAAA,UAAOD;QAAP,EAAP;MACD;IACF;;;WAED,kBAAS;MAAA;;MACP,mBAYI,KAAK3C,KAZT;MAAA,IACEgC,KADF,gBACEA,KADF;MAAA,IAEED,MAFF,gBAEEA,MAFF;MAAA,IAGEkB,QAHF,gBAGEA,QAHF;MAAA,IAIEP,OAJF,gBAIEA,OAJF;MAAA,IAKEQ,gBALF,gBAKEA,gBALF;MAAA,IAMEC,YANF,gBAMEA,YANF;MAAA,IAOEP,WAPF,gBAOEA,WAPF;MAAA,IAQEC,SARF,gBAQEA,QARF;MAAA,IASEO,OATF,gBASEA,OATF;MAAA,IAUEC,eAVF,gBAUEA,eAVF;MAAA,IAWEnB,oBAXF,gBAWEA,oBAXF;MAaA,kBAA6B,KAAKG,KAAlC;MAAA,IAAQT,KAAR,eAAQA,KAAR;MAAA,IAAeD,SAAf,eAAeA,SAAf;MACA,IAAQ2B,eAAR,GAA4B,KAAKtD,KAAjC,CAAQsD,eAAR;;MACA,IAAMX,KAAK,GAAG,kDAAIZ,MAAJ,EAAYC,KAAZ,CAAd;;MACA,IAAMuB,OAAO,GAAG3B,KAAK,KAAKe,KAA1B;MACA,IAAMa,OAAO,GAAG,CAAC,KAAKxD,KAAL,CAAWyD,QAAZ,GAAuBF,OAAvB,GAAiCA,OAAO,IAAIG,OAAO,CAAC9B,KAAD,CAAnE;;MAEA,IAAI,CAACD,SAAL,EAAgB;QACd,oBACE,yDAAC,4DAAD;UAAW,QAAQ,EAAC,UAApB;UAAA,WACGe,OAAO,IAAIS,YAAX,iBACC,wDAAC,4DAAD;YAAW,QAAQ,EAAC,UAApB;YAA+B,GAAG,EAAEC,OAApC;YAA6C,KAAK,EAAE,CAAC,CAArD;YAAwD,MAAM,EAAE,CAAhE;YAAA,uBACE,wDAAC,QAAD;cAAU,IAAI,EAAE,EAAhB;cAAoB,OAAO,EAAE,KAAKN,YAAlC;cAAgD,6CAAoCd,KAApC;YAAhD;UADF,EAFJ,EAMG,KAAK2B,aAAL,CAAmB3B,KAAnB,EAA0BU,OAA1B,EAAmCC,KAAnC,EAA0CC,WAA1C,EAAuDC,SAAvD,CANH;QAAA,EADF;MAUD,CAXD,MAWO;QACL,oBACE,wDAAC,uEAAD;UAAsB,iBAAiB,EAAEX,oBAAoB,IAAIsB,OAAjE;UAAA,uBACE,wDAAC,+EAAD;YAAU,QAAQ,EAAEP;UAApB,GAAkCI,eAAlC;YAAA,UACG,kBAACO,WAAD;cAAA,IAAgBC,OAAhB,QAAgBA,OAAhB;cAAA,IAAyBC,KAAzB,QAAyBA,KAAzB;cAAA,oBACC,yDAAC,2CAAD;gBAAA,WACGjB,SAAQ,GACPA,SAAQ,CAAC;kBACPlB,SAAS,EAAE,IADJ;kBAEPgB,KAAK,EAAEf,KAFA;kBAGPmC,SAAS,EAAE,MAAI,CAAC/D,KAAL,CAAW+D,SAHf;kBAIPhB,QAAQ,EAAE,MAAI,CAACC,QAJR;kBAKPF,YAAY,EAAE,MAAI,CAACA,YALZ;kBAMPN,aAAa,EAAE,MAAI,CAACA,aANb;kBAOPwB,YAAY,EAAE,sBAAAnC,SAAS;oBAAA,OAAI,MAAI,CAACC,QAAL,CAAc;sBAAED,SAAS,EAATA;oBAAF,CAAd,CAAJ;kBAAA;gBAPhB,CAAD,CADD,gBAWP,wDAAC,iEAAD;kBACE,QAAQ,MADV;kBAEE,SAAS,MAFX;kBAGE,KAAK,EAAE,CAHT;kBAIE,KAAK,EAAED,KAAK,IAAI,EAJlB;kBAKE,QAAQ,EAAE,kBAAAqC,CAAC;oBAAA,OAAI,MAAI,CAACjB,QAAL,CAAciB,CAAC,CAACC,MAAF,CAASvB,KAAvB,CAAJ;kBAAA,CALb;kBAME,EAAE,EAAE,CANN;kBAOE,EAAE,EAAE,CAPN;kBAQE,MAAM,EAAC,GART;kBASE,aAAa,EAAC,SAThB;kBAUE,QAAQ,EAAC,SAVX;kBAWE,UAAU,EAAC,SAXb;kBAYE,UAAU,EAAC,SAZb;kBAaE,SAAS,EAAE,MAAI,CAAC3C,KAAL,CAAW+D,SAbxB;kBAcE,8CAAqC/B,KAArC,CAdF;kBAeE,WAAW;gBAfb,EAZJ,eA8BE,yDAAC,iDAAD;kBAAK,KAAK,EAAE,CAAZ;kBAAA,WACG8B,KAAK,iBACJ,wDAAC,6DAAD;oBAAY,IAAI,EAAC,OAAjB;oBAAyB,EAAE,EAAE,CAA7B;oBAAgC,QAAQ,EAAC,MAAzC;oBAAgD,UAAU,EAAC,MAA3D;oBAAkE,UAAU,EAAC,QAA7E;oBAAsF,QAAQ,MAA9F;oBAAA,UACGA,KAAK,CAACK;kBADT,EAFJ,eAME,yDAAC,kDAAD;oBAAM,QAAQ,EAAC,MAAf;oBAAsB,cAAc,EAAC,cAArC;oBAAoD,EAAE,EAAE,CAAxD;oBAAA,wBACE,wDAAC,UAAD;sBACE,WAAQ,4BADV;sBAEE,QAAQ,EAAEN,OAFZ;sBAGE,QAAQ,EAAEP,eAHZ;sBAIE,OAAO,EAAE,MAAI,CAACd,aAJhB;sBAAA,uBAME,wDAAC,4DAAD;wBAAkB,EAAE,eAApB;wBAAmC,cAAc;0BAAA;0BAAA;wBAAA;sBAAjD;oBANF,EADF,eASE,wDAAC,UAAD;sBACE,WAAW,EAAC,SADd;sBAEE,OAAO,EAAEqB,OAFX;sBAGE,QAAQ,EAAE,CAACL,OAAD,IAAY,MAAI,CAACnB,KAAL,CAAWR,SAHnC;sBAIE,WAAQ,0BAJV;sBAKE,QAAQ,EAAEyB,eALZ;sBAME,OAAO,EAAE,mBAAM;wBACb,IAAIc,SAAS,GAAG,IAAhB;;wBACA,IAAIlB,gBAAJ,EAAsB;0BACpBkB,SAAS,GAAGlB,gBAAgB,CAACnB,MAAD,EAASH,KAAT,CAA5B;wBACD,CAFD,MAEO;0BACLwC,SAAS,GAAG,mDAAKrC,MAAL,EAAa,CAAC,IAAD,CAAb,CAAZ;0BACAqC,SAAS,CAACpC,KAAD,CAAT,GAAmBJ,KAAnB;wBACD;;wBAEDgC,WAAW,CAAC;0BAAEQ,SAAS,EAATA;wBAAF,CAAD,CAAX,CAA2BC,IAA3B,CAAgC;0BAAA,OAAM,MAAI,CAAC7B,aAAL,CAAmB,IAAnB,CAAN;wBAAA,CAAhC;sBACD,CAhBH;sBAAA,UAkBG,MAAI,CAACH,KAAL,CAAWR,SAAX,gBACC,wDAAC,4DAAD;wBAAkB,EAAE,2BAApB;wBAA+C,cAAc;0BAAA;0BAAA;wBAAA;sBAA7D,EADD,gBAGC,wDAAC,4DAAD;wBAAkB,EAAE,QAApB;wBAA4B,cAAc;0BAAA;0BAAA;wBAAA;sBAA1C;oBArBJ,EATF;kBAAA,EANF;gBAAA,EA9BF;cAAA,EADD;YAAA;UADH;QADF,EADF;MAgFD;IACF;;;;EAvN2BvB;;uKAAxBoB,iCAwCkB;EACpByB,YAAY,EAAE,IADM;EAEpBG,eAAe,EAAE,GAFG;EAGpBF,OAAO,EAAE,CAAC;AAHU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkLxB,yDAAezC,iEAAU,CAACe,eAAD,CAAzB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7QA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AAEA,IAAMsD,mBAAmB,GAAGpE,kGAAH;EAAA;EAAA;AAAA,slDACrB,UAAAZ,KAAK;EAAA,OACLA,KAAK,CAACkF,WAAN,IACAZ,kEAAG,CAAC;IACFa,MAAM,EAAE,WADN;IAEFC,WAAW,EAAE,CAACpF,KAAK,CAAC8D,KAAP,GAAe,WAAf,GAA6B,SAFxC;IAGFuB,YAAY,EAAE,EAHZ;IAIFC,OAAO,EAAE;EAJP,CAAD,CAFE;AAAA,CADgB,EAgBnBX,8FAhBmB,EAoBnB,UAAA3E,KAAK;EAAA,OAAI0D,OAAO,CAAC1D,KAAK,CAACuF,eAAP,CAAP,IAAkCjB,kEAAG,CAAC;IAAEkB,SAAS,EAAE;EAAb,CAAD,CAAzC;AAAA,CApBc,EAuBnB,UAAAxF,KAAK;EAAA,OACL,CAACA,KAAK,CAACkF,WAAP,IACAZ,kEAAG,CAAC;IACFmB,OAAO,EAAE,CAACzF,KAAK,CAAC8D,KAAP,GAAe,MAAf,wBAAsC9D,KAAK,CAAC0F,KAAN,CAAYC,MAAZ,CAAmBC,GAAnB,CAAuB,GAAvB,CAAtC,CADP;IAEF,WAAW;MACTH,OAAO,uBAAgBzF,KAAK,CAAC0F,KAAN,CAAYC,MAAZ,CAAmBE,KAAnB,CAAyB,GAAzB,CAAhB;IADE;EAFT,CAAD,CAFE;AAAA,CAvBc,EAkCV,UAAA7F,KAAK;EAAA,OAAIA,KAAK,CAAC0F,KAAN,CAAYC,MAAZ,CAAmBE,KAAnB,CAAyB,GAAzB,CAAJ;AAAA,CAlCK,EA0CnB,UAAA7F,KAAK;EAAA,OACLsE,kEAAG,CAAC;IACFwB,SAAS,EAAE9F,KAAK,CAAC+F,eADf;IAEFC,SAAS,EAAEhG,KAAK,CAACuF;EAFf,CAAD,CADE;AAAA,CA1Cc,EAmDP,UAAAvF,KAAK;EAAA,OAAIA,KAAK,CAACiG,sBAAV;AAAA,CAnDE,EAoDnB,UAAAjG,KAAK;EAAA,OAAI,CAACA,KAAK,CAACkF,WAAP,sDAAJ;AAAA,CApDc,EAuDnB,UAAAlF,KAAK;EAAA,OAAIA,KAAK,CAACkF,WAAN,wCAAJ;AAAA,CAvDc,EAsEH,UAAAlF,KAAK;EAAA,OAAIA,KAAK,CAAC0F,KAAN,CAAYC,MAAZ,CAAmBO,IAAnB,CAAwB,GAAxB,CAAJ;AAAA,CAtEF,EA0EH,UAAAlG,KAAK;EAAA,OAAIA,KAAK,CAAC0F,KAAN,CAAYC,MAAZ,CAAmBO,IAAnB,CAAwB,GAAxB,CAAJ;AAAA,CA1EF,EAoFnB,UAAAlG,KAAK;EAAA,OACLA,KAAK,CAACmG,OAAN,KAAkB,YAAlB,IACA7B,kEAAG,CAAC;IACF,kCAAkC;MAChC8B,OAAO,EAAE;IADuB,CADhC;IAIF,wHACE;MACEA,OAAO,EAAE;IADX,CALA;IAQF,kCAAkC;MAChCC,UAAU,EAAE;IADoB;EARhC,CAAD,CAFE;AAAA,CApFc,EA8GnB,UAAArG,KAAK;EAAA,OACLA,KAAK,CAACsG,iBAAN,IACAhC,kEAAG,CAAC;IACFiC,QAAQ,EAAE,QADR;IAEFC,GAAG,EAAExG,KAAK,CAACyG,UAAN,IAAoB,CAFvB;IAGFC,SAAS,EAAE1G,KAAK,CAAC2G,cAHf;IAIFC,CAAC,EAAE;EAJD,CAAD,CAFE;AAAA,CA9Gc,EAqIrB,UAAA5G,KAAK;EAAA,OACLA,KAAK,CAAC6G,UAAN,IACAvC,kEAAG,CAAC;IACFwC,aAAa,EAAE,MADb;IAEFC,MAAM,EAAE,aAFN;IAGFC,UAAU,EAAE,SAHV;IAIF,mCAAmC;MACjCA,UAAU,EAAE;IADqB;EAJjC,CAAD,CAFE;AAAA,CArIgB,CAAzB;AAiJA,IAAMC,sBAAsB,GAAG;EAAEC,OAAO,EAAE,yCAAX;EAAsDC,QAAQ,EAAE;AAAhE,CAA/B;AAEA;AACA;AACA;AACA;;IACqBC;;;;;EAyDnB,wBAAYpH,KAAZ,EAAmB;IAAA;;IAAA;;IACjB,0BAAMA,KAAN;;IADiB,2WA2CN,YAAM;MACjB,IAAI,MAAKqH,IAAL,IAAa,MAAKC,SAAL,CAAeC,OAAhC,EAAyC;QACvC;QACA,MAAKD,SAAL,CAAeC,OAAf,CAAuBC,gBAAvB,CAAwC,aAAxC,EAAuD,MAAKC,YAA5D,EAA0E,KAA1E;;QACA,MAAKH,SAAL,CAAeC,OAAf,CAAuBC,gBAAvB,CAAwC,qBAAxC,EAA+D,MAAKE,YAApE;;QACA,MAAKJ,SAAL,CAAeC,OAAf,CAAuBC,gBAAvB,CAAwC,kBAAxC,EAA4D,MAAKG,gBAAjE;;QACA,MAAKL,SAAL,CAAeC,OAAf,CAAuBC,gBAAvB,CAAwC,oBAAxC,EAA8D,MAAKI,gBAAnE;;QACA,MAAKN,SAAL,CAAeC,OAAf,CAAuBC,gBAAvB,CAAwC,iBAAxC,EAA2D,UAAAK,KAAK,EAAI;UAClE,IAAI,MAAK7H,KAAL,CAAW8H,iBAAf,EAAkC;YAChC,MAAKC,sBAAL,CAA4B,MAAK/H,KAAL,CAAW2C,KAAX,IAAoB,MAAK3C,KAAL,CAAWgI,YAA3D;;YACA,MAAKC,SAAL,CAAeJ,KAAf;UACD,CAJiE,CAKlE;;;UACA,IAAI,MAAKK,gBAAL,CAAsBX,OAA1B,EAAmC;YACjC;YACA,IAAMY,SAAS,GAAG,MAAKD,gBAAL,CAAsBX,OAAtB,CAA8Ba,aAA9B,CAA4C,gCAA5C,CAAlB;;YACAD,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAEX,gBAAX,CAA4B,SAA5B,EAAuC,UAAAvD,CAAC,EAAI;cAC1C,IAAIA,CAAC,CAACoE,GAAF,KAAU,OAAd,EAAuB;gBACrB,MAAKC,UAAL;cACD;YACF,CAJD;;YAMA,IAAMC,UAAU,GAAG,MAAKL,gBAAL,CAAsBX,OAAtB,CAA8Ba,aAA9B,CAA4C,mCAA5C,CAAnB;;YACAG,UAAU,SAAV,IAAAA,UAAU,WAAV,YAAAA,UAAU,CAAEf,gBAAZ,CAA6B,OAA7B,EAAsC,MAAKc,UAA3C;UACD;QACF,CAlBD,EANuC,CA0BvC;;;QACA,MAAKE,OAAL,GAAe,IAAf;MACD;IACF,CAzEkB;;IAAA,uXA6EM,UAAA7F,KAAK,EAAI;MAChC,IAAM8F,WAAW,GAAG,IAAIC,MAAJ,sBAAgC,IAAhC,CAApB;MACA,IAAIC,KAAJ;MACA,IAAIC,SAAS,GAAG,CAAhB;;MAEA,OAAQD,KAAK,GAAGF,WAAW,CAACI,IAAZ,CAAiBlG,KAAjB,CAAhB,EAA0C;QACxC,IAAIiG,SAAS,KAAK,CAAlB,EAAqB;UACnB,MAAKE,SAAL,GAAiBC,QAAjB,CAA0B,EAA1B;QACD;;QACD,IAAMC,MAAM,GAAGL,KAAK,CAAC,CAAD,CAApB;QACA,IAAMpC,QAAQ,GAAGoC,KAAK,CAACM,KAAvB;QACA,IAAMC,OAAO,GAAGvG,KAAK,CAACwG,SAAN,CAAgBP,SAAhB,EAA2BrC,QAA3B,CAAhB;;QACA,MAAKuC,SAAL,GAAiBM,gBAAjB,CAAkC,CAACR,SAAD,EAAYrC,QAAZ,CAAlC;;QACA,MAAKuC,SAAL,GAAiBO,UAAjB,CAA4BH,OAA5B;;QACA,IAAMI,UAAU,GAAG,IAAI,MAAKjC,IAAL,CAAUkC,UAAd,CAAyB;UAAEC,OAAO,EAAER;QAAX,CAAzB,CAAnB;;QACA,MAAKF,SAAL,GAAiBW,gBAAjB,CAAkCH,UAAlC;;QACAV,SAAS,GAAGD,KAAK,CAACM,KAAN,GAAcD,MAAM,CAACU,MAAjC;QACA,IAAMC,QAAQ,GAAGhH,KAAK,CAACwG,SAAN,CAAgBP,SAAhB,EAA2BjG,KAAK,CAAC+G,MAAjC,CAAjB;;QACA,MAAKZ,SAAL,GAAiBO,UAAjB,CAA4BM,QAA5B;MACD;IACF,CAjGkB;;IAAA,0WAmGP,UAAA1F,CAAC,EAAI;MACf,IAAM2F,gBAAgB,oMAAtB;MACA,IAAMC,gBAAgB,6sBAAtB;MAUA,IAAQC,cAAR,GAA2B7F,CAAC,CAACC,MAA7B,CAAQ4F,cAAR;MACA,IAAMC,iBAAiB,GAAGD,cAAc,CAAC1B,aAAf,CAA6B,gCAA7B,CAA1B;MACA2B,iBAAiB,CAACC,kBAAlB,CAAqC,UAArC,EAAiDJ,gBAAjD;MACA,IAAMK,UAAU,GAAGH,cAAc,CAAC1B,aAAf,CAA6B,oBAA7B,CAAnB;MACA6B,UAAU,CAACD,kBAAX,CAA8B,UAA9B,EAA0CH,gBAA1C;IACD,CApHkB;;IAAA,iXAsHA,UAAA5F,CAAC,EAAI;MACtB,IAAQ6F,cAAR,GAA2B7F,CAAC,CAACC,MAA7B,CAAQ4F,cAAR;;MACA,IAAI7F,CAAC,CAACiG,UAAF,KAAiB,qBAArB,EAA4C;QAC1C,IAAMC,iBAAiB,GAAGL,cAAc,CAAC1B,aAAf,CAA6B,8BAA7B,CAA1B;QACA,IAAMgC,sBAAsB,GAAGN,cAAc,CAAC1B,aAAf,CAA6B,2BAA7B,CAA/B;;QACA,IAAI+B,iBAAiB,CAACE,YAAlB,CAA+B,kBAA/B,MAAuD,EAA3D,EAA+D;UAC7DF,iBAAiB,CAACG,eAAlB,CAAkC,kBAAlC;QACD,CAFD,MAEO;UACLH,iBAAiB,CAACI,YAAlB,CAA+B,kBAA/B,EAAmD,EAAnD;UACAH,sBAAsB,CAACE,eAAvB,CAAuC,UAAvC;QACD;MACF,CATD,MASO,IAAIrG,CAAC,CAACiG,UAAF,KAAiB,aAArB,EAAoC;QAAA;;QACzC,IAAMM,SAAS,4BAAGV,cAAc,CAAC1B,aAAf,CAA6B,2BAA7B,EAA0DzF,KAA7D,0DAAG,sBAAiE8H,IAAjE,EAAlB;;QACA,IAAID,SAAJ,EAAe;UACb,MAAKE,WAAL,CAAiBF,SAAjB;QACD;MACF;IACF,CAvIkB;;IAAA,uXAyIM,UAACG,OAAD,EAAUnJ,EAAV,EAAiB;MACxC,IAAImJ,OAAO,KAAK,SAAhB,EAA2B;QACzB,iBAAU1D,sBAAsB,CAACC,OAAjC,SAA2C1F,EAA3C;MACD;MAAC;AACN;AACA;MAJI,KAIU,IAAImJ,OAAO,KAAK,UAAhB,EAA4B;QACpC,iBAAU1D,sBAAsB,CAACE,QAAjC,SAA4C3F,EAA5C;MACD,CAFS,MAEH;QACL,OAAO,IAAP;MACD;IACF,CAnJkB;;IAAA,iXAqJA,UAAAoJ,SAAS,EAAI;MAC9B,IAAMC,OAAO,GAAG;QACdC,OAAO,EAAE,IAAIpC,MAAJ,CACP,8HADO,EAEP,GAFO,CADK;QAKdqC,KAAK,EAAE,IAAIrC,MAAJ,CACL,mGADK,CALO;QAQdvB,QAAQ,EAAE;MARI,CAAhB;;MAUA,KAAK,IAAMwD,OAAX,IAAsBE,OAAtB,EAA+B;QAC7B,IAAMG,OAAO,GAAGH,OAAO,CAACF,OAAD,CAAP,CAAiB9B,IAAjB,CAAsB+B,SAAtB,CAAhB;;QACA,IAAII,OAAJ,EAAa;UACX,IAAIL,OAAO,KAAK,UAAhB,EAA4B;YAC1B,IAAMM,WAAW,GAAGD,OAAO,CAAC,CAAD,CAA3B;YACA,IAAME,SAAS,GAAGF,OAAO,CAAC,CAAD,CAAzB;YACA,IAAMG,UAAU,aAAMF,WAAN,WAAhB;YACA,OAAO;cAAEN,OAAO,EAAPA,OAAF;cAAWnJ,EAAE,EAAE0J,SAAS,aAAMC,UAAN,uBAA6BD,SAA7B,IAA2CC;YAAnE,CAAP;UACD,CALD,MAKO;YACL,OAAO;cAAER,OAAO,EAAPA,OAAF;cAAWnJ,EAAE,EAAEwJ,OAAO,CAACA,OAAO,CAACtB,MAAR,GAAiB,CAAlB;YAAtB,CAAP;UACD;QACF;MACF;;MACD,OAAO,EAAP;IACD,CA9KkB;;IAAA,4WAgLL,UAAAkB,SAAS,EAAI;MACzB,4BAAwB,MAAKQ,gBAAL,CAAsBR,SAAtB,CAAxB;MAAA,IAAQpJ,EAAR,yBAAQA,EAAR;MAAA,IAAYmJ,OAAZ,yBAAYA,OAAZ;;MACA,IAAMH,SAAS,GAAG,MAAKa,sBAAL,CAA4BV,OAA5B,EAAqCnJ,EAArC,CAAlB;;MACA,IAAIgJ,SAAJ,EAAe;QACb,IAAMc,aAAa,GAAGd,SAAS,CAACe,OAAV,CAAkB,QAAlB,EAA4B,EAA5B,CAAtB,CADa,CAC0C;;QACvD,IAAMC,aAAa,GAAG,CAAC,SAAD,EAAY,OAAZ,CAAtB;QACA,IAAIC,cAAJ;;QACA,IAAID,aAAa,CAACE,QAAd,CAAuBf,OAAvB,CAAJ,EAAqC;UACnCc,cAAc,GAAG;YACfE,WAAW,EAAE,sBADE;YAEfnC,OAAO,0BAAkB8B,aAAlB;UAFQ,CAAjB;QAID,CALD,MAKO;UACLG,cAAc,GAAG;YACfE,WAAW,2BAAoBhB,OAApB,CADI;YAEfnB,OAAO,0BAAkB8B,aAAlB;UAFQ,CAAjB;QAID;;QAED,MAAKxC,SAAL,GAAiBW,gBAAjB,CAAkC,IAAI,MAAKpC,IAAL,CAAUkC,UAAd,CAAyBkC,cAAzB,CAAlC;MACD;IACF,CArMkB;;IAAA,6WAuMJ,UAAAxH,CAAC,EAAI;MAClB;MACA,MAAK2H,QAAL,GAFkB,CAIlB;;;MACA,IAAI,MAAK5L,KAAL,CAAW6L,QAAf,EAAyB;QACvB,MAAK7L,KAAL,CAAW6L,QAAX,CAAoB5H,CAApB;MACD,CAPiB,CASlB;;;MACA,IAAI,MAAK5B,KAAL,CAAWyB,KAAf,EAAsB;QACpB,MAAKhC,QAAL,CAAc;UAAEgC,KAAK,EAAE;QAAT,CAAd;MACD;IACF,CApNkB;;IAAA,iXAsNA,UAAAG,CAAC,EAAI;MACtB,IAAI,CAAC,WAAW6H,IAAX,CAAgB7H,CAAC,CAAC8H,IAAF,CAAOC,IAAvB,CAAL,EAAmC;QACjCC,KAAK,CAAC,6BAAD,CAAL;QACAhI,CAAC,CAACiI,cAAF;MACD,CAHD,MAGO,IAAIjI,CAAC,CAAC8H,IAAF,CAAOI,IAAP,GAAc,OAAlB,EAA2B;QAChC;QACAF,KAAK,CAAC,kCAAD,CAAL;QACAhI,CAAC,CAACiI,cAAF;MACD;IACF,CA/NkB;;IAAA,6WAiOJ,UAAAjI,CAAC,EAAI;MAAA;;MAClB,IAAQqF,UAAR,GAAuBrF,CAAvB,CAAQqF,UAAR;;MACA,IAAM8C,iBAAiB,GAAG,kDAAI9C,UAAJ,EAAgB,sCAAhB,CAA1B;;MACA,IAAM+C,iBAAiB,GACrB,CAAAD,iBAAiB,SAAjB,IAAAA,iBAAiB,WAAjB,YAAAA,iBAAiB,CAAEV,QAAnB,yBAA4CzE,sBAAsB,CAACC,OAAnE,QACAkF,iBADA,aACAA,iBADA,uBACAA,iBAAiB,CAAEV,QAAnB,yBAA4CzE,sBAAsB,CAACE,QAAnE,EADA,CADF;;MAGA,IAAIkF,iBAAJ,EAAuB;QACrB;MACD,CAFD,MAEO,IAAI,CAAC/C,UAAU,CAACyC,IAAhB,EAAsB;QAC3BzC,UAAU,CAACgD,MAAX,GAD2B,CACN;;QACrB;MACD;;MAED,8CAAKtM,KAAL,EAAWgE,YAAX,kGAA0B,IAA1B;;MAEA,IAAMuI,UAAU,GAAG,SAAbA,UAAa,CAAAC,QAAQ;QAAA,OAAIlD,UAAU,CAACmD,iBAAX,CAA6BD,QAA7B,CAAJ;MAAA,CAA3B;;MACA,IAAME,SAAS,GAAG,SAAZA,SAAY,CAAAC,OAAO,EAAI;QAAA;;QAC3B,gDAAK3M,KAAL,EAAWgE,YAAX,qGAA0B,KAA1B;QACAsF,UAAU,CAACsD,aAAX,CAAyB;UAAEC,GAAG,EAAEF,OAAP;UAAgBG,IAAI,EAAEH;QAAtB,CAAzB;MACD,CAHD;;MAIA,IAAMI,SAAS,GAAG,SAAZA,SAAY,GAAM;QAAA;;QACtB,gDAAK/M,KAAL,EAAWgE,YAAX,qGAA0B,KAA1B;;QACA,MAAKlC,QAAL,CAAc;UAAEgC,KAAK,EAAE;QAAT,CAAd;;QACAwF,UAAU,CAACgD,MAAX;MACD,CAJD;;MAKA5H,sEAAkB,CAAC4E,UAAU,CAACyC,IAAZ,EAAkB,MAAK/L,KAAL,CAAWgN,IAA7B,EAAmC;QAAET,UAAU,EAAVA,UAAF;QAAcG,SAAS,EAATA,SAAd;QAAyBK,SAAS,EAATA;MAAzB,CAAnC,CAAlB;MACA,OAAO9I,CAAP;IACD,CA5PkB;;IAAA,2WA8PN,YAAM;MAAA;;MACjB,IAAMgJ,QAAQ,4BAAG,MAAK/E,gBAAL,CAAsBX,OAAzB,0DAAG,sBAA+Ba,aAA/B,CAA6C,gCAA7C,CAAjB;MACA,IAAM8E,aAAa,GAAGD,QAAH,aAAGA,QAAH,0CAAGA,QAAQ,CAAEtK,KAAb,oDAAG,gBAAiB8H,IAAjB,EAAtB,CAFiB,CAIjB;;MACA,IAAI,CAACyC,aAAL,EAAoB;QAClB;MACD,CAPgB,CASjB;MACA;;;MACA,IAAIzI,iDAAK,CAACyI,aAAD,EAAgB;QAAEC,gBAAgB,EAAE;MAApB,CAAhB,CAAL,IAAqD,CAAC1I,iDAAK,CAACyI,aAAD,EAAgB;QAAEC,gBAAgB,EAAE;MAApB,CAAhB,CAA/D,EAA4G;QAC1GF,QAAQ,CAACtK,KAAT,qBAA4BuK,aAA5B;MACD;IACF,CA5QkB;;IAAA,kXA4SC,UAAAL,GAAG,EAAI;MACzB,IAAIO,qBAAqB,GAAGP,GAAG,CAACnD,MAAhC;;MAEA,OAAO0D,qBAAqB,GAAG,CAA/B,EAAkC;QAChC,IAAMC,kBAAkB,GAAGD,qBAAqB,GAAG,CAAnD;QACA,IAAME,WAAW,GAAGT,GAAG,CAACQ,kBAAD,CAAvB;QAEA,IAAIE,WAAW,SAAf;;QACA,IAAID,WAAW,KAAK,GAApB,EAAyB;UACvBC,WAAW,GAAG,GAAd;QACD,CAFD,MAEO,IAAID,WAAW,KAAK,GAApB,EAAyB;UAC9BC,WAAW,GAAG,GAAd;QACD,CAFM,MAEA,IAAID,WAAW,KAAK,GAApB,EAAyB;UAC9BC,WAAW,GAAG,GAAd;QACD,CAFM,MAEA,IAAID,WAAW,KAAK,GAApB,EAAyB;UAC9BC,WAAW,GAAG,GAAd;QACD,CAFM,MAEA,IAAID,WAAW,KAAK,GAApB,EAAyB;UAC9BC,WAAW,GAAG,GAAd;QACD,CAf+B,CAiBhC;;;QACA,IAAI,YAAY7B,QAAZ,CAAqBmB,GAAG,CAACQ,kBAAD,CAAxB,CAAJ,EAAmD;UACjDD,qBAAqB;QACtB,CAFD,MAEO,IAAIG,WAAJ,EAAiB;UACtB,IAAIC,OAAO,GAAG,CAAd;UAAA,IACEC,OAAO,GAAG,CADZ;UAGA;AACR;AACA;AACA;AACA;;UAEQ,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,qBAApB,EAA2CM,CAAC,EAA5C,EAAgD;YAC9C,IAAIb,GAAG,CAACa,CAAD,CAAH,KAAWH,WAAf,EAA4B;cAC1BC,OAAO;YACR,CAFD,MAEO,IAAIX,GAAG,CAACa,CAAD,CAAH,KAAWJ,WAAf,EAA4B;cACjCG,OAAO;YACR;UACF;;UAED,IAAID,OAAO,IAAIC,OAAf,EAAwB;YACtB;UACD;;UAEDL,qBAAqB;QACtB,CAvBM,MAuBA;UACL;QACD;MACF;;MAED,OAAOA,qBAAP;IACD,CAhWkB;;IAEjB,MAAK9F,SAAL,gBAAiB3H,4CAAA,EAAjB;IACA,MAAKuI,gBAAL,gBAAwBvI,4CAAA,EAAxB;IACA,MAAK0C,KAAL,GAAa;MAAEb,EAAE,EAAExB,KAAK,CAACwB,EAAZ;MAAgBsC,KAAK,EAAE;IAAvB,CAAb;IACA,MAAK0E,OAAL,GAAe,KAAf;;IAEA,IAAI,MAA+B;MACjC,MAAKnB,IAAL,GAAYuG,mBAAO,CAAC,KAAD,CAAnB;MACA,MAAKvG,IAAL,CAAUwG,MAAV,CAAiBC,eAAjB,CAAiCC,QAAjC,GAA4C;QAAEC,OAAO,EAAE;MAAX,CAA5C;MACA,MAAK3G,IAAL,CAAUwG,MAAV,CAAiBI,WAAjB,CAA6BC,OAA7B,CAAqCC,OAArC,GAA+C;QAAEC,IAAI,EAAE,KAAR;QAAejC,IAAI,EAAE;MAArB,CAA/C;IACD;;IAXgB;EAYlB;;;;WAED,6BAAoB;MAClB,IAAI,CAAC,KAAK9J,KAAL,CAAWb,EAAhB,EAAoB;QAClB,KAAKM,QAAL,CAAc;UAAEN,EAAE,EAAEgD,0DAAI;QAAV,CAAd;MACD,CAFD,MAEO,IAAI,CAAC,KAAKgE,OAAV,EAAmB;QACxB,KAAK6F,UAAL;MACD;IACF;;;WAED,4BAAmB5L,QAAnB,EAA6B;MAC3B,IAAI,CAAC,KAAK+F,OAAV,EAAmB;QACjB,KAAK6F,UAAL;MACD,CAFD,MAEO,IAAI5L,QAAQ,CAAC6L,KAAT,KAAmB,KAAKtO,KAAL,CAAWsO,KAAlC,EAAyC;QAC9C,KAAKhH,SAAL,CAAeC,OAAf,CAAuBgH,MAAvB,CAA8BxF,QAA9B,CAAuC,EAAvC;MACD;IACF;;;WAED,gCAAuB;MACrB,IAAI,KAAKP,OAAT,EAAkB;QAChB,KAAKlB,SAAL,CAAeC,OAAf,CAAuBiH,mBAAvB,CAA2C,aAA3C,EAA0D,KAAK/G,YAA/D;QACA,KAAKH,SAAL,CAAeC,OAAf,CAAuBiH,mBAAvB,CAA2C,qBAA3C,EAAkE,KAAK9G,YAAvE;QACA,KAAKJ,SAAL,CAAeC,OAAf,CAAuBiH,mBAAvB,CAA2C,qBAA3C,EAAkE,KAAK7G,gBAAvE;QACA,KAAKL,SAAL,CAAeC,OAAf,CAAuBiH,mBAAvB,CAA2C,oBAA3C,EAAiE,KAAK5G,gBAAtE;MACD;IACF;;;WAED,qBAAY;MACV,OAAO,KAAKN,SAAL,CAAeC,OAAf,CAAuBgH,MAA9B;IACD;;;;IAqOD;IACA,oBAAW;MAAA;;MACT,IAAME,SAAS,GAAG,IAAI/F,MAAJ,8BAAwC,IAAxC,CAAlB;MACA,IAAM6F,MAAM,GAAG,KAAKzF,SAAL,EAAf;MACA,IAAMU,OAAO,GAAG+E,MAAM,CAACG,WAAP,GAAqBC,QAArB,EAAhB;MACA,IAAIhG,KAAJ;;MACA,OAAQA,KAAK,GAAG8F,SAAS,CAAC5F,IAAV,CAAeW,OAAf,CAAhB,EAA0C;QACxC,IAAMqD,GAAG,GAAGlE,KAAK,CAAC,CAAD,CAAjB;;QACA,IAAIlE,iDAAK,CAACoI,GAAD,CAAT,EAAgB;UAAA;YACd,IAAMtG,QAAQ,GAAGoC,KAAK,CAACM,KAAvB;;YACA,IAAM2F,SAAS,GAAG,MAAI,CAACC,iBAAL,CAAuBhC,GAAvB,CAAlB;;YACA,IAAMiC,KAAK,GAAG,CAACvI,QAAD,EAAWA,QAAQ,GAAGqI,SAAtB,CAAd;YACA,IAAMG,WAAW,GAAGR,MAAM,CAACG,WAAP,GAAqBM,0BAArB,CAAgDF,KAAhD,EAAuDhC,IAA3E;YACA,IAAMmC,MAAM,GAAGpC,GAAG,CAACqC,KAAJ,CAAU,CAAV,EAAaN,SAAb,CAAf;;YACA,IAAIG,WAAW,KAAKE,MAApB,EAA4B;cAC1B,MAAI,CAACE,aAAL,CAAmBZ,MAAnB,EAA2BO,KAA3B,EAAkC,CAAlC,EAAqC,YAAM;gBACzC,IAAIP,MAAM,CAACa,oBAAP,CAA4B,MAA5B,CAAJ,EAAyC;kBACvCb,MAAM,CAACc,iBAAP,CAAyB,MAAzB,EAAiCJ,MAAjC;gBACD;cACF,CAJD;YAKD;UAZa;QAaf;MACF;IACF;IAED;AACF;AACA;AACA;AACA;;;;;IAuDE;IACA,uBAAcV,MAAd,EAAsBO,KAAtB,EAAqD;MAAA,IAAxBQ,MAAwB,uEAAf,CAAe;MAAA,IAAZC,UAAY;MACnD,IAAMC,SAAS,GAAGjB,MAAM,CAACkB,gBAAP,EAAlB;MACAlB,MAAM,CAACnF,gBAAP,CAAwB0F,KAAxB;MACAS,UAAU;MACVhB,MAAM,CAACnF,gBAAP,CAAwB,CAACoG,SAAS,CAAC,CAAD,CAAT,GAAeF,MAAhB,EAAwBE,SAAS,CAAC,CAAD,CAAT,GAAeF,MAAvC,CAAxB;IACD;IAED;;;;WAEA,kBAAS;MACP,mBAmBI,KAAKtP,KAnBT;MAAA,IACEgI,YADF,gBACEA,YADF;MAAA,IAEE1B,iBAFF,gBAEEA,iBAFF;MAAA,IAGEG,UAHF,gBAGEA,UAHF;MAAA,IAIEE,cAJF,gBAIEA,cAJF;MAAA,IAKEV,sBALF,gBAKEA,sBALF;MAAA,IAMEyJ,SANF,gBAMEA,SANF;MAAA,IAOE9M,WAPF,gBAOEA,WAPF;MAAA,IAQEmD,eARF,gBAQEA,eARF;MAAA,IASEb,WATF,gBASEA,WATF;MAAA,IAUEyK,SAVF,gBAUEA,SAVF;MAAA,IAWEC,QAXF,gBAWEA,QAXF;MAAA,IAYE9L,KAZF,gBAYEA,KAZF;MAAA,IAaE+L,QAbF,gBAaEA,QAbF;MAAA,IAcElN,KAdF,gBAcEA,KAdF;MAAA,IAeEwD,OAfF,gBAeEA,OAfF;MAAA,IAgBE2J,SAhBF,gBAgBEA,SAhBF;MAAA,IAiBE/L,SAjBF,gBAiBEA,SAjBF;MAAA,IAkBEwB,eAlBF,gBAkBEA,eAlBF;MAqBA,OAAO,CAAC,KAAKlD,KAAL,CAAWb,EAAZ,gBACL,wDAAC,qEAAD;QACE,SAAS,EAAE+D,eAAe,GAAGA,eAAe,GAAG,EAArB,GAA0BwK,SADtD;QAEE,MAAM,EAAEhK,eAAe,GAAGA,eAAe,GAAG,EAArB,GAA0B;MAFnD,EADK,gBAML,yDAAC,mBAAD;QACE,iBAAiB,EAAEO,iBADrB;QAEE,UAAU,EAAEG,UAFd;QAGE,cAAc,EAAEE,cAHlB;QAIE,sBAAsB,EAAEV,sBAJ1B;QAKE,eAAe,EAAEF,eALnB;QAME,eAAe,EAAER,eANnB;QAOE,WAAW,EAAEL,WAPf;QAQE,OAAO,EAAEiB,OARX;QASE,UAAU,EAAEyJ,QATd;QAUE,KAAK,EAAE9L,KAVT;QAWE,WAAS,KAAK9D,KAAL,CAAW,SAAX,CAXX;QAYE,GAAG,EAAE,KAAKkI,gBAZZ;QAAA,WAcG,KAAK7F,KAAL,CAAWyB,KAAX,iBACC,wDAAC,6DAAD;UAAY,IAAI,EAAC,OAAjB;UAAyB,EAAE,EAAC,MAA5B;UAAmC,QAAQ,MAA3C;UAAA,UACG,KAAKzB,KAAL,CAAWyB,KAAX,CAAiB6K,QAAjB;QADH,EAfJ,eAmBE;UAAO,EAAE,EAAE,KAAKtM,KAAL,CAAWb,EAAtB;UAA0B,KAAK,EAAEmB,KAAK,IAAIqF,YAA1C;UAAwD,IAAI,EAAC,QAA7D;UAAsE,IAAI,EAAE2H;QAA5E,EAnBF,eAoBE,wDAAC,8DAAD;UAAa,QAAQ,EAAEE,QAAvB;UAAA,UACG,CAACC,SAAD,gBACC;YACE,GAAG,EAAE,KAAKxI,SADZ;YAEE,KAAK,EAAE,KAAKjF,KAAL,CAAWb,EAFpB;YAGE,SAAS,EAAEkO,SAAS,GAAG,IAAH,GAAUK,SAHhC;YAIE,WAAW,EAAEnN;UAJf,EADD,gBAQC,yDAAC,4DAAD;YAAW,QAAQ,EAAC,UAApB;YAAA,wBACE;cACE,GAAG,EAAE,KAAK0E,SADZ;cAEE,KAAK,EAAE,KAAKjF,KAAL,CAAWb,EAFpB;cAGE,SAAS,EAAEkO,SAAS,GAAG,IAAH,GAAUK,SAHhC;cAIE,WAAW,EAAEnN;YAJf,EADF,eAOE,wDAAC,4DAAD;cAAW,QAAQ,EAAC,UAApB;cAA+B,MAAM,EAAC,KAAtC;cAA4C,KAAK,EAAC,KAAlD;cAAA,uBACE,yDAAC,4DAAD;gBAAW,aAAa,EAAC,WAAzB;gBAAA,wBACE;kBAAA,UAAOgC,gEAAS,CAACjC,KAAK,IAAIqF,YAAV,CAAT,CAAiC0B;gBAAxC,EADF,EAEG3F,SAAS,iBAAI;kBAAA,kBAAUA,SAAV;gBAAA,EAFhB;cAAA;YADF,EAPF;UAAA;QATJ,EApBF;MAAA,EANF;IAqDD;;;;EAhfyCpE;;uKAAvByH,gCA8CG;EACpBd,iBAAiB,EAAE,KADC;EAEpBG,UAAU,EAAE,CAFQ;EAGpBE,cAAc,EAAE,CAAC,EAHG;EAGC;EACrBgJ,SAAS,EAAE,SAJS;EAKpB1J,sBAAsB,EAAE,OALJ;EAMpBE,OAAO,EAAE,SANW;EAOpB,WAAW,gBAPS;EAQpB2B,iBAAiB,EAAE;AARC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvNxB;AAEA;AAEA;AACA;AACA;AACA;;;AAEO,IAAMqI,eAAe,GAAG,SAAlBA,eAAkB,OAAiB;EAAA,IAAdC,OAAc,QAAdA,OAAc;EAC9C,oBACE,qBAAC,iBAAD;IAAA,wBACE,oBAAC,gBAAD;MAAK,EAAE,EAAE,CAAT;MAAA,uBACE,oBAAC,6BAAD;QAAgB,UAAU,EAAEA,OAAO,CAACC,WAApC;QAAA,uBACE,oBAAC,sBAAD;UAAQ,UAAU,EAAED,OAAO,CAACC,WAA5B;UAAyC,MAAM,EAAE;QAAjD;MADF;IADF,EADF,eAME,qBAAC,iBAAD;MAAM,aAAa,EAAC,QAApB;MAAA,wBACE,oBAAC,6BAAD;QAAgB,UAAU,EAAED,OAAO,CAACC,WAApC;QAAA,uBACE,oBAAC,MAAD;UAAG,KAAK,EAAC,WAAT;UAAqB,UAAU,EAAC,KAAhC;UAAsC,UAAU,EAAC,MAAjD;UAAwD,gBAAgB,MAAxE;UAAA,UACGD,OAAO,CAACC,WAAR,CAAoBjC;QADvB;MADF,EADF,eAME,oBAAC,MAAD;QAAG,QAAQ,EAAC,MAAZ;QAAmB,KAAK,EAAC,WAAzB;QAAqC,gBAAgB,MAArD;QAAsD,KAAK,EAAEgC,OAAO,CAACE,SAArE;QAAA,uBACE,oBAAC,sBAAD;UACE,EAAE,oBADJ;UAEE,cAAc;YAAA;YAAA;UAAA;YAAA;YAAA;YAAA;UAAA,EAFhB;UAGE,MAAM,EAAE;YAAEA,SAAS,EAAE,IAAIC,IAAJ,CAASH,OAAO,CAACE,SAAjB;UAAb;QAHV;MADF,EANF;IAAA,EANF;EAAA,EADF;AAuBD,CAxBM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACTP;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAEA,IAAMiB,0BAA0B,GAAG3Q,iDAAM,CAACE,iBAAD,CAAT;EAAA;EAAA;AAAA,qLAAhC;AAWA,IAAM0Q,UAAU,GAAG5Q,iDAAM,CAACI,2BAAD,CAAN,CAAqByQ,KAArB,CAA2B;EAAEC,UAAU,EAAE;AAAd,CAA3B,CAAH;EAAA;EAAA;AAAA,+LAAhB;AAiBA;AACA;AACA;;AACA,IAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,OAOrB;EAAA,IANJjP,OAMI,QANJA,OAMI;EAAA,IALJkP,SAKI,QALJA,SAKI;EAAA,IAJJC,sBAII,QAJJA,sBAII;EAAA,IAHJC,MAGI,QAHJA,MAGI;EAAA,IAFJC,mBAEI,QAFJA,mBAEI;EAAA,IADJC,UACI,QADJA,UACI;EACJ,oBACE,qBAAC,cAAD;IAAA,wBAEE,qBAAC,UAAD;MACE,WAAQ,mBADV;MAEE,OAAO,EAAE,mBAAM;QACbA,UAAU;QACVD,mBAAmB;MACpB,CALH;MAAA,wBAOE,oBAAC,wBAAD;QAAW,IAAI,EAAC,KAAhB;QAAsB,EAAE,EAAE;MAA1B,EAPF,eAQE,oBAAC,sBAAD;QAAkB,OAAO,EAAC,MAA1B;QAAiC,EAAE,SAAnC;QAA4C,cAAc;UAAA;UAAA;QAAA;MAA1D,EARF;IAAA,EAFF,EAYGrP,OAAO,iBACN,qBAAC,UAAD;MACE,WAAQ,kBADV;MAEE,OAAO,EAAE,mBAAM;QACbsP,UAAU;QACVF,MAAM;MACP,CALH;MAAA,wBAOE,oBAAC,oBAAD;QAAM,IAAI,EAAC,KAAX;QAAiB,EAAE,EAAE;MAArB,EAPF,eAQE,oBAAC,sBAAD;QAAkB,OAAO,EAAC,MAA1B;QAAiC,EAAE,QAAnC;QAA2C,cAAc;UAAA;UAAA;QAAA;MAAzD,EARF;IAAA,EAbJ,EAwBGF,SAAS,iBACR,qBAAC,UAAD;MACE,WAAQ,oBADV;MAEE,OAAO,EAAE,mBAAM;QACbI,UAAU;QACVH,sBAAsB;MACvB,CALH;MAME,KAAK,EAAC,SANR;MAAA,wBAQE,oBAAC,OAAD;QAAG,IAAI,EAAC,KAAR;QAAc,EAAE,EAAE;MAAlB,EARF,eASE,oBAAC,sBAAD;QAAkB,OAAO,EAAC,MAA1B;QAAiC,EAAE,kBAAnC;QAAqD,cAAc;UAAA;UAAA;QAAA;MAAnE,EATF;IAAA,EAzBJ;EAAA,EADF;AAwCD,CAhDD;;AA6DA,IAAMI,qBAAqB,GAAGzB,uBAAH,8KAA3B;AAQA,IAAM0B,sBAAsB,GAAG,CAC7B;EACE9D,IAAI,EAAE,QADR;EAEE+D,OAAO,EAAE;IACP7C,MAAM,EAAE,CAAC,CAAD,EAAI,CAAJ;EADD;AAFX,CAD6B,CAA/B;AASA,IAAMjM,eAAe,GAAG;EAAE+O,OAAO,EAAElB,6BAAcA;AAAzB,CAAxB;;AAEA,IAAMmB,cAAc,GAAG,SAAjBA,cAAiB,QAA4F;EAAA,IAAzFjC,OAAyF,SAAzFA,OAAyF;EAAA,IAAhFkC,UAAgF,SAAhFA,UAAgF;EAAA,IAApEC,kBAAoE,SAApEA,kBAAoE;EAAA,IAAhD7P,OAAgD,SAAhDA,OAAgD;EAAA,IAAvCkP,SAAuC,SAAvCA,SAAuC;EAAA,IAA5BY,QAA4B,SAA5BA,QAA4B;EAAA,IAAlBC,WAAkB,SAAlBA,WAAkB;EACjH,IAAMtQ,IAAI,GAAG4O,0BAAO,EAApB;;EACA,oBAAiBI,+BAAY,EAA7B;EAAA,IAAQuB,IAAR,iBAAQA,IAAR;;EACA,sBAAkC/S,cAAA,CAAe,IAAf,CAAlC;EAAA;EAAA,IAAOiT,UAAP;EAAA,IAAmBC,WAAnB;;EACA,uBAAgDlT,cAAA,CAAe,KAAf,CAAhD;EAAA;EAAA,IAAOmT,gBAAP;EAAA,IAAyBC,mBAAzB;;EACA,uBAAoCpT,cAAA,CAAe,IAAf,CAApC;EAAA;EAAA,IAAOqT,UAAP;EAAA,IAAmBC,aAAnB;;EACA,uBAA0CtT,cAAA,CAAe,IAAf,CAA1C;EAAA;EAAA,IAAOuT,aAAP;EAAA,IAAsBC,gBAAtB;;EACA,mBAAgD1C,sBAAW,CAACwB,qBAAD,EAAwB5O,eAAxB,CAA3D;EAAA;EAAA,IAAO+P,aAAP;EAAA,IAA+BC,WAA/B,oBAAwBvP,KAAxB;;EACA,iBAAsCkN,8BAAS,CAACgC,UAAD,EAAaE,aAAb,EAA4B;IACzEI,SAAS,EAAE,YAD8D;IAEzEC,SAAS,EAAErB;EAF8D,CAA5B,CAA/C;EAAA,IAAQsB,MAAR,cAAQA,MAAR;EAAA,IAAgBC,UAAhB,cAAgBA,UAAhB;EAAA,IAA4BpR,KAA5B,cAA4BA,KAA5B;;EAKA,IAAM0P,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;IAChC,4BAAmB2B,MAAM,CAACC,QAAP,CAAgB7G,IAAhB,CAAqB8G,KAArB,CAA2B,GAA3B,CAAnB;IAAA;IAAA,IAAOC,QAAP;;IACA,IAAMC,kBAAkB,aAAMD,QAAN,cAAkBvB,UAAlB,CAAxB;IACAI,IAAI,CAACoB,kBAAD,CAAJ;EACD,CAJD;;EAMA1C,gCAAa,CAAC/O,KAAD,aAACA,KAAD,uBAACA,KAAK,CAAE0R,QAAP,CAAgBC,MAAjB,EAAyB,UAAAC,OAAO,EAAI;IAC/C,IAAIA,OAAO,IAAInB,gBAAf,EAAiC;MAC/BC,mBAAmB,CAAC,KAAD,CAAnB;IACD;EACF,CAJY,CAAb;EAMA,oBACE,qBAAC,cAAD;IAAA,wBACE;MAAA,uBACE,oBAAC,2BAAD;QACE,GAAG,EAAEE,aADP;QAEE,UAAU,EAAC,MAFb;QAGE,WAAQ,0BAHV;QAIE,OAAO,EAAE;UAAA,OAAMF,mBAAmB,CAAC,CAACD,gBAAF,CAAzB;QAAA,CAJX;QAAA,uBAME,oBAAC,sDAAD;UAAuB,IAAI,EAAC;QAA5B;MANF;IADF,EADF,EAYGA,gBAAgB,iBACf,qBAAC,0BAAD;MAA4B,GAAG,EAAEK,gBAAjC;MAAmD,KAAK,EAAEK,MAAM,CAACQ;IAAjE,GAA6EP,UAAU,CAACO,MAAxF;MAAA,wBACE,qBAAC,iBAAD;QAAM,cAAc,EAAC,eAArB;QAAqC,UAAU,EAAC,QAAhD;QAAyD,EAAE,EAAE,CAA7D;QAAA,wBACE,oBAAC,MAAD;UACE,UAAU,EAAC,KADb;UAEE,QAAQ,EAAC,KAFX;UAGE,UAAU,EAAC,MAHb;UAIE,aAAa,EAAC,WAJhB;UAKE,aAAa,EAAC,OALhB;UAME,UAAU,EAAC,QANb;UAOE,EAAE,EAAE,CAPN;UAAA,uBASE,oBAAC,sBAAD;YAAkB,EAAE,mBAApB;YAAuC,cAAc;cAAA;cAAA;YAAA;UAArD;QATF,EADF,eAYE,oBAAC,uBAAD;UAAU,IAAI,EAAC,GAAf;UAAmB,WAAW,EAAC,OAA/B;UAAuC,WAAW,EAAC;QAAnD,EAZF;MAAA,EADF,eAeE,oBAAC,iBAAD;QAAM,aAAa,EAAC,QAApB;QAA6B,UAAU,EAAC,YAAxC;QAAA,uBACE,oBAAC,kBAAD;UACE,OAAO,EAAE5D,OADX;UAEE,kBAAkB,EAAEmC,kBAFtB;UAGE,sBAAsB,EAAE;YAAA,OAAMM,WAAW,CAAC,IAAD,CAAjB;UAAA,CAH1B;UAIE,MAAM,EAAEJ,WAJV;UAKE,OAAO,EAAE/P,OALX;UAME,SAAS,EAAEkP,SANb;UAOE,mBAAmB,EAAEG,mBAPvB;UAQE,UAAU,EAAE;YAAA,OAAMgB,mBAAmB,CAAC,KAAD,CAAzB;UAAA;QARd;MADF,EAfF;IAAA,GAbJ,EA2CGH,UAAU,iBACT,qBAAC,gCAAD;MACE,QAAQ,MADV;MAEE,IAAI,EAAC,QAFP;MAGE,OAAO,EAAE;QAAA,OAAMC,WAAW,CAAC,KAAD,CAAjB;MAAA,CAHX;MAIE,eAAe,mFAAE;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OACTO,aAAa,CAAC;kBAAEhP,SAAS,EAAE;oBAAE5C,EAAE,EAAE4O,OAAO,CAAC5O;kBAAd;gBAAb,CAAD,CADJ;;cAAA;gBAAA,KAEXgR,QAFW;kBAAA;kBAAA;gBAAA;;gBAAA;gBAAA,OAGPA,QAAQ,CAACpC,OAAD,CAHD;;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CAAF,EAJjB;MAUE,MAAM,EACJmC,kBAAkB,gBAChB,oBAAC,sBAAD;QAAkB,EAAE,iCAApB;QAAqD,cAAc;UAAA;UAAA;QAAA;MAAnE,EADgB,gBAGhB,oBAAC,sBAAD;QAAkB,EAAE,8BAApB;QAAkD,cAAc;UAAA;UAAA;QAAA;MAAhE,EAdN;MAAA,wBAkBE,oBAAC,uBAAD;QAAU,EAAE,EAAE,CAAd;QAAiB,WAAW,EAAC;MAA7B,EAlBF,EAmBGA,kBAAkB,iBACjB,oBAAC,yBAAD;QAAY,IAAI,EAAC,SAAjB;QAA2B,QAAQ,MAAnC;QAAoC,EAAE,EAAE,CAAxC;QAAA,uBACE,oBAAC,sBAAD;UACE,EAAE,8BADJ;UAEE,cAAc;YAAA;YAAA;UAAA;QAFhB;MADF,EApBJ,eA2BE,qBAAC,wBAAD;QAAW,OAAO,EAAE,CAApB;QAAuB,YAAY,EAAE,CAArC;QAAwC,MAAM,EAAC,mBAA/C;QAAA,wBACE,oBAAC,eAAD;UAAiB,OAAO,EAAEnC;QAA1B,EADF,eAEE,oBAAC,wBAAD;UAAW,EAAE,EAAE,CAAf;UAAkB,SAAS,EAAE,GAA7B;UAAkC,SAAS,EAAC,MAA5C;UAAA,uBACE,oBAAC,0BAAD;YAAa,OAAO,EAAEA,OAAO,CAAC8D,IAA9B;YAAoC,QAAQ,EAAC,MAA7C;YAAoD,WAAQ;UAA5D;QADF,EAFF;MAAA,EA3BF,EAiCGb,WAAW,iBACV,oBAAC,yBAAD;QAAY,IAAI,EAAC,OAAjB;QAAyB,QAAQ,MAAjC;QAAkC,EAAE,EAAE,CAAtC;QAAA,UACGpC,uCAAoB,CAAC9O,IAAD,EAAOkR,WAAP;MADvB,EAlCJ;IAAA,EA5CJ;EAAA,EADF;AAuFD,CAhHD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsIA,iEAAehB,cAAf;;;;;;;;;;;;;;AChRA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AAEA,IAAMiC,mBAAmB,GAAG9D,uBAAH,oPAOrB6D,qCAPqB,CAAzB;AAUA,IAAMhR,uBAAe,GAAG;EAAE+O,OAAO,EAAElB,6BAAcA;AAAzB,CAAxB;AAEA;AACA;AACA;AACA;AACA;;AACA,IAAMqD,OAAO,GAAG,SAAVA,OAAU,OASV;EAAA,IARJnE,OAQI,QARJA,OAQI;EAAA,IAPJ1N,OAOI,QAPJA,OAOI;EAAA,IANJkP,SAMI,QANJA,SAMI;EAAA,IALJ4C,gBAKI,QALJA,gBAKI;EAAA,IAJJjC,kBAII,QAJJA,kBAII;EAAA,IAHJC,QAGI,QAHJA,QAGI;EAAA,IAFJiC,SAEI,QAFJA,SAEI;EAAA,IADJC,QACI,QADJA,QACI;;EACJ,sBAAgC/U,cAAA,CAAe,KAAf,CAAhC;EAAA;EAAA,IAAOgC,SAAP;EAAA,IAAkBgT,UAAlB;;EACA,IAAMC,UAAU,GAAG,CAACjT,SAApB;EACA,IAAM2Q,UAAU,qBAAc,IAAI/B,IAAJ,CAASH,OAAO,CAACE,SAAjB,EAA4BuE,OAA5B,EAAd,CAAhB;EAEA,oBACE,qBAAC,wBAAD;IAAW,KAAK,EAAC,MAAjB;IAAwB,WAAQ,SAAhC;IAA0C,EAAE,EAAEvC,UAA9C;IAAA,wBACE,qBAAC,iBAAD;MAAM,EAAE,EAAE,CAAV;MAAa,cAAc,EAAC,eAA5B;MAAA,wBACE,oBAAC,eAAD;QAAiB,OAAO,EAAElC;MAA1B,EADF,EAEGwE,UAAU,iBACT,oBAAC,4BAAD;QACE,OAAO,EAAExE,OADX;QAEE,UAAU,EAAEkC,UAFd;QAGE,kBAAkB,EAAEC,kBAHtB;QAIE,OAAO,EAAE7P,OAJX;QAKE,SAAS,EAAEkP,SALb;QAME,QAAQ,EAAEY,QANZ;QAOE,WAAW,EAAE;UAAA,OAAMmC,UAAU,CAAC,IAAD,CAAhB;QAAA;MAPf,EAHJ;IAAA,EADF,eAgBE;MAAK,QAAQ,EAAC,UAAd;MAAyB,SAAS,EAAEH,gBAApC;MAAA,wBACE,oBAAC,8BAAD;QACE,QAAQ,EAAEF,mBADZ;QAEE,eAAe,EAAEjR,uBAFnB;QAGE,MAAM,EAAE+M,OAHV;QAIE,KAAK,EAAC,MAJR;QAKE,OAAO,EAAE1N,OALX;QAME,SAAS,EAAEkP,SANb;QAOE,SAAS,EAAEjQ,SAPb;QAQE,YAAY,EAAE,KARhB;QASE,gBAAgB,EAAE,0BAACyO,OAAD,EAAU8D,IAAV;UAAA,OAAoB;YAAE9D,OAAO,EAAE;cAAE5O,EAAE,EAAE4O,OAAO,CAAC5O,EAAd;cAAkB0S,IAAI,EAAJA;YAAlB;UAAX,CAApB;QAAA,CATpB;QAUE,aAAa,EAAE;UAAA,OAAMS,UAAU,CAAC,KAAD,CAAhB;QAAA,CAVjB;QAWE,oBAAoB,MAXtB;QAYE,QAAQ,MAZV;QAAA,UAcG;UAAA,IAAGhT,SAAH,SAAGA,SAAH;UAAA,IAAcoB,QAAd,SAAcA,QAAd;UAAA,IAAwBiB,YAAxB,SAAwBA,YAAxB;UAAA,OACC,CAACrC,SAAD,gBACE,oBAAC,0BAAD;YAAa,OAAO,EAAEyO,OAAO,CAAC8D,IAA9B;YAAoC,QAAQ,EAAC,MAA7C;YAAoD,WAAQ;UAA5D,EADF,gBAGE,oBAAC,yBAAD;YACE,IAAI,EAAC,SADP;YAEE,YAAY,EAAE9D,OAAO,CAAC8D,IAFxB;YAGE,QAAQ,EAAE,kBAAAjQ,CAAC;cAAA,OAAIlB,QAAQ,CAACkB,CAAC,CAACC,MAAF,CAASvB,KAAV,CAAZ;YAAA,CAHb;YAIE,QAAQ,EAAC,MAJX;YAKE,SAAS,MALX;YAME,YAAY,EAAEqB;UANhB,EAJH;QAAA;MAdH,EADF,EA8BG,CAACyQ,SAAS,IAAIC,QAAd,kBACC,qBAAC,iBAAD;QAAM,EAAE,EAAE,CAAV;QAAa,QAAQ,EAAC,MAAtB;QAA6B,WAAQ,mBAArC;QAAA,WACGD,SAAS,iBAAI,oBAAC,6BAAD;UAAkB,SAAS,EAAEA;QAA7B,EADhB,EAEGC,QAAQ,iBAAI,oBAAC,kCAAD;UAAqB,OAAO,EAAEtE,OAA9B;UAAuC,SAAS,EAAEqE;QAAlD,EAFf;MAAA,EA/BJ;IAAA,EAhBF;EAAA,EADF;AAwDD,CAtED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmGA,0DAAeF,OAAf;;;;;GApEiE;EAAE/O,SAAS,EAAE;AAAb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClEjE;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAEA,IAAM+P,qBAAqB,GAAG/E,qEAAH,wXAOvB6D,sEAPuB,CAA3B;AAUA,IAAM/S,QAAQ,GAAGb,2DAAc,CAAC;EAC9BmC,WAAW,EAAE;IACXpB,EAAE,2BADS;IAEXC,cAAc;MAAA;MAAA;IAAA;EAFH,CADiB;EAK9B+T,SAAS,EAAE;IACThU,EAAE,yBADO;IAETC,cAAc;MAAA;MAAA;IAAA;EAFL,CALmB;EAS9BgU,WAAW,EAAE;IACXjU,EAAE,sBADS;IAEXC,cAAc;MAAA;MAAA;IAAA;EAFH,CATiB;EAa9BiU,cAAc,EAAE;IACdlU,EAAE,2BADY;IAEdC,cAAc;MAAA;MAAA;IAAA;EAFA;AAbc,CAAD,CAA/B;;AAmBA,IAAMkU,cAAc,GAAG,SAAjBA,cAAiB,CAACC,MAAD,EAASpU,EAAT,EAAgB;EACrC,IAAMqU,MAAM,GAAGrU,EAAE,cAAOA,EAAP,IAAc,EAA/B;EACA,sCAA+BsU,kBAAkB,CAACF,MAAM,CAACG,MAAP,GAAgBF,MAAjB,CAAjD;AACD,CAHD;;AAKA,IAAMG,aAAa,GAAG,SAAhBA,aAAgB,CAAAxU,EAAE,EAAI;EAC1B,OAAOA,EAAE,QAAF,IAAuC,kDAAIkS,MAAJ,EAAY,eAAZ,iBAAqClS,EAArC,CAA9C;AACD,CAFD;;AAIA,IAAM6B,eAAe,GAAG;EAAE+O,OAAO,EAAElB,yEAAcA;AAAzB,CAAxB;AAEA;;AACA,IAAM+E,oBAAoB,GAAG,SAAvBA,oBAAuB,CAAC/B,IAAD,EAAOgC,cAAP,EAAuBC,SAAvB,EAAkCC,QAAlC,EAA+C;EAC1E,IAAMhG,OAAO,GAAG;IAAE8D,IAAI,EAAJA;EAAF,CAAhB;;EACA,IAAIgC,cAAJ,EAAoB;IAClB9F,OAAO,CAACiG,cAAR,GAAyBH,cAAzB;EACD,CAFD,MAEO,IAAIC,SAAJ,EAAe;IACpB/F,OAAO,CAACkG,OAAR,GAAkB,EAAlB;;IACA,IAAI,OAAOH,SAAP,KAAqB,QAAzB,EAAmC;MACjC/F,OAAO,CAACkG,OAAR,CAAgB9U,EAAhB,GAAqB2U,SAArB;IACD,CAFD,MAEO;MACL/F,OAAO,CAACkG,OAAR,CAAgBC,QAAhB,GAA2BJ,SAA3B;IACD;EACF,CAPM,MAOA,IAAIC,QAAJ,EAAc;IACnBhG,OAAO,CAACoG,MAAR,GAAiB,EAAjB;;IACA,IAAI,OAAOJ,QAAP,KAAoB,QAAxB,EAAkC;MAChChG,OAAO,CAACoG,MAAR,CAAehV,EAAf,GAAoB4U,QAApB;IACD,CAFD,MAEO;MACLhG,OAAO,CAACoG,MAAR,CAAeD,QAAf,GAA0BH,QAA1B;IACD;EACF;;EACD,OAAOhG,OAAP;AACD,CApBD;AAsBA;AACA;AACA;AACA;;;AACA,IAAMqG,WAAW,GAAG,SAAdA,WAAc,OAUd;EAAA,IATJjV,EASI,QATJA,EASI;EAAA,IARJ6U,cAQI,QARJA,cAQI;EAAA,IAPJK,SAOI,QAPJA,SAOI;EAAA,IANJC,QAMI,QANJA,QAMI;EAAA,IALJjK,SAKI,QALJA,SAKI;EAAA,IAJJkJ,MAII,QAJJA,MAII;EAAA,IAHJgB,mBAGI,QAHJA,mBAGI;EAAA,IAFJC,YAEI,QAFJA,YAEI;EAAA,IADJhQ,UACI,QADJA,UACI;;EACJ,mBAA4C4J,4DAAW,CAAC8E,qBAAD,EAAwBlS,eAAxB,CAAvD;EAAA;EAAA,IAAOyT,aAAP;EAAA;EAAA,IAAwBjT,OAAxB,kBAAwBA,OAAxB;EAAA,IAAiCC,KAAjC,kBAAiCA,KAAjC;;EACA,IAAM3B,IAAI,GAAG4O,gEAAO,EAApB;;EACA,gBAAwB4B,+CAAQ,CAAC,EAAD,CAAhC;EAAA,IAAOuB,IAAP;EAAA,IAAa6C,OAAb;;EACA,iBAAoCpE,+CAAQ,EAA5C;EAAA,IAAOqE,UAAP;EAAA,IAAmBC,aAAnB;;EACA,iBAA8CtE,+CAAQ,EAAtD;EAAA,IAAOuE,eAAP;EAAA,IAAwBC,kBAAxB;;EACA,iBAAkCxE,+CAAQ,CAAC,KAAD,CAA1C;EAAA,IAAO9Q,SAAP;EAAA,IAAkBmC,YAAlB;;EACA,IAAQzB,aAAR,GAA0BJ,IAA1B,CAAQI,aAAR;;EAEA,IAAM6U,UAAU;IAAA,0WAAG,iBAAMvP,KAAN;MAAA;MAAA;QAAA;UAAA;YAAA;cACjBA,KAAK,CAACqE,cAAN;cACArE,KAAK,CAACwP,eAAN;;cAFiB,IAGZnD,IAHY;gBAAA;gBAAA;cAAA;;cAIfiD,kBAAkB,CAACpC,kEAAW,CAACC,gGAAD,CAAZ,CAAlB;cAJe;cAAA;;YAAA;cAMT5E,OANS,GAMC6F,oBAAoB,CAAC/B,IAAD,EAAOmC,cAAP,EAAuBK,SAAvB,EAAkCC,QAAlC,CANrB;cAAA;cAAA,OAOQG,aAAa,CAAC;gBAAE1S,SAAS,EAAE;kBAAEgM,OAAO,EAAPA;gBAAF;cAAb,CAAD,CAPrB;;YAAA;cAOTmH,QAPS;cAQfN,aAAa,CAACM,QAAQ,CAACC,IAAT,CAAcV,aAAd,CAA4BtV,EAA7B,CAAb;;cARe,KASXkL,SATW;gBAAA;gBAAA;cAAA;;cAAA,iCAUNA,SAAS,CAAC6K,QAAQ,CAACC,IAAT,CAAcV,aAAf,CAVH;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAH;;IAAA,gBAAVM,UAAU;MAAA;IAAA;EAAA,GAAhB;;EAeA,oBACE,yDAAC,4DAAD;IAAW,EAAE,EAAE5V,EAAf;IAAmB,QAAQ,EAAC,UAA5B;IAAA,WACG,CAACoV,mBAAD,IAAwB,CAACC,YAAzB,iBACC,wDAAC,mEAAD;MAAkB,cAAc,EAAC,OAAjC;MAAA,uBACE,wDAAC,iFAAD;QAAA,uBACE,wDAAC,oEAAD;UACE,MAAM,EAAE;YAAEY,IAAI,EAAE9B,cAAc,CAACC,MAAD,EAASpU,EAAT;UAAtB,CADV;UAEE,WAAW,EAAEe,aAAa,CAACjB,QAAQ,CAACmU,WAAV,CAF5B;UAGE,UAAU,MAHZ;UAIE,cAAc,EAAE,KAJlB;UAKE,UAAU,EAAE;QALd;MADF;IADF,EAFJ,eAcE;MAAM,QAAQ,EAAE2B,UAAhB;MAA4B,WAAQ,cAApC;MAAA,WACGR,mBAAmB,gBAClB,wDAAC,qEAAD;QAAoB,MAAM,EAAE;MAA5B,EADkB,gBAGlB,wDAAC,wDAAD;QACE,IAAI,EAAC,SADP;QAEE,WAAW,MAFb;QAGE,SAAS,EAAC,MAHZ;QAIE,eAAe,EAAE,GAJnB;QAKE,WAAW,EAAErU,aAAa,CAACjB,QAAQ,CAACsB,WAAV,CAL5B;QAME,SAAS,EAAEoT,aAAa,CAACxU,EAAD,CAN1B;QAOE,QAAQ,EAAEqF,UAAU,IAAI,CAACgQ,YAAf,IAA+BhT,OAP3C;QAQE,KAAK,EAAEmT,UART;QASE,QAAQ,EAAC,MATX;QAUE,QAAQ,EAAE,kBAAA/S,CAAC,EAAI;UACb8S,OAAO,CAAC9S,CAAC,CAACC,MAAF,CAASvB,KAAV,CAAP;UACAwU,kBAAkB,CAAC,IAAD,CAAlB;QACD,CAbH;QAcE,YAAY,EAAEnT;MAdhB,EAJJ,EAqBGkT,eAAe,iBACd,wDAAC,qCAAD;QAAG,KAAK,EAAC,SAAT;QAAmB,EAAE,EAAE,CAAvB;QAAA,UACG/B,iFAAsB,CAAChT,IAAD,EAAO+U,eAAP;MADzB,EAtBJ,EA0BGpT,KAAK,iBACJ,wDAAC,6DAAD;QAAY,IAAI,EAAC,OAAjB;QAAyB,QAAQ,MAAjC;QAAkC,EAAE,EAAE,CAAtC;QAAA,UACGmR,yEAAkB,CAAC9S,IAAD,EAAO+S,mFAA4B,CAACpR,KAAD,CAAnC;MADrB,EA3BJ,eA+BE,wDAAC,kDAAD;QAAM,EAAE,EAAE,CAAV;QAAa,UAAU,EAAC,QAAxB;QAAiC,GAAG,EAAE,EAAtC;QAAA,uBACE,wDAAC,+DAAD;UACE,IAAI,EAAC,QADP;UAEE,QAAQ,EAAE,GAFZ;UAGE,WAAW,EAAC,SAHd;UAIE,QAAQ,EAAE+C,UAAU,IAAI,CAACgQ,YAAf,IAA+BhV,SAJ3C;UAKE,OAAO,EAAEgC,OALX;UAME,WAAQ,oBANV;UAAA,UAQGtB,aAAa,CAACV,SAAS,GAAGP,QAAQ,CAACoU,cAAZ,GAA6BpU,QAAQ,CAACkU,SAAhD;QARhB;MADF,EA/BF;IAAA,EAdF;EAAA,EADF;AA6DD,CA/FD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsHA,yDAAeF,kEAAQ,CAACR,uDAAU,CAAC2B,WAAD,CAAX,CAAvB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjNA;AAGA;;;AAEA,IAAMkB,eAAe,GAAG,SAAlBA,eAAkB,CAAA3X,KAAK;EAAA,oBAC3B,oBAAC,+BAAD;IAAkB,IAAI,EAAC,MAAvB;IAA8B,KAAK,EAAC,IAApC;IAAyC,MAAM,EAAC,IAAhD;IAAqD,OAAO,EAAC;EAA7D,GAA6EA,KAA7E;IAAA,uBACE;MACE,IAAI,EAAC,SADP;MAEE,QAAQ,EAAC,SAFX;MAGE,CAAC,EAAC,wsBAHJ;MAIE,QAAQ,EAAC,SAJX;MAKE,WAAW,EAAC;IALd;EADF,GAD2B;AAAA,CAA7B;;;;;;;;;;;;;;;;;;;;;AAgBA,0DAAe2X,eAAf;;;;;;;;;;;;;;;;;;;ACrBA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AAEA,IAAMM,mBAAmB,GAAGzH,uBAAH,sbAAzB;AAiBA,IAAM0H,sBAAsB,GAAG1H,uBAAH,8bAA5B;AAiBA,IAAM2H,KAAK,GAAGvX,2EAAH;EAAA;EAAA;AAAA,uBAAX;AAIA,IAAMwX,cAAc,GAAGxX,iDAAM,CAACoX,gCAAD,CAAN,CAA0BvG,KAA1B,CAAgC;EAAE4G,YAAY,EAAE,IAAhB;EAAsB3G,UAAU,EAAE;AAAlC,CAAhC,CAAH;EAAA;EAAA;AAAA,oJAIhByG,KAJgB,EASdA,KATc,EAchB,UAAAnY,KAAK;EAAA,OACLA,KAAK,CAACsY,UAAN,IACAhU,6CADA,kCAEgBtE,KAAK,CAAC0F,KAAN,CAAYC,MAAZ,CAAmB4S,OAAnB,CAA2B,GAA3B,CAFhB,CADK;AAAA,CAdW,CAApB;;AAqBA,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACC,MAAD,EAASC,KAAT,EAAgBC,QAAhB,EAA6B;EACzD,IAAMC,aAAa,GAAGH,MAAM,CAACG,aAAP,IAAwB,EAA9C;EACA,IAAQC,UAAR,GAAuBJ,MAAvB,CAAQI,UAAR;EACA,IAAMC,SAAS,GAAGD,UAAU,KAAK,QAAf,GAA0B,QAA1B,GAAqC,SAAvD;EACA,IAAME,iBAAiB,GAAGF,UAAU,KAAK,QAAf,GAA0B,SAA1B,GAAsC,QAAhE;;EACA,IAAIF,QAAJ,EAAc;IAAA;;IACZ,IAAMK,QAAQ,GAAG,CAACP,MAAM,CAAChE,SAAP,CAAiBiE,KAAjB,KAA2B,CAA5B,IAAiC,CAAlD;IAEA,OAAO;MACLG,UAAU,EAAE,UADP;MAELI,gBAAgB;QACdJ,UAAU,EAAE;MADE,+CAEbC,SAFa,EAED;QACXD,UAAU,EAAVA,UADW;QAEXrX,EAAE,EAAEiX,MAAM,CAACjX,EAFA;QAGXiT,SAAS,EAAE,sEAAKgE,MAAM,CAAChE,SAAd,oCAA0BiE,KAA1B,EAAkCM,QAAlC,EAHE;QAIXJ,aAAa,wCAAMA,aAAN,IAAqBF,KAArB;MAJF,CAFC,+CAQbK,iBARa,EAQO,IARP;IAFX,CAAP;EAaD,CAhBD,MAgBO;IAAA;;IACL,IAAMC,SAAQ,GAAG,CAACP,MAAM,CAAChE,SAAP,CAAiBiE,KAAjB,KAA2B,CAA5B,IAAiC,CAAlD;;IACA,IAAMjE,SAAS,GAAG,sEAAKgE,MAAM,CAAChE,SAAf,oCAA2BiE,KAA3B,EAAmCM,SAAnC,EAAf;;IAEA,IAAI,CAACvE,SAAS,CAACiE,KAAD,CAAd,EAAuB;MACrB,OAAOjE,SAAS,CAACiE,KAAD,CAAhB;IACD;;IAED,OAAO;MACLG,UAAU,EAAE,UADP;MAELK,mBAAmB;QACjBL,UAAU,EAAE;MADK,kDAEhBC,SAFgB,EAEJ;QACXD,UAAU,EAAVA,UADW;QAEXrX,EAAE,EAAEiX,MAAM,CAACjX,EAFA;QAGXiT,SAAS,EAATA,SAHW;QAIXmE,aAAa,EAAEA,aAAa,CAACO,MAAd,CAAqB,UAAAC,SAAS;UAAA,OAAIA,SAAS,KAAKV,KAAlB;QAAA,CAA9B;MAJJ,CAFI,kDAQhBK,iBARgB,EAQI,IARJ;IAFd,CAAP;EAaD;AACF,CA3CD;;AA6CA,IAAM1V,eAAe,GAAG;EAAE+O,OAAO,EAAElB,6BAAcA;AAAzB,CAAxB;AAEA;AACA;AACA;;AACA,IAAMiD,mBAAmB,GAAG,SAAtBA,mBAAsB,OAAyB;EAAA,IAAtB/D,OAAsB,QAAtBA,OAAsB;EAAA,IAAboG,MAAa,QAAbA,MAAa;EACnD,IAAM6C,aAAa,GAAG,CAAC,KAAD,EAAQ,IAAR,EAAc,IAAd,EAAoB,IAApB,CAAtB;EACA,IAAMC,cAAc,GAAG,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,CAAvB;;EACA,sBAAwB3Z,cAAA,CAAe,KAAf,CAAxB;EAAA;EAAA,IAAO4Z,IAAP;EAAA,IAAaC,OAAb;;EACA,IAAMC,UAAU,GAAG9Z,YAAA,EAAnB;;EACA,mBAAsB8Q,sBAAW,CAACwH,mBAAD,EAAsB5U,eAAtB,CAAjC;EAAA;EAAA,IAAOsW,WAAP;;EACA,oBAAyBlJ,sBAAW,CAACyH,sBAAD,EAAyB7U,eAAzB,CAApC;EAAA;EAAA,IAAOuW,cAAP;;EAEAxI,gCAAa,CAACqI,UAAD,EAAa,UAAAxF,OAAO,EAAI;IACnC,IAAIA,OAAJ,EAAa;MACXuF,OAAO,CAAC,KAAD,CAAP;IACD;EACF,CAJY,CAAb;;EAMA,IAAMK,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAAnB,KAAK,EAAI;IACnC,IAAIJ,UAAJ;;IACA,IAAIlI,OAAJ,EAAa;MAAA;;MACXkI,UAAU,4BAAGlI,OAAO,CAACwI,aAAX,0DAAG,sBAAuBlN,QAAvB,CAAgCgN,KAAhC,CAAb;IACD,CAFD,MAEO,IAAIlC,MAAJ,EAAY;MAAA;;MACjB8B,UAAU,4BAAG9B,MAAM,CAACoC,aAAV,0DAAG,sBAAsBlN,QAAtB,CAA+BgN,KAA/B,CAAb;IACD;;IACD,OAAO;MACL7V,QAAQ,eAAE,oBAAC,KAAD;QAAA,UAAQ6V;MAAR,EADL;MAELJ,UAAU,EAAVA,UAFK;MAGLwB,OAAO,EAAE,mBAAM;QACbN,OAAO,CAAC,KAAD,CAAP;QACA,IAAMO,MAAM,GAAGzB,UAAU,GAAGsB,cAAH,GAAoBD,WAA7C;;QACA,IAAIvJ,OAAJ,EAAa;UACX,OAAO2J,MAAM,CAAC;YACZ3V,SAAS,EAAE;cAAEsU,KAAK,EAAEA,KAAT;cAAgBtI,OAAO,EAAE;gBAAE5O,EAAE,EAAE4O,OAAO,CAAC5O;cAAd;YAAzB,CADC;YAEZwY,kBAAkB,EAAExB,qBAAqB,CAACpI,OAAD,EAAUsI,KAAV,EAAiB,CAACJ,UAAlB,EAA8B,IAA9B;UAF7B,CAAD,CAAb;QAID,CALD,MAKO,IAAI9B,MAAJ,EAAY;UACjB,OAAOuD,MAAM,CAAC;YACZ3V,SAAS,EAAE;cAAEsU,KAAK,EAAEA,KAAT;cAAgBlC,MAAM,EAAE;gBAAEhV,EAAE,EAAEgV,MAAM,CAAChV;cAAb;YAAxB,CADC;YAEZwY,kBAAkB,EAAExB,qBAAqB,CAAChC,MAAD,EAASkC,KAAT,EAAgB,CAACJ,UAAjB,EAA6B,KAA7B;UAF7B,CAAD,CAAb;QAID;MACF;IAjBI,CAAP;EAmBD,CA1BD;;EA4BA,oBACE,oBAAC,uBAAD;IAAA,uBACE;MAAK,GAAG,EAAEmB,UAAV;MAAA,wBACE,oBAAC,0BAAD;QAAA,UACG;UAAA,IAAGQ,GAAH,SAAGA,GAAH;UAAA,oBACC,oBAAC,2BAAD;YACE,UAAU,EAAC,MADb;YAEE,OAAO,EAAC,cAFV;YAGE,UAAU,EAAC,QAHb;YAIE,OAAO,EAAE;cAAA,OAAMT,OAAO,CAAC,IAAD,CAAb;YAAA,CAJX;YAKE,GAAG,EAAES,GALP;YAME,MAAM,EAAC,eANT;YAOE,WAAQ,iCAPV;YAAA,uBASE,oBAAC,qBAAD;UATF,EADD;QAAA;MADH,EADF,EAgBGV,IAAI,iBACH,oBAAC,oBAAD;QAAQ,SAAS,EAAC,QAAlB;QAAA,UACG;UAAA,IAAGjG,SAAH,SAAGA,SAAH;UAAA,IAAc2G,GAAd,SAAcA,GAAd;UAAA,IAAmBC,KAAnB,SAAmBA,KAAnB;UAAA,oBACC,qBAAC,yBAAD;YACE,SAAS,EAAC,2BADZ;YAEE,MAAM,EAAE,IAFV;YAGE,kBAAgB5G,SAHlB;YAIE,GAAG,EAAE2G,GAJP;YAKE,KAAK,EAAEC,KALT;YAME,WAAQ,gCANV;YAAA,wBAQE,oBAAC,iBAAD;cAAA,UACGb,aAAa,CAACc,GAAd,CAAkB,UAAAzB,KAAK;gBAAA,oBACtB,oBAAC,cAAD,uCAAgCmB,mBAAmB,CAACnB,KAAD,CAAnD,GAAqBA,KAArB,CADsB;cAAA,CAAvB;YADH,EARF,eAaE,oBAAC,iBAAD;cAAA,UACGY,cAAc,CAACa,GAAf,CAAmB,UAAAzB,KAAK;gBAAA,oBACvB,oBAAC,cAAD,uCAAgCmB,mBAAmB,CAACnB,KAAD,CAAnD,GAAqBA,KAArB,CADuB;cAAA,CAAxB;YADH,EAbF;UAAA,EADD;QAAA;MADH,EAjBJ;IAAA;EADF,EADF;AA8CD,CAxFD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6GA,sEAAevE,mBAAf;;;;;;;;;;;ACzOA;AAEA;AAEA;;AAEA,IAAMkG,UAAU,GAAGzZ,uEAAM,CAACwZ,iDAAD,CAAT;EAAA;EAAA;AAAA,oMAAhB;;AAaA,IAAME,cAAc,GAAG,SAAjBA,cAAiB,OAAmB;EAAA,IAAhB7F,SAAgB,QAAhBA,SAAgB;EACxC,OAAO8F,MAAM,CAACC,IAAP,CAAY/F,SAAZ,EACJgG,IADI,GAEJN,GAFI,CAEA,UAAAzB,KAAK,EAAI;IACZ,oBACE,wDAAC,UAAD;MAAA,WACGA,KADH,cACsBjE,SAAS,CAACiE,KAAD,CAD/B;IAAA,GAAiBA,KAAjB,CADF;EAKD,CARI,CAAP;AASD,CAVD;;AAiBA,sEAAe/Y,uCAAA,CAAW2a,cAAX,CAAf;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpCA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;AACA,IAAM8B,eAAe,GAAG;EACtBC,0BAA0B,EAAE;IAC1BrQ,IAAI,EAAE,MADoB;IAE1BsQ,IAAI,EAAEf,oBAFoB;IAG1BpX,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,4BADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHI,CADN;EAStB8a,2BAA2B,EAAE;IAC3BvQ,IAAI,EAAE,MADqB;IAE3BsQ,IAAI,EAAEb,8BAFqB;IAG3BtX,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,6BADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHK,CATP;EAiBtB+a,wBAAwB,EAAE;IACxBxQ,IAAI,EAAE,MADkB;IAExBsQ,IAAI,EAAET,0BAFkB;IAGxB1X,OAAO,EAAE6X,qBAAa,CAAC;MAAA;MACrBva,cAAc;QAAA;QAAA;MAAA;QAAA;QAAA;MAAA;IADO,CAAD;EAHE,CAjBJ;EAwBtBgb,6BAA6B,EAAE;IAC7BzQ,IAAI,EAAE,SADuB;IAE7BsQ,IAAI,EAAEX,8BAFuB;IAG7BxX,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,+BADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHO,CAxBT;EAgCtBib,0BAA0B,EAAE;IAC1B1Q,IAAI,EAAE,MADoB;IAE1BsQ,IAAI,EAAElb,oBAFoB;IAG1B+C,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,4BADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHI,CAhCN;EAwCtBkb,mCAAmC,EAAE;IACnC3Q,IAAI,EAAE,MAD6B;IAEnCsQ,IAAI,EAAEP,wBAF6B;IAGnC5X,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,mCADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHa,CAxCf;EAgDtBmb,2BAA2B,EAAE;IAC3B5Q,IAAI,EAAE,OADqB;IAE3BsQ,IAAI,EAAEvB,kBAFqB;IAG3B5W,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,6BADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHK,CAhDP;EAwDtBob,iCAAiC,EAAE;IACjC7Q,IAAI,EAAE,MAD2B;IAEjCsQ,IAAI,EAAEjB,4BAF2B;IAGjClX,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,mCADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHW,CAxDb;EAgEtBqb,uBAAuB,EAAE;IACvB9Q,IAAI,EAAE,SADiB;IAEvBsQ,IAAI,EAAEzB,kCAFiB;IAGvB1W,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,yBADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHC,CAhEH;EAwEtBsb,6BAA6B,EAAE;IAC7B/Q,IAAI,EAAE,MADuB;IAE7BsQ,IAAI,EAAErB,oBAFuB;IAG7B9W,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,+BADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHO,CAxET;EAgFtBub,wCAAwC,EAAE;IACxChR,IAAI,EAAE,MADkC;IAExCsQ,IAAI,EAAErB,oBAFkC;IAGxC9W,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,wCADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHkB,CAhFpB;EAwFtBwb,wBAAwB,EAAE;IACxBjR,IAAI,EAAE,OADkB;IAExBsQ,IAAI,EAAEnB,oCAFkB;IAGxBhX,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,0BADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHE,CAxFJ;EAgGtByb,iCAAiC,EAAE;IACjClR,IAAI,EAAE,OAD2B;IAEjCsQ,IAAI,EAAEvB,kBAF2B;IAGjC5W,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,iCADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHW,CAhGb;EAwGtB0b,uCAAuC,EAAE;IACvCnR,IAAI,EAAE,SADiC;IAEvCsQ,IAAI,EAAEX,8BAFiC;IAGvCxX,OAAO,EAAE6X,qBAAa,CAAC;MACrBxa,EAAE,uCADmB;MAErBC,cAAc;QAAA;QAAA;MAAA;IAFO,CAAD;EAHiB;AAxGnB,CAAxB;;AAkHA,IAAM2b,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,YAAD,EAAe3X,KAAf,EAAyB;EAAA;;EAChD,iCAAQ0W,eAAe,CAACiB,YAAD,CAAvB,0DAAQ,sBAA+BrR,IAAvC;IACE,KAAK,MAAL;MACE,OAAOtG,KAAK,CAACC,MAAN,CAAaO,IAAb,CAAkB,GAAlB,CAAP;;IACF,KAAK,SAAL;MACE,OAAOR,KAAK,CAACC,MAAN,CAAa2X,KAAb,CAAmB,GAAnB,CAAP;;IACF,KAAK,OAAL;MACE,OAAO5X,KAAK,CAACC,MAAN,CAAaC,GAAb,CAAiB,GAAjB,CAAP;;IACF;MACE,OAAOF,KAAK,CAACC,MAAN,CAAaE,KAAb,CAAmB,GAAnB,CAAP;EARJ;AAUD,CAXD;;AAaO,IAAM0X,eAAe,GAAG,SAAlBA,eAAkB,CAACC,QAAD,EAAW9X,KAAX,EAAqB;EAAA;;EAClD,IAAM+X,aAAa,GAAG,2BAAArB,eAAe,CAACoB,QAAQ,CAACxR,IAAV,CAAf,kFAAgCsQ,IAAhC,KAAwCP,wBAA9D;EACA,oBAAO,oBAAC,aAAD;IAAe,IAAI,EAAE,EAArB;IAAyB,KAAK,EAAEqB,gBAAgB,CAACI,QAAQ,CAACxR,IAAV,EAAgBtG,KAAhB;EAAhD,EAAP;AACD,CAHM;AAKA,IAAMgY,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAAF,QAAQ,EAAI;EAC7C,OAAOjD,MAAM,CAACoD,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCzB,eAArC,EAAsDoB,QAAQ,CAACxR,IAA/D,CAAP;AACD,CAFM;AAIP,IAAM8R,iBAAiB,GAAGld,iDAAM,CAACsP,MAAD,CAAT;EAAA;EAAA;AAAA,sEAEI,UAAAlQ,KAAK;EAAA,OAAIA,KAAK,CAAC+d,aAAV;AAAA,CAFT,CAAvB;AAMA,IAAMC,eAAe,GAAGpd,6EAAH;EAAA;EAAA;AAAA,oEAIV,UAAAZ,KAAK;EAAA,OAAIA,KAAK,CAACke,KAAV;AAAA,CAJK,CAArB;;AAOA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,OAAkB;EAAA;;EAAA,IAAfX,QAAe,QAAfA,QAAe;;EACvC,eAA0BzM,0BAAO,EAAjC;EAAA,IAAQxO,aAAR,YAAQA,aAAR;;EACA,IAAMmD,KAAK,GAAGuW,kDAAQ,EAAtB;EACA,IAAM8B,aAAa,GAAGX,gBAAgB,CAACI,QAAQ,CAACxR,IAAV,EAAgBtG,KAAhB,CAAtC;EACA,IAAMvB,OAAO,6BAAGiY,eAAe,CAACoB,QAAQ,CAACxR,IAAV,CAAlB,2DAAG,uBAAgC7H,OAAhD;EACA,IAAMia,OAAO,GAAG,mBAAAZ,QAAQ,CAAChG,IAAT,kEAAerT,OAAf,yBAA0BqZ,QAAQ,CAAChG,IAAnC,6EAA0B,gBAAe1T,KAAzC,0DAA0B,sBAAsBK,OAAhD,CAAhB;EAEA,oBACE;IAAA,WACGqZ,QAAQ,CAACa,UAAT,iBACC,qBAAC,iBAAD;MAAA,wBACE,oBAAC,6BAAD;QAAgB,UAAU,EAAEb,QAAQ,CAACa,UAArC;QAAA,uBACE,oBAAC,sBAAD;UAAQ,MAAM,EAAE,EAAhB;UAAoB,UAAU,EAAEb,QAAQ,CAACa;QAAzC;MADF,EADF,eAIE,qBAAC,iBAAD;QAAM,aAAa,EAAC,QAApB;QAA6B,cAAc,EAAC,QAA5C;QAAqD,EAAE,EAAE,CAAzD;QAAA,wBACE,oBAAC,iBAAD;UAAM,KAAK,EAAC,WAAZ;UAAA,uBACE,oBAAC,iCAAD;YACE,EAAE,UADJ;YAEE,cAAc;cAAA;cAAA;YAAA;cAAA;cAAA;YAAA,EAFhB;YAGE,MAAM,EAAE;cACNC,QAAQ,eAAE,oBAAC,yBAAD;gBAAY,EAAE,EAAErO,6BAAhB;gBAAgC,KAAK,EAAC,WAAtC;gBAAkD,UAAU,EAAEuN,QAAQ,CAACa;cAAvE;YADJ;UAHV;QADF,EADF,eAUE,oBAAC,iBAAD;UAAM,KAAK,EAAC,WAAZ;UAAwB,QAAQ,EAAC,MAAjC;UAAA,uBACE,oBAAC,iCAAD;YAAA;YAAkB,cAAc;cAAA;cAAA;YAAA;cAAA;cAAA;YAAA,EAAhC;YAA6C,MAAM,EAAE;cAAEE,IAAI,eAAE,oBAAC,uBAAD;gBAAU,KAAK,EAAEf,QAAQ,CAAClN;cAA1B;YAAR;UAArD;QADF,EAVF;MAAA,EAJF;IAAA,EAFJ,EAsBGnM,OAAO,iBACN,qBAAC,iBAAD;MAAmB,aAAa,EAAE4Z,aAAlC;MAAiD,EAAE,EAAE,CAArD;MAAwD,QAAQ,EAAC,MAAjE;MAAwE,UAAU,EAAC,UAAnF;MAAA,wBACE,oBAAC,eAAD;QAAiB,KAAK,EAAEA,aAAxB;QAAA,UACGxb,aAAa,CAAC4B,OAAD,EAAU;UAAEqa,mBAAmB,EAAE,oBAAAhB,QAAQ,CAAChG,IAAT,6FAAegH,mBAAf,gFAAoCpQ,IAApC,KAA4C;QAAnE,CAAV;MADhB,EADF,EAIGgQ,OAAO,iBACN,qBAAC,cAAD;QAAA,wBACE,6BADF,EAEGA,OAFH;MAAA,EALJ;IAAA,EAvBJ;EAAA,EADF;AAsCD,CA7CD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEA,iEAAeD,cAAf;;;;;;;;;;ACnPA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;;;AAEA,IAAMQ,kBAAW,GAAG/d,iDAAM,CAAC8d,0BAAD,CAAN,CAAuBjN,KAAvB,CAA6B;EAC/CtF,IAAI,EAAE,EADyC;EAE/C+R,KAAK,EAAE;AAFwC,CAA7B,CAAH;EAAA;EAAA;AAAA,QAAjB;AAKA,IAAMU,aAAa,GAAGhe,2EAAH;EAAA;EAAA;AAAA,wBAGf,UAAAZ,KAAK;EAAA,OACL,CAACA,KAAK,CAAC6e,MAAP,IACAva,6CADA,8EADK;AAAA,CAHU,CAAnB;AAYA;AACA;AACA;;AACA,IAAMwa,MAAM,GAAG,SAATA,MAAS,OAAsF;EAAA,IAAnFC,UAAmF,QAAnFA,UAAmF;EAAA,IAAvEC,KAAuE,QAAvEA,KAAuE;EAAA,IAAhEC,gBAAgE,QAAhEA,gBAAgE;EAAA,IAA9CpI,YAA8C,QAA9CA,YAA8C;EAAA,IAAhCnR,KAAgC,QAAhCA,KAAgC;EAAA,IAAzBwZ,OAAyB,QAAzBA,OAAyB;EAAA,IAAhBC,SAAgB,QAAhBA,SAAgB;;EACnG,sBAA8Bxf,cAAA,CAAe,KAAf,CAA9B;EAAA;EAAA,IAAOkE,OAAP;EAAA,IAAgBub,UAAhB;;EAEA,IAAI,CAACJ,KAAD,IAAUA,KAAK,CAACtV,MAAN,KAAiB,CAA/B,EAAkC;IAChC,OAAO,IAAP;EACD;;EAED,IAAM2V,OAAO,GAAGxI,YAAY,IAAIA,YAAY,CAACyI,mBAAb,CAAiCP,UAAjC,CAAhC;;EAEA,IAAMQ,cAAc;IAAA,gFAAG;MAAA;QAAA;UAAA;YAAA;cACrBH,UAAU,CAAC,IAAD,CAAV;cADqB;cAAA,OAEfD,SAAS,EAFM;;YAAA;cAGrBC,UAAU,CAAC,KAAD,CAAV;;YAHqB;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAH;;IAAA,gBAAdG,cAAc;MAAA;IAAA;EAAA,GAApB;;EAMA,oBACE;IAAK,WAAQ,QAAb;IAAA,WACGP,KAAK,CAAC7E,GAAN,CAAU,UAACqF,IAAD,EAAOC,GAAP,EAAe;MACxB,QAAQD,IAAI,CAAC3G,UAAb;QACE,KAAK,SAAL;UACE,oBACE,oBAAC,gBAAD;YAAA,uBACE,qBAAC,iBAAD;cAAA,wBACE,qBAAC,iBAAD;gBAAM,aAAa,EAAC,QAApB;gBAA6B,UAAU,EAAC,QAAxC;gBAAiD,KAAK,EAAC,MAAvD;gBAAA,wBACE,oBAAC,gBAAD;kBAAK,EAAE,EAAE,CAAT;kBAAA,uBACE,oBAAC,kBAAD;gBADF,EADF,eAIE,oBAAC,wBAAD;kBAAW,KAAK,EAAC,KAAjB;kBAAuB,MAAM,EAAC,MAA9B;kBAAqC,UAAU,EAAC;gBAAhD,EAJF;cAAA,EADF,eAOE,oBAAC,aAAD;gBAAe,MAAM,EAAE4G,GAAG,GAAG,CAAN,KAAYT,KAAK,CAACtV,MAAzC;gBAAA,uBACE,oBAAC,sBAAD;kBACE,OAAO,EAAE8V,IADX;kBAEE,SAAS,EAAEH,OAAO,IAAI3b,OAAO,CAACmT,YAAY,IAAIA,YAAY,CAAC6I,cAAb,CAA4BF,IAA5B,CAAjB,CAF/B;kBAGE,OAAO,EAAE9b,OAAO,CAACmT,YAAY,IAAIA,YAAY,CAAC6I,cAAb,CAA4BF,IAA5B,CAAjB,CAHlB;kBAIE,QAAQ,EAAE9b,OAAO,CAACmT,YAAD,CAJnB;kBAKE,QAAQ,EAAEoI,gBALZ;kBAME,SAAS,EAAEO,IAAI,CAAC/K;gBANlB;cADF,EAPF;YAAA;UADF,qBAAqB+K,IAAI,CAAChe,EAA1B,EADF;;QAsBF,KAAK,UAAL;UACE,OAAO,CAACkc,mBAAmB,CAAC8B,IAAD,CAApB,GAA6B,IAA7B,gBACL,oBAAC,gBAAD;YAAA,uBACE,qBAAC,iBAAD;cAAA,wBACE,qBAAC,iBAAD;gBAAM,aAAa,EAAC,QAApB;gBAA6B,UAAU,EAAC,QAAxC;gBAAiD,KAAK,EAAC,MAAvD;gBAAA,wBACE,oBAAC,gBAAD;kBAAK,EAAE,EAAE,CAAT;kBAAA,UAAajC,eAAe,CAACiC,IAAD,EAAO9Z,KAAP;gBAA5B,EADF,eAEE,oBAAC,wBAAD;kBAAW,KAAK,EAAC,KAAjB;kBAAuB,MAAM,EAAC,MAA9B;kBAAqC,UAAU,EAAC;gBAAhD,EAFF;cAAA,EADF,eAKE,oBAAC,aAAD;gBAAe,MAAM,EAAE+Z,GAAG,GAAG,CAAN,KAAYT,KAAK,CAACtV,MAAzC;gBAAA,uBACE,oBAAC,4BAAD;kBAA8B,QAAQ,EAAE8V;gBAAxC,GAAqBA,IAAI,CAAChe,EAA1B;cADF,EALF;YAAA;UADF,sBAAsBge,IAAI,CAAChe,EAA3B,EADF;;QAaF;UACE,OAAO,IAAP;MAvCJ;IAyCD,CA1CA,CADH,eA4CE,6BA5CF,EA6CG0d,OAAO,IAAIC,SAAX,iBACC,oBAAC,wBAAD;MAAW,MAAM,EAAC,MAAlB;MAAA,uBACE,qBAAC,2BAAD;QAAc,OAAO,EAAEI,cAAvB;QAAuC,OAAO,EAAE1b,OAAhD;QAAyD,aAAa,EAAC,YAAvE;QAAA,wBACE,oBAAC,iCAAD;UAAkB,EAAE,YAApB;UAAgC,cAAc;YAAA;YAAA;UAAA;QAA9C,EADF;MAAA;IADF,EA9CJ;EAAA,EADF;AAuDD,CAtED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgGA,sEAAelE,UAAA,CAAW2V,iCAAQ,CAACmJ,mDAAS,CAACK,MAAD,CAAV,CAAnB,CAAf;;;;;;;;;;;;;;;;;;;;AClIA;AAEO,IAAMzK,qBAAqB,GAAG7D,oEAAH,qaAA3B;AAiBA,IAAMmP,wBAAwB,GAAGnP,oEAAH,qwBAA9B;AAqCA,IAAMoP,gCAAgC,GAAGpP,oEAAH,ocAAtC;AAeA,IAAMqP,kBAAkB,GAAGrP,oEAAH,0jBAAxB;;;;;;;;;ACvEP;AACA;AAEA,yDAAe5P,uEAAM,CAACkf,uFAAD,CAArB;EAAA;EAAA;AAAA;;;;;;;;;;;;;ACHA;AACA;AAEA;AACA;AACA;AACA;AACA;;AACA,IAAM3O,YAAY,GAAG,SAAfA,YAAe,GAA6B;EAAA,+EAAP,EAAO;EAAA,wBAA1B4O,OAA0B;EAAA,IAA1BA,OAA0B,6BAAhB,IAAgB;;EAChD,sBAA8BpgB,2CAAA,EAA9B;EAAA;EAAA,IAAOqgB,QAAP;EAAA,IAAiBC,SAAjB;;EACA,uBAAwDtgB,2CAAA,EAAxD;EAAA;EAAA,IAAOugB,oBAAP;EAAA,IAA6BC,uBAA7B;;EACA,OAAO;IACLH,QAAQ,EAARA,QADK;IAELtN,IAAI,EAAE,cAAA/P,KAAK,EAAI;MACb+P,wDAAI,CAAC/P,KAAD,CAAJ;;MACAsd,SAAS,CAAC,IAAD,CAAT;;MAEA,IAAIC,oBAAJ,EAA0B;QACxBE,YAAY,CAACF,oBAAD,CAAZ;MACD;;MAED,IAAMG,SAAS,GAAGC,UAAU,CAAC,YAAM;QACjCL,SAAS,CAAC,KAAD,CAAT;MACD,CAF2B,EAEzBF,OAFyB,CAA5B;MAIAI,uBAAuB,CAACE,SAAD,CAAvB;IACD;EAfI,CAAP;AAiBD,CApBD;;AAsBA,yDAAelP,YAAf;;;;;;;;;;;AC9BA;AAEA;AACA;AACA;;AACO,IAAMxM,kBAAkB,GAAGL,gEAAH,kRAAxB","sources":["webpack://_N_E/./components/ContainerOverlay.js","webpack://_N_E/./components/InlineEditField.js","webpack://_N_E/./components/RichTextEditor.js","webpack://_N_E/./components/conversations/CommentMetadata.js","webpack://_N_E/./components/conversations/CommentActions.js","webpack://_N_E/./components/conversations/Comment.js","webpack://_N_E/./components/conversations/CommentForm.js","webpack://_N_E/./components/icons/AddReactionIcon.js","webpack://_N_E/./components/conversations/EmojiReactionPicker.js","webpack://_N_E/./components/conversations/EmojiReactions.js","webpack://_N_E/./components/conversations/ThreadActivity.js","webpack://_N_E/./components/conversations/Thread.js","webpack://_N_E/./components/conversations/graphql.js","webpack://_N_E/./components/icons/CommentIcon.js","webpack://_N_E/./lib/hooks/useClipboard.js","webpack://_N_E/./lib/styled-components-shared-styles.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { isNil } from 'lodash';\n\nimport Container from './Container';\n\n/**\n * A specialization of `Container` that displays itself above the content, in position\n * absolute, with a dark background and content centered.\n *\n * Accepts all the props from `Container`.\n */\nconst ContainerOverlay = ({ backgroundType, backgroundOpacity, ...props }) => {\n  const isDark = backgroundType === 'dark';\n  const defaultOpacity = isDark ? 0.5 : 0.75;\n  const opacity = !isNil(backgroundOpacity) ? backgroundOpacity : defaultOpacity;\n  const lightness = isDark ? '30' : '255';\n  return (\n    <Container\n      position=\"absolute\"\n      display=\"flex\"\n      flexDirection=\"column\"\n      justifyContent=\"center\"\n      alignItems=\"center\"\n      background={`rgba(${lightness}, ${lightness}, ${lightness}, ${opacity})`}\n      width=\"100%\"\n      height=\"100%\"\n      zIndex={9999}\n      {...props}\n    />\n  );\n};\n\nContainerOverlay.propTypes = {\n  backgroundType: PropTypes.oneOf(['dark', 'white']),\n  /** If omitted, will use 0.5 for dark and 0.75 for black */\n  backgroundOpacity: PropTypes.number,\n};\n\nContainerOverlay.defaultProps = {\n  backgroundType: 'white',\n};\n\nexport default ContainerOverlay;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Mutation } from '@apollo/client/react/components';\nimport { PencilAlt } from '@styled-icons/fa-solid/PencilAlt';\nimport { get, pick } from 'lodash';\nimport { defineMessages, FormattedMessage, injectIntl } from 'react-intl';\nimport styled from 'styled-components';\n\nimport Container from './Container';\nimport { Box, Flex } from './Grid';\nimport MessageBox from './MessageBox';\nimport StyledButton from './StyledButton';\nimport { fadeIn } from './StyledKeyframes';\nimport StyledTextarea from './StyledTextarea';\nimport WarnIfUnsavedChanges from './WarnIfUnsavedChanges';\n\n/** Container used to show the description to users than can edit it */\nconst EditIcon = styled(PencilAlt)`\n  cursor: pointer;\n  background-color: white;\n  border: 1px solid #aaaeb3;\n  border-radius: 25%;\n  padding: 15%;\n  color: #aaaeb3;\n\n  &:hover {\n    color: #8697ad;\n  }\n`;\n\n/** Component used for cancel / submit buttons */\nconst FormButton = styled(StyledButton)`\n  width: 35%;\n  font-weight: normal;\n  text-transform: capitalize;\n  margin: 4px 8px;\n  animation: ${fadeIn} 0.3s;\n`;\n\nconst messages = defineMessages({\n  warnDiscardChanges: {\n    id: 'warning.discardUnsavedChanges',\n    defaultMessage: 'Are you sure you want to discard your unsaved changes?',\n  },\n});\n\n/**\n * A field that can be edited inline. Relies directly on GraphQL to handle errors and\n * loading states properly. By default this component will use `TextAreaAutosize`\n * but you can override this behaviour by passing a custom `children` prop.\n */\nclass InlineEditField extends Component {\n  static propTypes = {\n    /** Field name */\n    field: PropTypes.string.isRequired,\n    /** Object that holds the values */\n    values: PropTypes.object.isRequired,\n    /** The GraphQL mutation used to update this value */\n    mutation: PropTypes.object.isRequired,\n    /** Passed to Apollo */\n    mutationOptions: PropTypes.object,\n    /** Can user edit the description */\n    canEdit: PropTypes.bool,\n    /** Use this to control the component state */\n    isEditing: PropTypes.bool,\n    /** Add a confirm if trying to leave the form with unsaved changes */\n    warnIfUnsavedChanges: PropTypes.bool,\n    required: PropTypes.bool,\n    /** Max field length */\n    maxLength: PropTypes.number,\n    /** Gets passed the item, the new value and must return the mutation variables */\n    prepareVariables: PropTypes.func,\n    /** For cases when component is controlled */\n    disableEditor: PropTypes.func,\n    /** Set to false to disable edit icon even if user is allowed to edit */\n    showEditIcon: PropTypes.bool,\n    /** If given, this function will be used to render the field */\n    children: PropTypes.func,\n    /**\n     * A text that will be rendered if user can edit and there's no value available.\n     * Highly recommended if field is nullable.\n     */\n    placeholder: PropTypes.node,\n    /** To set the min width of Cancel/Save buttons */\n    buttonsMinWidth: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n    /** Editing the top value. */\n    topEdit: PropTypes.number,\n    /** @ignore from injectIntl */\n    intl: PropTypes.object.isRequired,\n  };\n\n  static defaultProps = {\n    showEditIcon: true,\n    buttonsMinWidth: 225,\n    topEdit: -5,\n  };\n\n  state = { isEditing: false, draft: '', uploading: false };\n\n  componentDidUpdate(oldProps) {\n    if (oldProps.isEditing !== this.props.isEditing) {\n      if (this.props.isEditing) {\n        this.setState({ isEditing: true, draft: get(this.props.values, this.props.field) });\n      } else {\n        this.setState({ isEditing: false });\n      }\n    }\n  }\n\n  enableEditor = () => {\n    this.setState({ isEditing: true, draft: get(this.props.values, this.props.field) });\n  };\n\n  disableEditor = noWarning => {\n    const { warnIfUnsavedChanges, intl, values, field } = this.props;\n    if (!noWarning && warnIfUnsavedChanges) {\n      const isDirty = get(values, field) !== this.state.draft;\n      if (isDirty && !confirm(intl.formatMessage(messages.warnDiscardChanges))) {\n        return;\n      }\n    }\n\n    this.setState({ isEditing: false });\n\n    if (this.props.disableEditor) {\n      this.props.disableEditor();\n    }\n  };\n\n  setDraft = draft => {\n    this.setState({ draft });\n  };\n\n  renderContent(field, canEdit, value, placeholder, children) {\n    if (children) {\n      return children({\n        value,\n        isEditing: false,\n        enableEditor: this.enableEditor,\n        disableEditor: this.disableEditor,\n        setValue: this.setDraft,\n      });\n    } else if (!value) {\n      return canEdit && placeholder ? (\n        <StyledButton buttonSize=\"large\" onClick={this.enableEditor} data-cy={`InlineEditField-Add-${field}`}>\n          {placeholder}\n        </StyledButton>\n      ) : null;\n    } else {\n      return <span>{value}</span>;\n    }\n  }\n\n  render() {\n    const {\n      field,\n      values,\n      mutation,\n      canEdit,\n      prepareVariables,\n      showEditIcon,\n      placeholder,\n      children,\n      topEdit,\n      mutationOptions,\n      warnIfUnsavedChanges,\n    } = this.props;\n    const { draft, isEditing } = this.state;\n    const { buttonsMinWidth } = this.props;\n    const value = get(values, field);\n    const touched = draft !== value;\n    const isValid = !this.props.required ? touched : touched && Boolean(draft);\n\n    if (!isEditing) {\n      return (\n        <Container position=\"relative\">\n          {canEdit && showEditIcon && (\n            <Container position=\"absolute\" top={topEdit} right={-5} zIndex={2}>\n              <EditIcon size={24} onClick={this.enableEditor} data-cy={`InlineEditField-Trigger-${field}`} />\n            </Container>\n          )}\n          {this.renderContent(field, canEdit, value, placeholder, children)}\n        </Container>\n      );\n    } else {\n      return (\n        <WarnIfUnsavedChanges hasUnsavedChanges={warnIfUnsavedChanges && isValid}>\n          <Mutation mutation={mutation} {...mutationOptions}>\n            {(updateField, { loading, error }) => (\n              <React.Fragment>\n                {children ? (\n                  children({\n                    isEditing: true,\n                    value: draft,\n                    maxLength: this.props.maxLength,\n                    setValue: this.setDraft,\n                    enableEditor: this.enableEditor,\n                    disableEditor: this.disableEditor,\n                    setUploading: uploading => this.setState({ uploading }),\n                  })\n                ) : (\n                  <StyledTextarea\n                    autoSize\n                    autoFocus\n                    width={1}\n                    value={draft || ''}\n                    onChange={e => this.setDraft(e.target.value)}\n                    px={0}\n                    py={0}\n                    border=\"0\"\n                    letterSpacing=\"inherit\"\n                    fontSize=\"inherit\"\n                    fontWeight=\"inherit\"\n                    lineHeight=\"inherit\"\n                    maxLength={this.props.maxLength}\n                    data-cy={`InlineEditField-Textarea-${field}`}\n                    withOutline\n                  />\n                )}\n                <Box width={1}>\n                  {error && (\n                    <MessageBox type=\"error\" my={2} fontSize=\"14px\" lineHeight=\"20px\" fontWeight=\"normal\" withIcon>\n                      {error.message}\n                    </MessageBox>\n                  )}\n                  <Flex flexWrap=\"wrap\" justifyContent=\"space-evenly\" mt={3}>\n                    <FormButton\n                      data-cy=\"InlineEditField-Btn-Cancel\"\n                      disabled={loading}\n                      minWidth={buttonsMinWidth}\n                      onClick={this.disableEditor}\n                    >\n                      <FormattedMessage id=\"form.cancel\" defaultMessage=\"cancel\" />\n                    </FormButton>\n                    <FormButton\n                      buttonStyle=\"primary\"\n                      loading={loading}\n                      disabled={!isValid || this.state.uploading}\n                      data-cy=\"InlineEditField-Btn-Save\"\n                      minWidth={buttonsMinWidth}\n                      onClick={() => {\n                        let variables = null;\n                        if (prepareVariables) {\n                          variables = prepareVariables(values, draft);\n                        } else {\n                          variables = pick(values, ['id']);\n                          variables[field] = draft;\n                        }\n\n                        updateField({ variables }).then(() => this.disableEditor(true));\n                      }}\n                    >\n                      {this.state.uploading ? (\n                        <FormattedMessage id=\"uploadImage.isUploading\" defaultMessage=\"Uploading image...\" />\n                      ) : (\n                        <FormattedMessage id=\"save\" defaultMessage=\"Save\" />\n                      )}\n                    </FormButton>\n                  </Flex>\n                </Box>\n              </React.Fragment>\n            )}\n          </Mutation>\n        </WarnIfUnsavedChanges>\n      );\n    }\n  }\n}\n\nexport default injectIntl(InlineEditField);\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { css } from '@styled-system/css';\nimport { get } from 'lodash';\nimport styled from 'styled-components';\nimport { v4 as uuid } from 'uuid';\nimport { isURL } from 'validator';\n\nimport { uploadImageWithXHR } from '../lib/api';\nimport { CustomScrollbarCSS } from '../lib/styled-components-shared-styles';\nimport { stripHTML } from '../lib/utils';\n\nimport Container from './Container';\nimport HTMLContent from './HTMLContent';\nimport LoadingPlaceholder from './LoadingPlaceholder';\nimport MessageBox from './MessageBox';\nimport StyledTag from './StyledTag';\n\nconst TrixEditorContainer = styled.div`\n  ${props =>\n    props.withBorders &&\n    css({\n      border: '1px solid',\n      borderColor: !props.error ? 'black.300' : 'red.300',\n      borderRadius: 10,\n      padding: 3,\n    })}\n\n  trix-editor {\n    border: none;\n    padding: 0;\n    margin-top: 8px;\n    padding-top: 8px;\n    outline-offset: 0.5em;\n    ${CustomScrollbarCSS}\n    &::-webkit-scrollbar {\n      width: 8px;\n    }\n    ${props => Boolean(props.editorMaxHeight) && css({ overflowY: 'scroll' })}\n\n    // Outline (only when there's no border)\n    ${props =>\n      !props.withBorders &&\n      css({\n        outline: !props.error ? 'none' : `1px dashed ${props.theme.colors.red[300]}`,\n        '&:focus': {\n          outline: `1px dashed ${props.theme.colors.black[200]}`,\n        },\n      })}\n\n    // Placeholder\n    &:empty:not(:focus)::before {\n      color: ${props => props.theme.colors.black[400]};\n    }\n\n    // Image captions are disabled\n    figcaption {\n      display: none;\n    }\n\n    ${props =>\n      css({\n        minHeight: props.editorMinHeight,\n        maxHeight: props.editorMaxHeight,\n      })}\n  }\n\n  trix-toolbar {\n    min-height: 40px;\n    background: ${props => props.toolbarBackgroundColor};\n    ${props => !props.withBorders && `box-shadow: 0px 5px 3px -3px rgba(0, 0, 0, 0.1);`}\n    z-index: 2;\n    margin-bottom: 8px;\n    ${props => props.withBorders && `min-height: 0px; margin-bottom: 0;`}\n\n    .trix-button-group {\n      border-radius: 6px;\n      border-color: #c4c7cc;\n      margin-bottom: 0;\n      background: white;\n    }\n\n    .trix-button {\n      border-bottom: none;\n      display: inline-block;\n      height: auto;\n\n      &:hover {\n        background: ${props => props.theme.colors.blue[100]};\n      }\n\n      &.trix-active {\n        background: ${props => props.theme.colors.blue[200]};\n      }\n\n      &::before,\n      &.trix-active::before {\n        margin: 4px; // Use this to reduce the icons size\n      }\n    }\n\n    /** Hide some buttons on the simplified version */\n    ${props =>\n      props.version === 'simplified' &&\n      css({\n        '.trix-button-group--file-tools': {\n          display: 'none',\n        },\n        '.trix-button-group--block-tools .trix-button:not(.trix-button--icon-number-list):not(.trix-button--icon-bullet-list)':\n          {\n            display: 'none',\n          },\n        '.trix-button--icon-bullet-list': {\n          borderLeft: 'none',\n        },\n      })}\n\n    /** Hide some buttons on mobile */\n    @media (max-width: 500px) {\n      .trix-button--icon-strike,\n      .trix-button--icon-number-list,\n      .trix-button--icon-decrease-nesting-level,\n      .trix-button--icon-increase-nesting-level {\n        display: none;\n      }\n    }\n\n    /** Sticky mode */\n    ${props =>\n      props.withStickyToolbar &&\n      css({\n        position: 'sticky',\n        top: props.toolbarTop || 0,\n        marginTop: props.toolbarOffsetY,\n        p: '10px',\n      })}\n\n    /** Custom icons */\n    .trix-button--icon-attach::before {\n      // See https://feathericons.com/?query=image\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='18' height='18' rx='2' ry='2'/%3E%3Ccircle cx='8.5' cy='8.5' r='1.5'/%3E%3Cpolyline points='21 15 16 10 5 21'/%3E%3C/svg%3E\");\n    }\n    .trix-button--video-attach::before {\n      top: 8%;\n      bottom: 4%;\n      // See https://feathericons.com/?query=video\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-video'%3E%3Cpolygon points='23 7 16 12 23 17 23 7'%3E%3C/polygon%3E%3Crect x='1' y='5' width='15' height='14' rx='2' ry='2'%3E%3C/rect%3E%3C/svg%3E\");\n    }\n  } // End of toolbar customization\n\n  /** Disabled mode */\n  ${props =>\n    props.isDisabled &&\n    css({\n      pointerEvents: 'none',\n      cursor: 'not-allowed',\n      background: '#f3f3f3',\n      'trix-toolbar,.trix-button-group': {\n        background: '#f3f3f3 !important',\n      },\n    })}\n`;\n\nconst SUPPORTED_SERVICE_URLS = { youTube: 'https://www.youtube-nocookie.com/embed/', anchorFm: 'https://anchor.fm/' };\n\n/**\n * A React wrapper around the Trix library to edit rich text.\n * Produces HTML and clear text.\n */\nexport default class RichTextEditor extends React.Component {\n  static propTypes = {\n    /** If not provided, an id will be automatically generated which will require a component update */\n    id: PropTypes.string,\n    defaultValue: PropTypes.string,\n    value: PropTypes.string,\n    placeholder: PropTypes.string,\n    toolbarBackgroundColor: PropTypes.string.isRequired,\n    /** A unique identified for the category of uploaded files. Required if version is not \"simplified\" */\n    kind: PropTypes.string,\n    /** Font size for the text */\n    fontSize: PropTypes.string,\n    autoFocus: PropTypes.bool,\n    /** Called when text is changed with html content as first param and text content as second param */\n    onChange: PropTypes.func,\n    /** A name for the input */\n    inputName: PropTypes.string,\n    /** Change this prop to reset the value */\n    reset: PropTypes.any,\n    /** If true, max text length will be displayed at the bottom right */\n    showCount: PropTypes.bool,\n    /** max length which is allowed */\n    maxLength: PropTypes.number,\n    /** Whether the toolbar should stick to the top */\n    withStickyToolbar: PropTypes.bool,\n    /** This component is borderless by default. Set this to `true` to change that. */\n    withBorders: PropTypes.bool,\n    /** This component is borderless by default. Set this to `true` to change that. */\n    version: PropTypes.oneOf(['default', 'simplified']),\n    /** Whether the field should be disabled */\n    disabled: PropTypes.bool,\n    /** If position is sticky, this prop defines the `top` property. Support responsive arrays */\n    toolbarTop: PropTypes.oneOfType([PropTypes.number, PropTypes.string, PropTypes.array]),\n    /** Useful to compensate the height of the toolbar when editing inline */\n    toolbarOffsetY: PropTypes.oneOfType([PropTypes.number, PropTypes.string, PropTypes.array]),\n    /** Min height for the full component */\n    editorMinHeight: PropTypes.oneOfType([PropTypes.number, PropTypes.string, PropTypes.array]),\n    editorMaxHeight: PropTypes.oneOfType([PropTypes.number, PropTypes.string, PropTypes.array]),\n    /** If truthy, will display a red outline */\n    error: PropTypes.any,\n    'data-cy': PropTypes.string,\n    videoEmbedEnabled: PropTypes.bool,\n    /** Called when an image is being uploaded to set a boolean */\n    setUploading: PropTypes.func,\n  };\n\n  static defaultProps = {\n    withStickyToolbar: false,\n    toolbarTop: 0,\n    toolbarOffsetY: -62, // Default Trix toolbar height\n    inputName: 'content',\n    toolbarBackgroundColor: 'white',\n    version: 'default',\n    'data-cy': 'RichTextEditor',\n    videoEmbedEnabled: false,\n  };\n\n  constructor(props) {\n    super(props);\n    this.editorRef = React.createRef();\n    this.mainContainerRef = React.createRef();\n    this.state = { id: props.id, error: null };\n    this.isReady = false;\n\n    if (typeof window !== 'undefined') {\n      this.Trix = require('trix');\n      this.Trix.config.blockAttributes.heading1 = { tagName: 'h3' };\n      this.Trix.config.attachments.preview.caption = { name: false, size: false };\n    }\n  }\n\n  componentDidMount() {\n    if (!this.state.id) {\n      this.setState({ id: uuid() });\n    } else if (!this.isReady) {\n      this.initialize();\n    }\n  }\n\n  componentDidUpdate(oldProps) {\n    if (!this.isReady) {\n      this.initialize();\n    } else if (oldProps.reset !== this.props.reset) {\n      this.editorRef.current.editor.loadHTML('');\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.isReady) {\n      this.editorRef.current.removeEventListener('trix-change', this.handleChange);\n      this.editorRef.current.removeEventListener('trix-attachment-add', this.handleUpload);\n      this.editorRef.current.removeEventListener('trix-attachment-add', this.handleFileAccept);\n      this.editorRef.current.removeEventListener('trix-action-invoke', this.trixActionInvoke);\n    }\n  }\n\n  getEditor() {\n    return this.editorRef.current.editor;\n  }\n\n  initialize = () => {\n    if (this.Trix && this.editorRef.current) {\n      // Listen for changes\n      this.editorRef.current.addEventListener('trix-change', this.handleChange, false);\n      this.editorRef.current.addEventListener('trix-attachment-add', this.handleUpload);\n      this.editorRef.current.addEventListener('trix-file-accept', this.handleFileAccept);\n      this.editorRef.current.addEventListener('trix-action-invoke', this.trixActionInvoke);\n      this.editorRef.current.addEventListener('trix-initialize', event => {\n        if (this.props.videoEmbedEnabled) {\n          this.replaceEmbeddedIFrames(this.props.value || this.props.defaultValue);\n          this.trixEmbed(event);\n        }\n        // Some special handling for links\n        if (this.mainContainerRef.current) {\n          // We must listen when the user presses the 'Enter' key and when the user clicks the 'Link' button as well\n          const linkInput = this.mainContainerRef.current.querySelector(\"[data-trix-input][name='href']\");\n          linkInput?.addEventListener('keydown', e => {\n            if (e.key === 'Enter') {\n              this.handleLink();\n            }\n          });\n\n          const addLinkBtn = this.mainContainerRef.current.querySelector(\"[data-trix-method='setAttribute']\");\n          addLinkBtn?.addEventListener('click', this.handleLink);\n        }\n      });\n\n      // Component ready!\n      this.isReady = true;\n    }\n  };\n\n  /** ---- Trix handlers ---- */\n\n  replaceEmbeddedIFrames = value => {\n    const iframeRegex = new RegExp(`<iframe.+?iframe>`, 'ig');\n    let match;\n    let lastIndex = 0;\n\n    while ((match = iframeRegex.exec(value))) {\n      if (lastIndex === 0) {\n        this.getEditor().loadHTML('');\n      }\n      const iframe = match[0];\n      const position = match.index;\n      const preText = value.substring(lastIndex, position);\n      this.getEditor().setSelectedRange([lastIndex, position]);\n      this.getEditor().insertHTML(preText);\n      const attachment = new this.Trix.Attachment({ content: iframe });\n      this.getEditor().insertAttachment(attachment);\n      lastIndex = match.index + iframe.length;\n      const postText = value.substring(lastIndex, value.length);\n      this.getEditor().insertHTML(postText);\n    }\n  };\n\n  trixEmbed = e => {\n    const videoEmbedButton = `<button type=\"button\" tabindex=\"-1\" data-trix-action=\"x-video-dialog-open\" title=\"Attach Video\" class=\"trix-button trix-button--icon trix-button--video-attach\">Attach Video</button>`;\n    const videoEmbedDialog = `\n            <div class=\"trix-dialog\" data-trix-dialog=\"video-url\" data-trix-dialog-attribute=\"video\">\n              <div class=\"trix-dialog__link-fields\">\n                <input type=\"url\" name=\"video-url\" class=\"trix-input trix-input--dialog trix-input--dialog-embed\" placeholder=\"Enter Video URL\" aria-label=\"Video URL\" data-trix-input=\"\">\n                <div class=\"trix-button-group\">\n                  <input type=\"button\" class=\"trix-button trix-button--dialog\" value=\"Add Video\" data-trix-action=\"x-add-embed\">\n                </div>\n              </div>\n              <strong>Note: Only YouTube and Anchor.fm links are supported.</strong>\n            </div>`;\n    const { toolbarElement } = e.target;\n    const attachFilesButton = toolbarElement.querySelector('[data-trix-action=attachFiles]');\n    attachFilesButton.insertAdjacentHTML('afterend', videoEmbedButton);\n    const trixDialog = toolbarElement.querySelector('.trix-dialog--link');\n    trixDialog.insertAdjacentHTML('afterend', videoEmbedDialog);\n  };\n\n  trixActionInvoke = e => {\n    const { toolbarElement } = e.target;\n    if (e.actionName === 'x-video-dialog-open') {\n      const attachVideoDialog = toolbarElement.querySelector('[data-trix-dialog=video-url]');\n      const attachVideoDialogInput = toolbarElement.querySelector('.trix-input--dialog-embed');\n      if (attachVideoDialog.getAttribute('data-trix-active') === '') {\n        attachVideoDialog.removeAttribute('data-trix-active');\n      } else {\n        attachVideoDialog.setAttribute('data-trix-active', '');\n        attachVideoDialogInput.removeAttribute('disabled');\n      }\n    } else if (e.actionName === 'x-add-embed') {\n      const embedLink = toolbarElement.querySelector('.trix-input--dialog-embed').value?.trim();\n      if (embedLink) {\n        this.embedIframe(embedLink);\n      }\n    }\n  };\n\n  constructVideoEmbedURL = (service, id) => {\n    if (service === 'youtube') {\n      return `${SUPPORTED_SERVICE_URLS.youTube}${id}`;\n    } /* else if (service === 'vimeo') {\n      return `https://player.vimeo.com/video/${id}`;\n    } */ else if (service === 'anchorFm') {\n      return `${SUPPORTED_SERVICE_URLS.anchorFm}${id}`;\n    } else {\n      return null;\n    }\n  };\n\n  parseServiceLink = videoLink => {\n    const regexps = {\n      youtube: new RegExp(\n        '(?:https?://)?(?:www\\\\.)?youtu(?:\\\\.be/|be\\\\.com/\\\\S*(?:watch|embed)(?:(?:(?=/[^&\\\\s?]+(?!\\\\S))/)|(?:\\\\S*v=|v/)))([^&\\\\s?]+)',\n        'i',\n      ),\n      vimeo: new RegExp(\n        '(http|https)?://(www\\\\.)?vimeo\\\\.com/(?:channels/(?:\\\\w+/)?|groups/([^/]*)/videos/|)(\\\\d+)(?:|/?)',\n      ),\n      anchorFm: /^(http|https)?:\\/\\/(www\\.)?anchor\\.fm\\/([^/]+)(\\/embed)?(\\/episodes\\/)?([^/]+)?\\/?$/,\n    };\n    for (const service in regexps) {\n      const matches = regexps[service].exec(videoLink);\n      if (matches) {\n        if (service === 'anchorFm') {\n          const podcastName = matches[3];\n          const episodeId = matches[6];\n          const podcastUrl = `${podcastName}/embed`;\n          return { service, id: episodeId ? `${podcastUrl}/episodes/${episodeId}` : podcastUrl };\n        } else {\n          return { service, id: matches[matches.length - 1] };\n        }\n      }\n    }\n    return {};\n  };\n\n  embedIframe = videoLink => {\n    const { id, service } = this.parseServiceLink(videoLink);\n    const embedLink = this.constructVideoEmbedURL(service, id);\n    if (embedLink) {\n      const sanitizedLink = embedLink.replace(/[\"\\\\]/g, ''); // Small security enhancement, prevents going out of `src`\n      const videoServices = ['youtube', 'vimeo'];\n      let attachmentData;\n      if (videoServices.includes(service)) {\n        attachmentData = {\n          contentType: '--embed-iframe-video',\n          content: `<iframe src=\"${sanitizedLink}/?showinfo=0\" width=\"100%\" height=\"394\" frameborder=\"0\" allowfullscreen/>`,\n        };\n      } else {\n        attachmentData = {\n          contentType: `--embed-iframe-${service}`,\n          content: `<iframe src=\"${sanitizedLink}\" width=\"100%\" frameborder=\"0\"/>`,\n        };\n      }\n\n      this.getEditor().insertAttachment(new this.Trix.Attachment(attachmentData));\n    }\n  };\n\n  handleChange = e => {\n    // Trigger content formatters\n    this.autolink();\n\n    // Notify parent function\n    if (this.props.onChange) {\n      this.props.onChange(e);\n    }\n\n    // Reset errors\n    if (this.state.error) {\n      this.setState({ error: null });\n    }\n  };\n\n  handleFileAccept = e => {\n    if (!/^image\\//.test(e.file.type)) {\n      alert('You can only upload images.');\n      e.preventDefault();\n    } else if (e.file.size > 4000000) {\n      // Prevent attaching files > 4MB\n      alert('This file is too big (max: 4mb).');\n      e.preventDefault();\n    }\n  };\n\n  handleUpload = e => {\n    const { attachment } = e;\n    const attachmentContent = get(attachment, 'attachment.attributes.values.content');\n    const isVideoAttachment =\n      attachmentContent?.includes(`<iframe src=\"${SUPPORTED_SERVICE_URLS.youTube}`) ||\n      attachmentContent?.includes(`<iframe src=\"${SUPPORTED_SERVICE_URLS.anchorFm}`);\n    if (isVideoAttachment) {\n      return;\n    } else if (!attachment.file) {\n      attachment.remove(); // Remove unknown stuff, for example when copy-pasting HTML\n      return;\n    }\n\n    this.props.setUploading?.(true);\n\n    const onProgress = progress => attachment.setUploadProgress(progress);\n    const onSuccess = fileURL => {\n      this.props.setUploading?.(false);\n      attachment.setAttributes({ url: fileURL, href: fileURL });\n    };\n    const onFailure = () => {\n      this.props.setUploading?.(false);\n      this.setState({ error: 'File upload failed' });\n      attachment.remove();\n    };\n    uploadImageWithXHR(attachment.file, this.props.kind, { onProgress, onSuccess, onFailure });\n    return e;\n  };\n\n  handleLink = () => {\n    const urlInput = this.mainContainerRef.current?.querySelector(\"[data-trix-input][name='href']\");\n    const urlInputValue = urlInput?.value?.trim();\n\n    // Ignore missing input or empty values\n    if (!urlInputValue) {\n      return;\n    }\n\n    // Automatically add 'https://' to the url\n    // eslint-disable-next-line camelcase\n    if (isURL(urlInputValue, { require_protocol: false }) && !isURL(urlInputValue, { require_protocol: true })) {\n      urlInput.value = `https://${urlInputValue}`;\n    }\n  };\n\n  /** Automatically create anchors with hrefs for links */\n  autolink() {\n    const linkRegex = new RegExp(`(https?://\\\\S+\\\\.\\\\S+)\\\\s`, 'ig');\n    const editor = this.getEditor();\n    const content = editor.getDocument().toString();\n    let match;\n    while ((match = linkRegex.exec(content))) {\n      const url = match[1];\n      if (isURL(url)) {\n        const position = match.index;\n        const urlLength = this.autolinkDelimiter(url);\n        const range = [position, position + urlLength];\n        const hrefAtRange = editor.getDocument().getCommonAttributesAtRange(range).href;\n        const newURL = url.slice(0, urlLength);\n        if (hrefAtRange !== newURL) {\n          this.updateInRange(editor, range, 0, () => {\n            if (editor.canActivateAttribute('href')) {\n              editor.activateAttribute('href', newURL);\n            }\n          });\n        }\n      }\n    }\n  }\n\n  /** A helper used by autolink to find where the url actually ends\n   * Credits:\n   * https://github.com/github/cmark-gfm/blob/36c1553d2a1f04dc1628e76b18490edeff78b8d0/extensions/autolink.c#L37\n   * https://github.com/vmg/redcarpet/blob/92a7b3ae2241b862e9bf45e0af3cf53ebdfb0afb/ext/redcarpet/autolink.c#L58\n   */\n  autolinkDelimiter = url => {\n    let lastCharacterPosition = url.length;\n\n    while (lastCharacterPosition > 0) {\n      const lastCharacterIndex = lastCharacterPosition - 1;\n      const closingPair = url[lastCharacterIndex];\n\n      let openingPair;\n      if (closingPair === ')') {\n        openingPair = '(';\n      } else if (closingPair === ']') {\n        openingPair = '[';\n      } else if (closingPair === '}') {\n        openingPair = '{';\n      } else if (closingPair === '\"') {\n        openingPair = '\"';\n      } else if (closingPair === \"'\") {\n        openingPair = \"'\";\n      }\n\n      // Ensure single punctuations marks at the end of the URL are not included as part of link\n      if ('?!.,:;*_~'.includes(url[lastCharacterIndex])) {\n        lastCharacterPosition--;\n      } else if (openingPair) {\n        let opening = 0,\n          closing = 0;\n\n        /** Check to ensure that when a URL is enclosed within pair punctuations,\n         * we do not include the closing punctuation as part of the link.\n         * We only want to accept a closing punctuation at the end of the link,\n         * if there is a corresponding opening punctuation within the URL.\n         */\n\n        for (let i = 0; i < lastCharacterPosition; i++) {\n          if (url[i] === openingPair) {\n            opening++;\n          } else if (url[i] === closingPair) {\n            closing++;\n          }\n        }\n\n        if (opening >= closing) {\n          break;\n        }\n\n        lastCharacterPosition--;\n      } else {\n        break;\n      }\n    }\n\n    return lastCharacterPosition;\n  };\n\n  /** A trix helper that will apply func in range then restore base range when it's done */\n  updateInRange(editor, range, offset = 0, updateFunc) {\n    const baseRange = editor.getSelectedRange();\n    editor.setSelectedRange(range);\n    updateFunc();\n    editor.setSelectedRange([baseRange[0] + offset, baseRange[1] + offset]);\n  }\n\n  /** ---- Render ---- */\n\n  render() {\n    const {\n      defaultValue,\n      withStickyToolbar,\n      toolbarTop,\n      toolbarOffsetY,\n      toolbarBackgroundColor,\n      autoFocus,\n      placeholder,\n      editorMinHeight,\n      withBorders,\n      inputName,\n      disabled,\n      error,\n      fontSize,\n      value,\n      version,\n      showCount,\n      maxLength,\n      editorMaxHeight,\n    } = this.props;\n\n    return !this.state.id ? (\n      <LoadingPlaceholder\n        maxHeight={editorMaxHeight ? editorMaxHeight + 56 : undefined}\n        height={editorMinHeight ? editorMinHeight + 56 : 200}\n      />\n    ) : (\n      <TrixEditorContainer\n        withStickyToolbar={withStickyToolbar}\n        toolbarTop={toolbarTop}\n        toolbarOffsetY={toolbarOffsetY}\n        toolbarBackgroundColor={toolbarBackgroundColor}\n        editorMinHeight={editorMinHeight}\n        editorMaxHeight={editorMaxHeight}\n        withBorders={withBorders}\n        version={version}\n        isDisabled={disabled}\n        error={error}\n        data-cy={this.props['data-cy']}\n        ref={this.mainContainerRef}\n      >\n        {this.state.error && (\n          <MessageBox type=\"error\" mb=\"36px\" withIcon>\n            {this.state.error.toString()}\n          </MessageBox>\n        )}\n        <input id={this.state.id} value={value || defaultValue} type=\"hidden\" name={inputName} />\n        <HTMLContent fontSize={fontSize}>\n          {!showCount ? (\n            <trix-editor\n              ref={this.editorRef}\n              input={this.state.id}\n              autofocus={autoFocus ? true : undefined}\n              placeholder={placeholder}\n            />\n          ) : (\n            <Container position=\"relative\">\n              <trix-editor\n                ref={this.editorRef}\n                input={this.state.id}\n                autofocus={autoFocus ? true : undefined}\n                placeholder={placeholder}\n              />\n              <Container position=\"absolute\" bottom=\"1em\" right=\"1em\">\n                <StyledTag textTransform=\"uppercase\">\n                  <span>{stripHTML(value || defaultValue).length}</span>\n                  {maxLength && <span> / {maxLength}</span>}\n                </StyledTag>\n              </Container>\n            </Container>\n          )}\n        </HTMLContent>\n      </TrixEditorContainer>\n    );\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { FormattedMessage } from 'react-intl';\n\nimport Avatar from '../Avatar';\nimport { Box, Flex } from '../Grid';\nimport LinkCollective from '../LinkCollective';\nimport { P } from '../Text';\n\nexport const CommentMetadata = ({ comment }) => {\n  return (\n    <Flex>\n      <Box mr={3}>\n        <LinkCollective collective={comment.fromAccount}>\n          <Avatar collective={comment.fromAccount} radius={40} />\n        </LinkCollective>\n      </Box>\n      <Flex flexDirection=\"column\">\n        <LinkCollective collective={comment.fromAccount}>\n          <P color=\"black.800\" fontWeight=\"500\" lineHeight=\"22px\" truncateOverflow>\n            {comment.fromAccount.name}\n          </P>\n        </LinkCollective>\n        <P fontSize=\"12px\" color=\"black.600\" truncateOverflow title={comment.createdAt}>\n          <FormattedMessage\n            id=\"Comment.PostedOn\"\n            defaultMessage=\"Posted on {createdAt, date, long}\"\n            values={{ createdAt: new Date(comment.createdAt) }}\n          />\n        </P>\n      </Flex>\n    </Flex>\n  );\n};\n\nCommentMetadata.propTypes = {\n  comment: PropTypes.shape({\n    fromAccount: PropTypes.shape({\n      name: PropTypes.string.isRequired,\n      slug: PropTypes.string.isRequired,\n      type: PropTypes.string.isRequired,\n    }).isRequired,\n    createdAt: PropTypes.string.isRequired,\n  }).isRequired,\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gql, useMutation } from '@apollo/client';\nimport { DotsHorizontalRounded } from '@styled-icons/boxicons-regular/DotsHorizontalRounded';\nimport { Share2 as ShareIcon } from '@styled-icons/feather/Share2';\nimport { X } from '@styled-icons/feather/X';\nimport { Edit } from '@styled-icons/material/Edit';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { usePopper } from 'react-popper';\nimport styled from 'styled-components';\n\nimport { i18nGraphqlException } from '../../lib/errors';\nimport { API_V2_CONTEXT } from '../../lib/graphql/helpers';\nimport useClipboard from '../../lib/hooks/useClipboard';\nimport useGlobalBlur from '../../lib/hooks/useGlobalBlur';\n\nimport ConfirmationModal from '../ConfirmationModal';\nimport Container from '../Container';\nimport { Flex } from '../Grid';\nimport HTMLContent from '../HTMLContent';\nimport MessageBox from '../MessageBox';\nimport StyledButton from '../StyledButton';\nimport StyledHr from '../StyledHr';\nimport { P } from '../Text';\n\nimport { CommentMetadata } from './CommentMetadata';\n\nconst AdminActionsPopupContainer = styled(Flex)`\n  flex-direction: column;\n  background: #ffffff;\n  border: 1px solid rgba(49, 50, 51, 0.1);\n  border-radius: 8px;\n  box-shadow: 0px 4px 8px rgba(20, 20, 20, 0.16);\n  width: 184px;\n  padding: 16px;\n  z-index: 1;\n`;\n\nconst CommentBtn = styled(StyledButton).attrs({ buttonSize: 'small' })`\n  padding: 3px 5px;\n  margin: 5px 0;\n  width: 100%;\n  text-align: left;\n  border: none;\n\n  span {\n    margin-left: 12px;\n    font-weight: 500;\n    font-size: 14px;\n    line-height: 21px;\n    letter-spacing: -0.1px;\n    vertical-align: middle;\n  }\n`;\n\n/**\n * Action buttons for the comment owner. Styles change between mobile and desktop.\n */\nconst AdminActionButtons = ({\n  canEdit,\n  canDelete,\n  openDeleteConfirmation,\n  onEdit,\n  copyLinkToClipboard,\n  closePopup,\n}) => {\n  return (\n    <React.Fragment>\n      {/** Buttons */}\n      <CommentBtn\n        data-cy=\"share-comment-btn\"\n        onClick={() => {\n          closePopup();\n          copyLinkToClipboard();\n        }}\n      >\n        <ShareIcon size=\"1em\" mr={2} />\n        <FormattedMessage tagName=\"span\" id=\"Share\" defaultMessage=\"Share\" />\n      </CommentBtn>\n      {canEdit && (\n        <CommentBtn\n          data-cy=\"edit-comment-btn\"\n          onClick={() => {\n            closePopup();\n            onEdit();\n          }}\n        >\n          <Edit size=\"1em\" mr={2} />\n          <FormattedMessage tagName=\"span\" id=\"Edit\" defaultMessage=\"Edit\" />\n        </CommentBtn>\n      )}\n      {canDelete && (\n        <CommentBtn\n          data-cy=\"delete-comment-btn\"\n          onClick={() => {\n            closePopup();\n            openDeleteConfirmation();\n          }}\n          color=\"red.600\"\n        >\n          <X size=\"1em\" mr={2} />\n          <FormattedMessage tagName=\"span\" id=\"actions.delete\" defaultMessage=\"Delete\" />\n        </CommentBtn>\n      )}\n    </React.Fragment>\n  );\n};\n\nAdminActionButtons.propTypes = {\n  comment: PropTypes.object.isRequired,\n  openDeleteConfirmation: PropTypes.func,\n  onEdit: PropTypes.func,\n  closePopup: PropTypes.func,\n  isConversationRoot: PropTypes.bool,\n  canEdit: PropTypes.bool,\n  canDelete: PropTypes.bool,\n  copyLinkToClipboard: PropTypes.func,\n};\n\nconst deleteCommentMutation = gql`\n  mutation DeleteComment($id: String!) {\n    deleteComment(id: $id) {\n      id\n    }\n  }\n`;\n\nconst REACT_POPPER_MODIFIERS = [\n  {\n    name: 'offset',\n    options: {\n      offset: [0, 8],\n    },\n  },\n];\n\nconst mutationOptions = { context: API_V2_CONTEXT };\n\nconst CommentActions = ({ comment, anchorHash, isConversationRoot, canEdit, canDelete, onDelete, onEditClick }) => {\n  const intl = useIntl();\n  const { copy } = useClipboard();\n  const [isDeleting, setDeleting] = React.useState(null);\n  const [showAdminActions, setShowAdminActions] = React.useState(false);\n  const [refElement, setRefElement] = React.useState(null);\n  const [popperElement, setPopperElement] = React.useState(null);\n  const [deleteComment, { error: deleteError }] = useMutation(deleteCommentMutation, mutationOptions);\n  const { styles, attributes, state } = usePopper(refElement, popperElement, {\n    placement: 'bottom-end',\n    modifiers: REACT_POPPER_MODIFIERS,\n  });\n\n  const copyLinkToClipboard = () => {\n    const [baseLink] = window.location.href.split('#');\n    const linkWithAnchorHash = `${baseLink}#${anchorHash}`;\n    copy(linkWithAnchorHash);\n  };\n\n  useGlobalBlur(state?.elements.popper, outside => {\n    if (outside && showAdminActions) {\n      setShowAdminActions(false);\n    }\n  });\n\n  return (\n    <React.Fragment>\n      <div>\n        <StyledButton\n          ref={setRefElement}\n          buttonSize=\"tiny\"\n          data-cy=\"commnent-actions-trigger\"\n          onClick={() => setShowAdminActions(!showAdminActions)}\n        >\n          <DotsHorizontalRounded size=\"16\" />\n        </StyledButton>\n      </div>\n\n      {showAdminActions && (\n        <AdminActionsPopupContainer ref={setPopperElement} style={styles.popper} {...attributes.popper}>\n          <Flex justifyContent=\"space-between\" alignItems=\"center\" mb={2}>\n            <P\n              fontWeight=\"600\"\n              fontSize=\"9px\"\n              lineHeight=\"14px\"\n              textTransform=\"uppercase\"\n              letterSpacing=\"0.6px\"\n              whiteSpace=\"nowrap\"\n              pr={2}\n            >\n              <FormattedMessage id=\"comment.actions\" defaultMessage=\"Comment Actions\" />\n            </P>\n            <StyledHr flex=\"1\" borderStyle=\"solid\" borderColor=\"black.300\" />\n          </Flex>\n          <Flex flexDirection=\"column\" alignItems=\"flex-start\">\n            <AdminActionButtons\n              comment={comment}\n              isConversationRoot={isConversationRoot}\n              openDeleteConfirmation={() => setDeleting(true)}\n              onEdit={onEditClick}\n              canEdit={canEdit}\n              canDelete={canDelete}\n              copyLinkToClipboard={copyLinkToClipboard}\n              closePopup={() => setShowAdminActions(false)}\n            />\n          </Flex>\n        </AdminActionsPopupContainer>\n      )}\n      {/** Confirm Modals */}\n      {isDeleting && (\n        <ConfirmationModal\n          isDanger\n          type=\"delete\"\n          onClose={() => setDeleting(false)}\n          continueHandler={async () => {\n            await deleteComment({ variables: { id: comment.id } });\n            if (onDelete) {\n              await onDelete(comment);\n            }\n          }}\n          header={\n            isConversationRoot ? (\n              <FormattedMessage id=\"conversation.deleteModalTitle\" defaultMessage=\"Delete this Conversation?\" />\n            ) : (\n              <FormattedMessage id=\"Comment.DeleteConfirmTitle\" defaultMessage=\"Delete this comment?\" />\n            )\n          }\n        >\n          <StyledHr mb={4} borderColor=\"#e1e4e6\" />\n          {isConversationRoot && (\n            <MessageBox type=\"warning\" withIcon mb={3}>\n              <FormattedMessage\n                id=\"conversation.deleteMessage\"\n                defaultMessage=\"The message and all its replies will be permanently deleted.\"\n              />\n            </MessageBox>\n          )}\n          <Container padding={2} borderRadius={8} border=\"1px solid #e1e4e6\">\n            <CommentMetadata comment={comment} />\n            <Container mt={3} maxHeight={150} overflowY=\"auto\">\n              <HTMLContent content={comment.html} fontSize=\"12px\" data-cy=\"comment-body\" />\n            </Container>\n          </Container>\n          {deleteError && (\n            <MessageBox type=\"error\" withIcon mt={3}>\n              {i18nGraphqlException(intl, deleteError)}\n            </MessageBox>\n          )}\n        </ConfirmationModal>\n      )}\n    </React.Fragment>\n  );\n};\n\nCommentActions.propTypes = {\n  comment: PropTypes.shape({\n    id: PropTypes.string.isRequired,\n    html: PropTypes.string,\n    createdAt: PropTypes.string,\n  }).isRequired,\n  /** needed to copy the comment link */\n  anchorHash: PropTypes.string.isRequired,\n  /** Can current user edit this comment? */\n  canEdit: PropTypes.bool,\n  /** Can current user delete this comment? */\n  canDelete: PropTypes.bool,\n  /** Set this to true if the comment is the root comment of a conversation */\n  isConversationRoot: PropTypes.bool,\n  /** Called when comment gets deleted */\n  onDelete: PropTypes.func,\n  /** Called when comment gets deleted */\n  onEditClick: PropTypes.func,\n};\n\nexport default CommentActions;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gql } from '@apollo/client';\n\nimport { API_V2_CONTEXT } from '../../lib/graphql/helpers';\n\nimport Container from '../Container';\nimport { Box, Flex } from '../Grid';\nimport HTMLContent from '../HTMLContent';\nimport InlineEditField from '../InlineEditField';\nimport RichTextEditor from '../RichTextEditor';\n\nimport CommentActions from './CommentActions';\nimport { CommentMetadata } from './CommentMetadata';\nimport EmojiReactionPicker from './EmojiReactionPicker';\nimport CommentReactions from './EmojiReactions';\nimport { commentFieldsFragment } from './graphql';\n\nconst editCommentMutation = gql`\n  mutation EditComment($comment: CommentUpdateInput!) {\n    editComment(comment: $comment) {\n      id\n      ...CommentFields\n    }\n  }\n  ${commentFieldsFragment}\n`;\n\nconst mutationOptions = { context: API_V2_CONTEXT };\n\n/**\n * Render a comment.\n *\n * /!\\ Can only be used with data from API V2.\n */\nconst Comment = ({\n  comment,\n  canEdit,\n  canDelete,\n  maxCommentHeight,\n  isConversationRoot,\n  onDelete,\n  reactions,\n  canReply,\n}) => {\n  const [isEditing, setEditing] = React.useState(false);\n  const hasActions = !isEditing;\n  const anchorHash = `comment-${new Date(comment.createdAt).getTime()}`;\n\n  return (\n    <Container width=\"100%\" data-cy=\"comment\" id={anchorHash}>\n      <Flex mb={3} justifyContent=\"space-between\">\n        <CommentMetadata comment={comment} />\n        {hasActions && (\n          <CommentActions\n            comment={comment}\n            anchorHash={anchorHash}\n            isConversationRoot={isConversationRoot}\n            canEdit={canEdit}\n            canDelete={canDelete}\n            onDelete={onDelete}\n            onEditClick={() => setEditing(true)}\n          />\n        )}\n      </Flex>\n\n      <Box position=\"relative\" maxHeight={maxCommentHeight} css={{ overflowY: 'auto' }}>\n        <InlineEditField\n          mutation={editCommentMutation}\n          mutationOptions={mutationOptions}\n          values={comment}\n          field=\"html\"\n          canEdit={canEdit}\n          canDelete={canDelete}\n          isEditing={isEditing}\n          showEditIcon={false}\n          prepareVariables={(comment, html) => ({ comment: { id: comment.id, html } })}\n          disableEditor={() => setEditing(false)}\n          warnIfUnsavedChanges\n          required\n        >\n          {({ isEditing, setValue, setUploading }) =>\n            !isEditing ? (\n              <HTMLContent content={comment.html} fontSize=\"13px\" data-cy=\"comment-body\" />\n            ) : (\n              <RichTextEditor\n                kind=\"COMMENT\"\n                defaultValue={comment.html}\n                onChange={e => setValue(e.target.value)}\n                fontSize=\"13px\"\n                autoFocus\n                setUploading={setUploading}\n              />\n            )\n          }\n        </InlineEditField>\n        {(reactions || canReply) && (\n          <Flex mt={3} flexWrap=\"wrap\" data-cy=\"comment-reactions\">\n            {reactions && <CommentReactions reactions={reactions} />}\n            {canReply && <EmojiReactionPicker comment={comment} reactions={reactions} />}\n          </Flex>\n        )}\n      </Box>\n    </Container>\n  );\n};\n\nComment.propTypes = {\n  comment: PropTypes.shape({\n    id: PropTypes.string.isRequired,\n    html: PropTypes.string,\n    createdAt: PropTypes.string,\n    fromAccount: PropTypes.shape({\n      id: PropTypes.string,\n      name: PropTypes.string,\n    }),\n  }).isRequired,\n  /** Reactions associated with this comment? */\n  reactions: PropTypes.object,\n  /** Can current user edit this comment? */\n  canEdit: PropTypes.bool,\n  /** Can current user delete this comment? */\n  canDelete: PropTypes.bool,\n  canReply: PropTypes.bool,\n  /** Set this to true if the comment is the root comment of a conversation */\n  isConversationRoot: PropTypes.bool,\n  /** Set this to true to disable actions */\n  withoutActions: PropTypes.bool,\n  /** If set, comment will be scrollable over this height */\n  maxCommentHeight: PropTypes.number,\n  /** Called when comment gets deleted */\n  onDelete: PropTypes.func,\n};\n\nexport default Comment;\n","import React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { gql, useMutation } from '@apollo/client';\nimport { get } from 'lodash';\nimport { withRouter } from 'next/router';\nimport { defineMessages, useIntl } from 'react-intl';\n\nimport { createError, ERROR, formatErrorMessage, getErrorFromGraphqlException } from '../../lib/errors';\nimport { formatFormErrorMessage } from '../../lib/form-utils';\nimport { API_V2_CONTEXT } from '../../lib/graphql/helpers';\n\nimport Container from '../Container';\nimport ContainerOverlay from '../ContainerOverlay';\nimport { Flex } from '../Grid';\nimport LoadingPlaceholder from '../LoadingPlaceholder';\nimport MessageBox from '../MessageBox';\nimport RichTextEditor from '../RichTextEditor';\nimport SignInOrJoinFree, { SignInOverlayBackground } from '../SignInOrJoinFree';\nimport StyledButton from '../StyledButton';\nimport { P } from '../Text';\nimport { withUser } from '../UserProvider';\n\nimport { commentFieldsFragment } from './graphql';\n\nconst createCommentMutation = gql`\n  mutation CreateComment($comment: CommentCreateInput!) {\n    createComment(comment: $comment) {\n      id\n      ...CommentFields\n    }\n  }\n  ${commentFieldsFragment}\n`;\n\nconst messages = defineMessages({\n  placeholder: {\n    id: 'CommentForm.placeholder',\n    defaultMessage: 'Type your message...',\n  },\n  postReply: {\n    id: 'CommentForm.PostReply',\n    defaultMessage: 'Post reply',\n  },\n  signInLabel: {\n    id: 'CommentForm.SignIn',\n    defaultMessage: 'Please sign in to comment:',\n  },\n  uploadingImage: {\n    id: 'uploadImage.isUploading',\n    defaultMessage: 'Uploading image...',\n  },\n});\n\nconst getRedirectUrl = (router, id) => {\n  const anchor = id ? `#${id}` : '';\n  return `/create-account?next=${encodeURIComponent(router.asPath + anchor)}`;\n};\n\nconst isAutoFocused = id => {\n  return id && typeof window !== 'undefined' && get(window, 'location.hash') === `#${id}`;\n};\n\nconst mutationOptions = { context: API_V2_CONTEXT };\n\n/** A small helper to make the form work with params from both API V1 & V2 */\nconst prepareCommentParams = (html, conversationId, expenseId, updateId) => {\n  const comment = { html };\n  if (conversationId) {\n    comment.ConversationId = conversationId;\n  } else if (expenseId) {\n    comment.expense = {};\n    if (typeof expenseId === 'string') {\n      comment.expense.id = expenseId;\n    } else {\n      comment.expense.legacyId = expenseId;\n    }\n  } else if (updateId) {\n    comment.update = {};\n    if (typeof updateId === 'string') {\n      comment.update.id = updateId;\n    } else {\n      comment.update.legacyId = updateId;\n    }\n  }\n  return comment;\n};\n\n/**\n * Form for users to post comments on either expenses, conversations or updates.\n * If user is not logged in, the form will default to a sign in/up form.\n */\nconst CommentForm = ({\n  id,\n  ConversationId,\n  ExpenseId,\n  UpdateId,\n  onSuccess,\n  router,\n  loadingLoggedInUser,\n  LoggedInUser,\n  isDisabled,\n}) => {\n  const [createComment, { loading, error }] = useMutation(createCommentMutation, mutationOptions);\n  const intl = useIntl();\n  const [html, setHtml] = useState('');\n  const [resetValue, setResetValue] = useState();\n  const [validationError, setValidationError] = useState();\n  const [uploading, setUploading] = useState(false);\n  const { formatMessage } = intl;\n\n  const submitForm = async event => {\n    event.preventDefault();\n    event.stopPropagation();\n    if (!html) {\n      setValidationError(createError(ERROR.FORM_FIELD_REQUIRED));\n    } else {\n      const comment = prepareCommentParams(html, ConversationId, ExpenseId, UpdateId);\n      const response = await createComment({ variables: { comment } });\n      setResetValue(response.data.createComment.id);\n      if (onSuccess) {\n        return onSuccess(response.data.createComment);\n      }\n    }\n  };\n\n  return (\n    <Container id={id} position=\"relative\">\n      {!loadingLoggedInUser && !LoggedInUser && (\n        <ContainerOverlay backgroundType=\"white\">\n          <SignInOverlayBackground>\n            <SignInOrJoinFree\n              routes={{ join: getRedirectUrl(router, id) }}\n              signInLabel={formatMessage(messages.signInLabel)}\n              hideFooter\n              showSubHeading={false}\n              showOCLogo={false}\n            />\n          </SignInOverlayBackground>\n        </ContainerOverlay>\n      )}\n      <form onSubmit={submitForm} data-cy=\"comment-form\">\n        {loadingLoggedInUser ? (\n          <LoadingPlaceholder height={232} />\n        ) : (\n          <RichTextEditor\n            kind=\"COMMENT\"\n            withBorders\n            inputName=\"html\"\n            editorMinHeight={150}\n            placeholder={formatMessage(messages.placeholder)}\n            autoFocus={isAutoFocused(id)}\n            disabled={isDisabled || !LoggedInUser || loading}\n            reset={resetValue}\n            fontSize=\"13px\"\n            onChange={e => {\n              setHtml(e.target.value);\n              setValidationError(null);\n            }}\n            setUploading={setUploading}\n          />\n        )}\n        {validationError && (\n          <P color=\"red.500\" mt={3}>\n            {formatFormErrorMessage(intl, validationError)}\n          </P>\n        )}\n        {error && (\n          <MessageBox type=\"error\" withIcon mt={2}>\n            {formatErrorMessage(intl, getErrorFromGraphqlException(error))}\n          </MessageBox>\n        )}\n        <Flex mt={3} alignItems=\"center\" gap={12}>\n          <StyledButton\n            type=\"submit\"\n            minWidth={150}\n            buttonStyle=\"primary\"\n            disabled={isDisabled || !LoggedInUser || uploading}\n            loading={loading}\n            data-cy=\"submit-comment-btn\"\n          >\n            {formatMessage(uploading ? messages.uploadingImage : messages.postReply)}\n          </StyledButton>\n        </Flex>\n      </form>\n    </Container>\n  );\n};\n\nCommentForm.propTypes = {\n  /** An optional id for the container, useful for the redirection link */\n  id: PropTypes.string,\n  /** If commenting on a conversation */\n  ConversationId: PropTypes.string,\n  /** If commenting on an expense */\n  ExpenseId: PropTypes.string,\n  /** If commenting on an update */\n  UpdateId: PropTypes.string,\n  /** Called when the comment is created successfully */\n  onSuccess: PropTypes.func,\n  /** disable the inputs */\n  isDisabled: PropTypes.bool,\n  /** @ignore from withUser */\n  loadingLoggedInUser: PropTypes.bool,\n  /** @ignore from withUser */\n  LoggedInUser: PropTypes.object,\n  /** @ignore from withRouter */\n  router: PropTypes.object,\n};\n\nexport default withUser(withRouter(CommentForm));\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport CustomStyledIcon from './CustomStyledIcon';\n\nconst AddReactionIcon = props => (\n  <CustomStyledIcon fill=\"none\" width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" {...props}>\n    <path\n      fill=\"#9D9FA3\"\n      fillRule=\"evenodd\"\n      d=\"M13.136 3.81v2.285h1.546V3.81H17V2.286h-2.318V0h-1.546v2.286h-2.318V3.81h2.318zM0 8.762c0-3.996 3.281-7.238 7.334-7.238.94 0 1.84.174 2.666.491v1.668a5.84 5.84 0 00-2.66-.635c-3.201 0-5.795 2.557-5.795 5.714 0 3.157 2.594 5.714 5.796 5.714 3.202 0 5.795-2.557 5.795-5.714A5.64 5.64 0 0012.856 7h1.607c.143.564.219 1.154.219 1.762 0 3.995-3.289 7.238-7.348 7.238C3.28 16 0 12.757 0 8.762zm9.66-.381c.64 0 1.158-.51 1.158-1.143A1.15 1.15 0 009.66 6.095c-.641 0-1.159.51-1.159 1.143a1.15 1.15 0 001.16 1.143zM6.181 7.238a1.15 1.15 0 01-1.16 1.143 1.15 1.15 0 01-1.158-1.143 1.15 1.15 0 011.159-1.143c.641 0 1.159.51 1.159 1.143zm1.159 5.714c1.585 0 2.933-.953 3.477-2.285H3.864c.544 1.332 1.891 2.285 3.477 2.285z\"\n      clipRule=\"evenodd\"\n      strokeWidth=\"0.1\"\n    ></path>\n  </CustomStyledIcon>\n);\n\nAddReactionIcon.propTypes = {\n  size: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n};\n\nexport default AddReactionIcon;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gql, useMutation } from '@apollo/client';\nimport { Manager, Popper, Reference } from 'react-popper';\nimport styled, { css } from 'styled-components';\n\nimport { API_V2_CONTEXT } from '../../lib/graphql/helpers';\nimport useGlobalBlur from '../../lib/hooks/useGlobalBlur';\n\nimport { Flex } from '../Grid';\nimport AddReactionIcon from '../icons/AddReactionIcon';\nimport StyledButton from '../StyledButton';\nimport StyledCard from '../StyledCard';\nimport StyledRoundButton from '../StyledRoundButton';\n\nconst addReactionMutation = gql`\n  mutation AddEmojiReaction($emoji: String!, $update: UpdateReferenceInput, $comment: CommentReferenceInput) {\n    addEmojiReaction(emoji: $emoji, update: $update, comment: $comment) {\n      update {\n        id\n        reactions\n        userReactions\n      }\n      comment {\n        id\n        reactions\n        userReactions\n      }\n    }\n  }\n`;\n\nconst removeReactionMutation = gql`\n  mutation RemoveEmojiReaction($emoji: String!, $update: UpdateReferenceInput, $comment: CommentReferenceInput) {\n    removeEmojiReaction(emoji: $emoji, update: $update, comment: $comment) {\n      update {\n        id\n        reactions\n        userReactions\n      }\n      comment {\n        id\n        reactions\n        userReactions\n      }\n    }\n  }\n`;\n\nconst Emoji = styled.div`\n  font-size: 15px;\n`;\n\nconst ReactionButton = styled(StyledRoundButton).attrs({ isBorderless: true, buttonSize: 'small' })`\n  margin: 4px;\n  background: white !important;\n\n  ${Emoji} {\n    transition: transform 0.15s cubic-bezier(0.2, 0, 0.13, 2);\n  }\n\n  &:hover {\n    ${Emoji} {\n      transform: scale(1.3);\n    }\n  }\n\n  ${props =>\n    props.isSelected &&\n    css`\n      background: ${props.theme.colors.primary[200]} !important;\n    `}\n`;\n\nconst getOptimisticResponse = (entity, emoji, isAdding) => {\n  const userReactions = entity.userReactions || [];\n  const { __typename } = entity;\n  const fieldName = __typename === 'Update' ? 'update' : 'comment';\n  const fieldNameOpposite = __typename === 'Update' ? 'comment' : 'update';\n  if (isAdding) {\n    const newCount = (entity.reactions[emoji] || 0) + 1;\n\n    return {\n      __typename: 'Mutation',\n      addEmojiReaction: {\n        __typename: 'EmojiReactionsResponse',\n        [fieldName]: {\n          __typename,\n          id: entity.id,\n          reactions: { ...entity.reactions, [emoji]: newCount },\n          userReactions: [...userReactions, emoji],\n        },\n        [fieldNameOpposite]: null,\n      },\n    };\n  } else {\n    const newCount = (entity.reactions[emoji] || 0) - 1;\n    const reactions = { ...entity.reactions, [emoji]: newCount };\n\n    if (!reactions[emoji]) {\n      delete reactions[emoji];\n    }\n\n    return {\n      __typename: 'Mutation',\n      removeEmojiReaction: {\n        __typename: 'EmojiReactionsResponse',\n        [fieldName]: {\n          __typename,\n          id: entity.id,\n          reactions,\n          userReactions: userReactions.filter(userEmoji => userEmoji !== emoji),\n        },\n        [fieldNameOpposite]: null,\n      },\n    };\n  }\n};\n\nconst mutationOptions = { context: API_V2_CONTEXT };\n\n/**\n * A component to render the reaction picker on comments.\n */\nconst EmojiReactionPicker = ({ comment, update }) => {\n  const emojiFirstRow = ['', '', '', ''];\n  const emojiSecondRow = ['', '', '', ''];\n  const [open, setOpen] = React.useState(false);\n  const wrapperRef = React.useRef();\n  const [addReaction] = useMutation(addReactionMutation, mutationOptions);\n  const [removeReaction] = useMutation(removeReactionMutation, mutationOptions);\n\n  useGlobalBlur(wrapperRef, outside => {\n    if (outside) {\n      setOpen(false);\n    }\n  });\n\n  const getReactionBtnProps = emoji => {\n    let isSelected;\n    if (comment) {\n      isSelected = comment.userReactions?.includes(emoji);\n    } else if (update) {\n      isSelected = update.userReactions?.includes(emoji);\n    }\n    return {\n      children: <Emoji>{emoji}</Emoji>,\n      isSelected,\n      onClick: () => {\n        setOpen(false);\n        const action = isSelected ? removeReaction : addReaction;\n        if (comment) {\n          return action({\n            variables: { emoji: emoji, comment: { id: comment.id } },\n            optimisticResponse: getOptimisticResponse(comment, emoji, !isSelected, true),\n          });\n        } else if (update) {\n          return action({\n            variables: { emoji: emoji, update: { id: update.id } },\n            optimisticResponse: getOptimisticResponse(update, emoji, !isSelected, false),\n          });\n        }\n      },\n    };\n  };\n\n  return (\n    <Manager>\n      <div ref={wrapperRef}>\n        <Reference>\n          {({ ref }) => (\n            <StyledButton\n              buttonSize=\"tiny\"\n              display=\"inline-block\"\n              whiteSpace=\"nowrap\"\n              onClick={() => setOpen(true)}\n              ref={ref}\n              margin=\"4px 8px 4px 0\"\n              data-cy=\"comment-reaction-picker-trigger\"\n            >\n              <AddReactionIcon />\n            </StyledButton>\n          )}\n        </Reference>\n        {open && (\n          <Popper placement=\"bottom\">\n            {({ placement, ref, style }) => (\n              <StyledCard\n                boxShadow=\"-2px -1px 3px 0px #e8e8e8\"\n                zIndex={9999}\n                data-placement={placement}\n                ref={ref}\n                style={style}\n                data-cy=\"comment-reaction-picker-popper\"\n              >\n                <Flex>\n                  {emojiFirstRow.map(emoji => (\n                    <ReactionButton key={emoji} {...getReactionBtnProps(emoji)} />\n                  ))}\n                </Flex>\n                <Flex>\n                  {emojiSecondRow.map(emoji => (\n                    <ReactionButton key={emoji} {...getReactionBtnProps(emoji)} />\n                  ))}\n                </Flex>\n              </StyledCard>\n            )}\n          </Popper>\n        )}\n      </div>\n    </Manager>\n  );\n};\n\nEmojiReactionPicker.propTypes = {\n  comment: PropTypes.shape({\n    id: PropTypes.string.isRequired,\n    html: PropTypes.string,\n    createdAt: PropTypes.string,\n    userReactions: PropTypes.array,\n  }),\n  update: PropTypes.shape({\n    id: PropTypes.string.isRequired,\n    html: PropTypes.string,\n    createdAt: PropTypes.string,\n    fromAccount: PropTypes.shape({\n      id: PropTypes.string,\n      name: PropTypes.string,\n    }),\n    userReactions: PropTypes.array,\n  }),\n};\n\nexport default EmojiReactionPicker;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nimport { Span } from '../Text';\n\nconst EmojiLabel = styled(Span)`\n  outline: 0;\n  border: 1px solid #dadada;\n  border-style: solid;\n  border-width: 1px;\n  border-radius: 100px;\n  text-align: center;\n  padding: 5px 14px 5px 14px;\n  font-size: 12px;\n  line-height: 14px;\n  margin: 4px 8px 4px 0;\n`;\n\nconst EmojiReactions = ({ reactions }) => {\n  return Object.keys(reactions)\n    .sort()\n    .map(emoji => {\n      return (\n        <EmojiLabel key={emoji}>\n          {emoji}&nbsp;&nbsp;{reactions[emoji]}\n        </EmojiLabel>\n      );\n    });\n};\n\nEmojiReactions.propTypes = {\n  /** Reactions associated with this comment */\n  reactions: PropTypes.object,\n};\n\nexport default React.memo(EmojiReactions);\n","import React, { Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { CheckCircle as CheckIcon } from '@styled-icons/boxicons-regular/CheckCircle';\nimport { Ban as RejectedIcon } from '@styled-icons/fa-solid/Ban';\nimport { Cogs as CogsIcon } from '@styled-icons/fa-solid/Cogs';\nimport { AlertOctagon as ErrorIcon } from '@styled-icons/feather/AlertOctagon';\nimport { Edit as EditIcon } from '@styled-icons/feather/Edit';\nimport { FileText as InvitedIcon } from '@styled-icons/feather/FileText';\nimport { Plus as PlusIcon } from '@styled-icons/feather/Plus';\nimport { UserCheck as ApprovedIcon } from '@styled-icons/feather/UserCheck';\nimport { UserMinus as UnapprovedIcon } from '@styled-icons/feather/UserMinus';\nimport { SyncAlt as MoveIcon } from '@styled-icons/material/SyncAlt';\nimport { Update as UpdateIcon } from '@styled-icons/material/Update';\nimport { defineMessage, FormattedMessage, useIntl } from 'react-intl';\nimport styled, { useTheme } from 'styled-components';\n\nimport Avatar from '../Avatar';\nimport DateTime from '../DateTime';\nimport { Flex } from '../Grid';\nimport LinkCollective from '../LinkCollective';\nimport StyledLink from '../StyledLink';\nimport { P, Span } from '../Text';\n\n/**\n * Defines activities display metadata.\n * **All** keys must have a matching entry in `MESSAGES` below.\n */\nconst ACTIVITIES_INFO = {\n  COLLECTIVE_EXPENSE_CREATED: {\n    type: 'info',\n    icon: PlusIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.Created',\n      defaultMessage: 'Expense created',\n    }),\n  },\n  COLLECTIVE_EXPENSE_APPROVED: {\n    type: 'info',\n    icon: ApprovedIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.Approved',\n      defaultMessage: 'Expense approved',\n    }),\n  },\n  COLLECTIVE_EXPENSE_MOVED: {\n    type: 'info',\n    icon: MoveIcon,\n    message: defineMessage({\n      defaultMessage: 'Expense moved from {movedFromCollective}',\n    }),\n  },\n  COLLECTIVE_EXPENSE_UNAPPROVED: {\n    type: 'warning',\n    icon: UnapprovedIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.Unapproved',\n      defaultMessage: 'Expense unapproved',\n    }),\n  },\n  COLLECTIVE_EXPENSE_UPDATED: {\n    type: 'info',\n    icon: EditIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.Updated',\n      defaultMessage: 'Expense updated',\n    }),\n  },\n  COLLECTIVE_EXPENSE_MARKED_AS_UNPAID: {\n    type: 'info',\n    icon: UpdateIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.MarkedAsUnpaid',\n      defaultMessage: 'Expense marked as unpaid',\n    }),\n  },\n  COLLECTIVE_EXPENSE_REJECTED: {\n    type: 'error',\n    icon: RejectedIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.Rejected',\n      defaultMessage: 'Expense rejected',\n    }),\n  },\n  COLLECTIVE_EXPENSE_INVITE_DRAFTED: {\n    type: 'info',\n    icon: InvitedIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.Invite.Drafted',\n      defaultMessage: 'Expense invited',\n    }),\n  },\n  COLLECTIVE_EXPENSE_PAID: {\n    type: 'success',\n    icon: CheckIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.Paid',\n      defaultMessage: 'Expense paid',\n    }),\n  },\n  COLLECTIVE_EXPENSE_PROCESSING: {\n    type: 'info',\n    icon: CogsIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.Processing',\n      defaultMessage: 'Expense processing',\n    }),\n  },\n  COLLECTIVE_EXPENSE_SCHEDULED_FOR_PAYMENT: {\n    type: 'info',\n    icon: CogsIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.ScheduledForPayment',\n      defaultMessage: 'Expense scheduled for payment',\n    }),\n  },\n  COLLECTIVE_EXPENSE_ERROR: {\n    type: 'error',\n    icon: ErrorIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.Error',\n      defaultMessage: 'Expense error',\n    }),\n  },\n  COLLECTIVE_EXPENSE_MARKED_AS_SPAM: {\n    type: 'error',\n    icon: RejectedIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.MarkedAsSpam',\n      defaultMessage: 'Expense marked as spam',\n    }),\n  },\n  COLLECTIVE_EXPENSE_MARKED_AS_INCOMPLETE: {\n    type: 'warning',\n    icon: UnapprovedIcon,\n    message: defineMessage({\n      id: 'Expense.Activity.MarkedAsIncomplete',\n      defaultMessage: 'Expense marked as incomplete',\n    }),\n  },\n};\n\nconst getActivityColor = (activityType, theme) => {\n  switch (ACTIVITIES_INFO[activityType]?.type) {\n    case 'info':\n      return theme.colors.blue[500];\n    case 'success':\n      return theme.colors.green[500];\n    case 'error':\n      return theme.colors.red[500];\n    default:\n      return theme.colors.black[400];\n  }\n};\n\nexport const getActivityIcon = (activity, theme) => {\n  const IconComponent = ACTIVITIES_INFO[activity.type]?.icon || UpdateIcon;\n  return <IconComponent size={18} color={getActivityColor(activity.type, theme)} />;\n};\n\nexport const isSupportedActivity = activity => {\n  return Object.prototype.hasOwnProperty.call(ACTIVITIES_INFO, activity.type);\n};\n\nconst ActivityParagraph = styled(P)`\n  padding: 10px 12px;\n  border-left: 4px solid ${props => props.activityColor};\n  border-radius: 0;\n`;\n\nconst ActivityMessage = styled.span`\n  font-size: 10px;\n  font-weight: 600;\n  background: white;\n  color: ${props => props.color};\n`;\n\nconst ThreadActivity = ({ activity }) => {\n  const { formatMessage } = useIntl();\n  const theme = useTheme();\n  const activityColor = getActivityColor(activity.type, theme);\n  const message = ACTIVITIES_INFO[activity.type]?.message;\n  const details = activity.data?.message || activity.data?.error?.message;\n\n  return (\n    <div>\n      {activity.individual && (\n        <Flex>\n          <LinkCollective collective={activity.individual}>\n            <Avatar radius={40} collective={activity.individual} />\n          </LinkCollective>\n          <Flex flexDirection=\"column\" justifyContent=\"center\" ml={3}>\n            <Span color=\"black.600\">\n              <FormattedMessage\n                id=\"ByUser\"\n                defaultMessage=\"By {userName}\"\n                values={{\n                  userName: <StyledLink as={LinkCollective} color=\"black.800\" collective={activity.individual} />,\n                }}\n              />\n            </Span>\n            <Span color=\"black.600\" fontSize=\"12px\">\n              <FormattedMessage defaultMessage=\"on {date}\" values={{ date: <DateTime value={activity.createdAt} /> }} />\n            </Span>\n          </Flex>\n        </Flex>\n      )}\n      {message && (\n        <ActivityParagraph activityColor={activityColor} mt={1} fontSize=\"12px\" whiteSpace=\"pre-line\">\n          <ActivityMessage color={activityColor}>\n            {formatMessage(message, { movedFromCollective: activity.data?.movedFromCollective?.name || 'collective' })}\n          </ActivityMessage>\n          {details && (\n            <Fragment>\n              <br />\n              {details}\n            </Fragment>\n          )}\n        </ActivityParagraph>\n      )}\n    </div>\n  );\n};\n\nThreadActivity.propTypes = {\n  activity: PropTypes.shape({\n    id: PropTypes.string.isRequired,\n    type: PropTypes.oneOf(Object.keys(ACTIVITIES_INFO)).isRequired,\n    createdAt: PropTypes.string.isRequired,\n    data: PropTypes.shape({\n      error: PropTypes.shape({\n        message: PropTypes.string,\n      }),\n      message: PropTypes.string,\n      movedFromCollective: PropTypes.object,\n    }),\n    individual: PropTypes.shape({\n      id: PropTypes.string.isRequired,\n      slug: PropTypes.string.isRequired,\n      name: PropTypes.string.isRequired,\n    }),\n  }),\n};\n\nexport default ThreadActivity;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { FormattedMessage } from 'react-intl';\nimport styled, { css, withTheme } from 'styled-components';\n\nimport Container from '../Container';\nimport { Box, Flex } from '../Grid';\nimport CommentIconLib from '../icons/CommentIcon';\nimport StyledButton from '../StyledButton';\nimport { withUser } from '../UserProvider';\n\nimport Comment from './Comment';\nimport ThreadActivity, { getActivityIcon, isSupportedActivity } from './ThreadActivity';\n\nconst CommentIcon = styled(CommentIconLib).attrs({\n  size: 16,\n  color: '#9a9a9a',\n})``;\n\nconst ItemContainer = styled.div`\n  width: 100%;\n\n  ${props =>\n    !props.isLast &&\n    css`\n      padding-bottom: 16px;\n      margin-bottom: 16px;\n      border-bottom: 1px dashed #d3d6da;\n    `}\n`;\n\n/**\n * A thread is meant to display comments and activities in a chronological order.\n */\nconst Thread = ({ collective, items, onCommentDeleted, LoggedInUser, theme, hasMore, fetchMore }) => {\n  const [loading, setLoading] = React.useState(false);\n\n  if (!items || items.length === 0) {\n    return null;\n  }\n\n  const isAdmin = LoggedInUser && LoggedInUser.isAdminOfCollective(collective);\n\n  const handleLoadMore = async () => {\n    setLoading(true);\n    await fetchMore();\n    setLoading(false);\n  };\n\n  return (\n    <div data-cy=\"thread\">\n      {items.map((item, idx) => {\n        switch (item.__typename) {\n          case 'Comment':\n            return (\n              <Box key={`comment-${item.id}`}>\n                <Flex>\n                  <Flex flexDirection=\"column\" alignItems=\"center\" width=\"40px\">\n                    <Box my={2}>\n                      <CommentIcon />\n                    </Box>\n                    <Container width=\"1px\" height=\"100%\" background=\"#E8E9EB\" />\n                  </Flex>\n                  <ItemContainer isLast={idx + 1 === items.length}>\n                    <Comment\n                      comment={item}\n                      canDelete={isAdmin || Boolean(LoggedInUser && LoggedInUser.canEditComment(item))}\n                      canEdit={Boolean(LoggedInUser && LoggedInUser.canEditComment(item))}\n                      canReply={Boolean(LoggedInUser)}\n                      onDelete={onCommentDeleted}\n                      reactions={item.reactions}\n                    />\n                  </ItemContainer>\n                </Flex>\n              </Box>\n            );\n          case 'Activity':\n            return !isSupportedActivity(item) ? null : (\n              <Box key={`activity-${item.id}`}>\n                <Flex>\n                  <Flex flexDirection=\"column\" alignItems=\"center\" width=\"40px\">\n                    <Box my={2}>{getActivityIcon(item, theme)}</Box>\n                    <Container width=\"1px\" height=\"100%\" background=\"#E8E9EB\" />\n                  </Flex>\n                  <ItemContainer isLast={idx + 1 === items.length}>\n                    <ThreadActivity key={item.id} activity={item} />\n                  </ItemContainer>\n                </Flex>\n              </Box>\n            );\n          default:\n            return null;\n        }\n      })}\n      <hr />\n      {hasMore && fetchMore && (\n        <Container margin=\"1rem\">\n          <StyledButton onClick={handleLoadMore} loading={loading} textTransform=\"capitalize\">\n            <FormattedMessage id=\"loadMore\" defaultMessage=\"load more\" /> \n          </StyledButton>\n        </Container>\n      )}\n    </div>\n  );\n};\n\nThread.propTypes = {\n  /** The list of items to display, sorted by chronoligal order */\n  items: PropTypes.arrayOf(\n    PropTypes.shape({\n      __typename: PropTypes.oneOf(['Comment', 'Activity']),\n      id: PropTypes.string.isRequired,\n    }),\n  ),\n  /** Called when a comment get deleted */\n  onCommentDeleted: PropTypes.func,\n  /** Collective where the thread is created */\n  collective: PropTypes.shape({\n    slug: PropTypes.string,\n  }).isRequired,\n  /** Indicate whether there are more comments to fetch */\n  hasMore: PropTypes.bool,\n  /** function to fetch more comments */\n  fetchMore: PropTypes.func,\n  /** @ignore from withUser */\n  LoggedInUser: PropTypes.object,\n  /** @ignore from withTheme */\n  theme: PropTypes.object,\n};\n\nexport default React.memo(withUser(withTheme(Thread)));\n","import { gql } from '@apollo/client';\n\nexport const commentFieldsFragment = gql`\n  fragment CommentFields on Comment {\n    id\n    createdAt\n    html\n    reactions\n    userReactions\n    fromAccount {\n      id\n      type\n      name\n      slug\n      imageUrl\n    }\n  }\n`;\n\nexport const conversationListFragment = gql`\n  fragment ConversationListFragment on ConversationCollection {\n    totalCount\n    offset\n    limit\n    nodes {\n      id\n      title\n      summary\n      slug\n      createdAt\n      tags\n      fromAccount {\n        id\n        name\n        type\n        slug\n        imageUrl\n      }\n      followers(limit: 5) {\n        totalCount\n        nodes {\n          id\n          slug\n          type\n          name\n          imageUrl(height: 64)\n        }\n      }\n      stats {\n        id\n        commentsCount\n      }\n    }\n  }\n`;\n\nexport const isUserFollowingConversationQuery = gql`\n  query IsUserFollowingConversation($id: String!) {\n    loggedInAccount {\n      id\n      slug\n      imageUrl\n      type\n      name\n      ... on Individual {\n        isFollowingConversation(id: $id)\n      }\n    }\n  }\n`;\n\nexport const updateListFragment = gql`\n  fragment UpdateListFragment on UpdateCollection {\n    totalCount\n    offset\n    limit\n    nodes {\n      id\n      slug\n      title\n      summary\n      createdAt\n      publishedAt\n      isPrivate\n      userCanSeeUpdate\n      fromAccount {\n        id\n        type\n        name\n        slug\n        imageUrl\n      }\n    }\n  }\n`;\n","import { MessageSquare } from '@styled-icons/feather/MessageSquare';\nimport styled from 'styled-components';\n\nexport default styled(MessageSquare)`\n  transform: scaleX(-1);\n`;\n","import React from 'react';\nimport copy from 'copy-to-clipboard';\n\n/**\n * A custom react hook to copy values to the clipboard\n *\n * @param timeout: time before the isCopied flag is reset\n */\nconst useClipboard = ({ timeout = 3000 } = {}) => {\n  const [isCopied, setCopied] = React.useState();\n  const [updateCopyBtnTimeout, setUpdateCopyBtnTimeout] = React.useState();\n  return {\n    isCopied,\n    copy: value => {\n      copy(value);\n      setCopied(true);\n\n      if (updateCopyBtnTimeout) {\n        clearTimeout(updateCopyBtnTimeout);\n      }\n\n      const timeoutFn = setTimeout(() => {\n        setCopied(false);\n      }, timeout);\n\n      setUpdateCopyBtnTimeout(timeoutFn);\n    },\n  };\n};\n\nexport default useClipboard;\n","import { css } from 'styled-components';\n\n/**\n * A custom scrollbar for Chrome, more prettier than the system one.\n */\nexport const CustomScrollbarCSS = css`\n  @media (pointer: fine) {\n    &::-webkit-scrollbar {\n      height: 8px;\n      margin: 0 16px;\n    }\n\n    &::-webkit-scrollbar-thumb {\n      background: #d1d1d3;\n      border-radius: 16px;\n      &:hover {\n        background: #aaa;\n      }\n    }\n\n    &::-webkit-scrollbar-track {\n      background: #f2f3f4;\n      border-radius: 20px;\n    }\n\n    &::-webkit-scrollbar-button {\n      color: white;\n    }\n  }\n`;\n"],"names":["React","Container","ContainerOverlay","backgroundType","backgroundOpacity","props","isDark","defaultOpacity","opacity","lightness","defaultProps","Component","Mutation","PencilAlt","defineMessages","FormattedMessage","injectIntl","styled","Box","Flex","MessageBox","StyledButton","fadeIn","StyledTextarea","WarnIfUnsavedChanges","EditIcon","FormButton","messages","warnDiscardChanges","id","defaultMessage","InlineEditField","isEditing","draft","uploading","setState","values","field","noWarning","warnIfUnsavedChanges","intl","isDirty","state","confirm","formatMessage","disableEditor","oldProps","canEdit","value","placeholder","children","enableEditor","setValue","setDraft","mutation","prepareVariables","showEditIcon","topEdit","mutationOptions","buttonsMinWidth","touched","isValid","required","Boolean","renderContent","updateField","loading","error","maxLength","setUploading","e","target","message","variables","then","css","v4","uuid","isURL","uploadImageWithXHR","CustomScrollbarCSS","stripHTML","HTMLContent","LoadingPlaceholder","StyledTag","TrixEditorContainer","div","withBorders","border","borderColor","borderRadius","padding","editorMaxHeight","overflowY","outline","theme","colors","red","black","minHeight","editorMinHeight","maxHeight","toolbarBackgroundColor","blue","version","display","borderLeft","withStickyToolbar","position","top","toolbarTop","marginTop","toolbarOffsetY","p","isDisabled","pointerEvents","cursor","background","SUPPORTED_SERVICE_URLS","youTube","anchorFm","RichTextEditor","Trix","editorRef","current","addEventListener","handleChange","handleUpload","handleFileAccept","trixActionInvoke","event","videoEmbedEnabled","replaceEmbeddedIFrames","defaultValue","trixEmbed","mainContainerRef","linkInput","querySelector","key","handleLink","addLinkBtn","isReady","iframeRegex","RegExp","match","lastIndex","exec","getEditor","loadHTML","iframe","index","preText","substring","setSelectedRange","insertHTML","attachment","Attachment","content","insertAttachment","length","postText","videoEmbedButton","videoEmbedDialog","toolbarElement","attachFilesButton","insertAdjacentHTML","trixDialog","actionName","attachVideoDialog","attachVideoDialogInput","getAttribute","removeAttribute","setAttribute","embedLink","trim","embedIframe","service","videoLink","regexps","youtube","vimeo","matches","podcastName","episodeId","podcastUrl","parseServiceLink","constructVideoEmbedURL","sanitizedLink","replace","videoServices","attachmentData","includes","contentType","autolink","onChange","test","file","type","alert","preventDefault","size","attachmentContent","isVideoAttachment","remove","onProgress","progress","setUploadProgress","onSuccess","fileURL","setAttributes","url","href","onFailure","kind","urlInput","urlInputValue","require_protocol","lastCharacterPosition","lastCharacterIndex","closingPair","openingPair","opening","closing","i","createRef","require","config","blockAttributes","heading1","tagName","attachments","preview","caption","name","initialize","reset","editor","removeEventListener","linkRegex","getDocument","toString","urlLength","autolinkDelimiter","range","hrefAtRange","getCommonAttributesAtRange","newURL","slice","updateInRange","canActivateAttribute","activateAttribute","offset","updateFunc","baseRange","getSelectedRange","autoFocus","inputName","disabled","fontSize","showCount","undefined","Avatar","LinkCollective","P","CommentMetadata","comment","fromAccount","createdAt","Date","gql","useMutation","DotsHorizontalRounded","Share2","ShareIcon","X","Edit","useIntl","usePopper","i18nGraphqlException","API_V2_CONTEXT","useClipboard","useGlobalBlur","ConfirmationModal","StyledHr","AdminActionsPopupContainer","CommentBtn","attrs","buttonSize","AdminActionButtons","canDelete","openDeleteConfirmation","onEdit","copyLinkToClipboard","closePopup","deleteCommentMutation","REACT_POPPER_MODIFIERS","options","context","CommentActions","anchorHash","isConversationRoot","onDelete","onEditClick","copy","useState","isDeleting","setDeleting","showAdminActions","setShowAdminActions","refElement","setRefElement","popperElement","setPopperElement","deleteComment","deleteError","placement","modifiers","styles","attributes","window","location","split","baseLink","linkWithAnchorHash","elements","popper","outside","html","EmojiReactionPicker","CommentReactions","commentFieldsFragment","editCommentMutation","Comment","maxCommentHeight","reactions","canReply","setEditing","hasActions","getTime","withRouter","createError","ERROR","formatErrorMessage","getErrorFromGraphqlException","formatFormErrorMessage","SignInOrJoinFree","SignInOverlayBackground","withUser","createCommentMutation","postReply","signInLabel","uploadingImage","getRedirectUrl","router","anchor","encodeURIComponent","asPath","isAutoFocused","prepareCommentParams","conversationId","expenseId","updateId","ConversationId","expense","legacyId","update","CommentForm","ExpenseId","UpdateId","loadingLoggedInUser","LoggedInUser","createComment","setHtml","resetValue","setResetValue","validationError","setValidationError","submitForm","stopPropagation","FORM_FIELD_REQUIRED","response","data","join","CustomStyledIcon","AddReactionIcon","Manager","Popper","Reference","StyledCard","StyledRoundButton","addReactionMutation","removeReactionMutation","Emoji","ReactionButton","isBorderless","isSelected","primary","getOptimisticResponse","entity","emoji","isAdding","userReactions","__typename","fieldName","fieldNameOpposite","newCount","addEmojiReaction","removeEmojiReaction","filter","userEmoji","emojiFirstRow","emojiSecondRow","open","setOpen","wrapperRef","useRef","addReaction","removeReaction","getReactionBtnProps","onClick","action","optimisticResponse","ref","style","map","Span","EmojiLabel","EmojiReactions","Object","keys","sort","memo","Fragment","CheckCircle","CheckIcon","Ban","RejectedIcon","Cogs","CogsIcon","AlertOctagon","ErrorIcon","FileText","InvitedIcon","Plus","PlusIcon","UserCheck","ApprovedIcon","UserMinus","UnapprovedIcon","SyncAlt","MoveIcon","Update","UpdateIcon","defineMessage","useTheme","DateTime","StyledLink","ACTIVITIES_INFO","COLLECTIVE_EXPENSE_CREATED","icon","COLLECTIVE_EXPENSE_APPROVED","COLLECTIVE_EXPENSE_MOVED","COLLECTIVE_EXPENSE_UNAPPROVED","COLLECTIVE_EXPENSE_UPDATED","COLLECTIVE_EXPENSE_MARKED_AS_UNPAID","COLLECTIVE_EXPENSE_REJECTED","COLLECTIVE_EXPENSE_INVITE_DRAFTED","COLLECTIVE_EXPENSE_PAID","COLLECTIVE_EXPENSE_PROCESSING","COLLECTIVE_EXPENSE_SCHEDULED_FOR_PAYMENT","COLLECTIVE_EXPENSE_ERROR","COLLECTIVE_EXPENSE_MARKED_AS_SPAM","COLLECTIVE_EXPENSE_MARKED_AS_INCOMPLETE","getActivityColor","activityType","green","getActivityIcon","activity","IconComponent","isSupportedActivity","prototype","hasOwnProperty","call","ActivityParagraph","activityColor","ActivityMessage","span","color","ThreadActivity","details","individual","userName","date","movedFromCollective","withTheme","CommentIconLib","CommentIcon","ItemContainer","isLast","Thread","collective","items","onCommentDeleted","hasMore","fetchMore","setLoading","isAdmin","isAdminOfCollective","handleLoadMore","item","idx","canEditComment","conversationListFragment","isUserFollowingConversationQuery","updateListFragment","MessageSquare","timeout","isCopied","setCopied","updateCopyBtnTimeout","setUpdateCopyBtnTimeout","clearTimeout","timeoutFn","setTimeout"],"sourceRoot":""}