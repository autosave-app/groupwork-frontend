{"version":3,"file":"static/chunks/pages/contribution-flow-219f8c7e2bf3aab5.js","mappings":"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","sources":["webpack://_N_E/./components/Redirect.js","webpack://_N_E/./pages/contribution-flow.js","webpack://_N_E/?2f47"],"sourcesContent":["import React, { useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { useRouter } from 'next/router';\n\nimport Loading from './Loading';\n\nconst Redirect = ({ to }) => {\n  const router = useRouter();\n\n  useEffect(() => {\n    router.push(to);\n  }, [to]);\n\n  return <Loading />;\n};\n\nRedirect.propTypes = {\n  to: PropTypes.string.isRequired,\n};\n\nexport default Redirect;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { graphql } from '@apollo/client/react/hoc';\nimport { get, omit } from 'lodash';\nimport { withRouter } from 'next/router';\nimport { injectIntl } from 'react-intl';\n\nimport { GQLV2_SUPPORTED_PAYMENT_METHOD_TYPES } from '../lib/constants/payment-methods';\nimport { generateNotFoundError, getErrorFromGraphqlException } from '../lib/errors';\nimport { API_V2_CONTEXT } from '../lib/graphql/helpers';\nimport { addParentToURLIfMissing, getCollectivePageRoute } from '../lib/url-helpers';\nimport { compose } from '../lib/utils';\n\nimport Container from '../components/Container';\nimport { PAYMENT_FLOW } from '../components/contribution-flow/constants';\nimport ContributionBlocker, {\n  CONTRIBUTION_BLOCKER,\n  getContributionBlocker,\n} from '../components/contribution-flow/ContributionBlocker';\nimport {\n  contributionFlowAccountQuery,\n  contributionFlowAccountWithTierQuery,\n} from '../components/contribution-flow/graphql/queries';\nimport ContributionFlowContainer from '../components/contribution-flow/index';\nimport { getContributionFlowMetadata } from '../components/contribution-flow/utils';\nimport ErrorPage from '../components/ErrorPage';\nimport Loading from '../components/Loading';\nimport Page from '../components/Page';\nimport Redirect from '../components/Redirect';\nimport { withStripeLoader } from '../components/StripeProvider';\nimport { withUser } from '../components/UserProvider';\n\nclass NewContributionFlowPage extends React.Component {\n  static getInitialProps({ query }) {\n    return {\n      // Route parameters\n      collectiveSlug: query.eventSlug || query.collectiveSlug,\n      tierId: parseInt(query.tierId) || null,\n      paymentFlow: query.paymentFlow,\n      // Query parameters\n      error: query.error,\n    };\n  }\n\n  static propTypes = {\n    collectiveSlug: PropTypes.string.isRequired,\n    paymentFlow: PropTypes.string,\n    tierId: PropTypes.number,\n    error: PropTypes.string,\n    data: PropTypes.shape({\n      loading: PropTypes.bool,\n      error: PropTypes.any,\n      account: PropTypes.object,\n      tier: PropTypes.object,\n    }), // from withData\n    intl: PropTypes.object,\n    loadStripe: PropTypes.func,\n    LoggedInUser: PropTypes.object,\n    loadingLoggedInUser: PropTypes.bool,\n    router: PropTypes.object,\n  };\n\n  componentDidMount() {\n    this.loadExternalScripts();\n    const { router, data } = this.props;\n    const account = data?.account;\n    const queryParameters = {\n      ...omit(router.query, ['verb', 'step', 'collectiveSlug']),\n    };\n    addParentToURLIfMissing(router, account, `/${router.query.verb}/${router.query.step ?? ''}`, queryParameters);\n  }\n\n  componentDidUpdate(prevProps) {\n    const hostPath = 'data.account.host';\n    if (get(this.props, hostPath) !== get(prevProps, hostPath)) {\n      this.loadExternalScripts();\n    }\n  }\n\n  loadExternalScripts() {\n    const supportedPaymentMethods = get(this.props.data, 'account.host.supportedPaymentMethods', []);\n    if (supportedPaymentMethods.includes(GQLV2_SUPPORTED_PAYMENT_METHOD_TYPES.CREDIT_CARD)) {\n      this.props.loadStripe();\n    }\n  }\n\n  getPageMetadata() {\n    const { intl, data } = this.props;\n    return getContributionFlowMetadata(intl, data?.account, data?.tier);\n  }\n\n  renderPageContent() {\n    const { data = {}, paymentFlow, LoggedInUser, error } = this.props;\n    const { account, tier } = data;\n    const isCrypto = paymentFlow === PAYMENT_FLOW.CRYPTO;\n\n    if (data.loading) {\n      return (\n        <Container py={[5, 6]}>\n          <Loading />\n        </Container>\n      );\n    }\n\n    const contributionBlocker = getContributionBlocker(\n      LoggedInUser,\n      account,\n      tier,\n      Boolean(this.props.tierId),\n      isCrypto,\n    );\n\n    if (contributionBlocker) {\n      if (contributionBlocker.reason === CONTRIBUTION_BLOCKER.NO_CUSTOM_CONTRIBUTION) {\n        return <Redirect to={`${getCollectivePageRoute(account)}/contribute`} />;\n      }\n      return <ContributionBlocker blocker={contributionBlocker} account={account} />;\n    } else {\n      return (\n        <ContributionFlowContainer\n          collective={account}\n          host={account.host}\n          tier={tier}\n          paymentFlow={paymentFlow}\n          error={error}\n        />\n      );\n    }\n  }\n\n  render() {\n    const { data } = this.props;\n    if (!data.loading && !data.account) {\n      const error = data.error\n        ? getErrorFromGraphqlException(data.error)\n        : generateNotFoundError(this.props.collectiveSlug);\n\n      return <ErrorPage error={error} />;\n    }\n\n    return (\n      <Page\n        {...this.getPageMetadata()}\n        showFooter={false}\n        menuItemsV2={{ solutions: false, product: false, company: false, docs: false }}\n        showSearch={false}\n      >\n        {this.renderPageContent()}\n      </Page>\n    );\n  }\n}\n\nconst addAccountData = graphql(contributionFlowAccountQuery, {\n  skip: props => Boolean(props.tierId),\n  options: props => ({\n    variables: { collectiveSlug: props.collectiveSlug },\n    context: API_V2_CONTEXT,\n  }),\n});\n\nconst addAccountWithTierData = graphql(contributionFlowAccountWithTierQuery, {\n  skip: props => !props.tierId,\n  options: props => ({\n    variables: { collectiveSlug: props.collectiveSlug, tier: { legacyId: props.tierId } },\n    context: API_V2_CONTEXT,\n  }),\n});\n\nconst addGraphql = compose(addAccountData, addAccountWithTierData);\n\nexport default addGraphql(withUser(injectIntl(withStripeLoader(withRouter(NewContributionFlowPage)))));\n","\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/contribution-flow\",\n      function () {\n        return require(\"private-next-pages/contribution-flow.js\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/contribution-flow\"])\n      });\n    }\n  "],"names":["React","useEffect","useRouter","Loading","Redirect","to","router","push","graphql","withRouter","injectIntl","GQLV2_SUPPORTED_PAYMENT_METHOD_TYPES","generateNotFoundError","getErrorFromGraphqlException","API_V2_CONTEXT","addParentToURLIfMissing","getCollectivePageRoute","compose","Container","PAYMENT_FLOW","ContributionBlocker","CONTRIBUTION_BLOCKER","getContributionBlocker","contributionFlowAccountQuery","contributionFlowAccountWithTierQuery","ContributionFlowContainer","getContributionFlowMetadata","ErrorPage","Page","withStripeLoader","withUser","NewContributionFlowPage","loadExternalScripts","props","data","account","queryParameters","query","verb","step","prevProps","hostPath","supportedPaymentMethods","includes","CREDIT_CARD","loadStripe","intl","tier","paymentFlow","LoggedInUser","error","isCrypto","CRYPTO","loading","contributionBlocker","Boolean","tierId","reason","NO_CUSTOM_CONTRIBUTION","host","collectiveSlug","getPageMetadata","solutions","product","company","docs","renderPageContent","eventSlug","parseInt","Component","addAccountData","skip","options","variables","context","addAccountWithTierData","legacyId","addGraphql"],"sourceRoot":""}